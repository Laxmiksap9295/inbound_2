var oThat;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageToast"],function(e,t,a,o,n,r,i,l){"use strict";return e.extend("ZGT_MM_INBOUND.controller.Approve",{onInit:function(){oThat=this;oThat.BusyDialog=new a;oThat.oView=this.getView();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("Approve").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){oThat.BusyDialog=new a;oThat=this;oThat.oView=oThat.getView();oThat.Core=sap.ui.getCore();oThat.oModel=oThat.getOwnerComponent().getModel();var t=oThat.oView.byId("idPlantInputF4");if(t){t.setValue("")}this._openPlantFragment();this._fetchPlantDataAndAutoSelect()},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GET"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SAVE"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e,t){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.oView.setModel(new o(e),"oApproveModel");oThat.oView.getModel("oApproveModel").refresh(true)}else if(oThat.Service==="SAVE"){oThat.Approve.destroy();oThat.Service="GET";var a={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",StatusUpdate:"",Approval:"X",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[],ApprovalNav:[]}};oThat.onCallService(oThat.Service,a)}},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},onPressListItem:function(e){var t=e.getSource().getBindingContextPath();var a=oThat.oView.getModel("oApproveModel").getObject(t);oThat.oView.setModel(new o(a),"Approve");oThat.oView.getModel("Approve").refresh(true);oThat.Approve=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Approve",oThat);oThat.oView.addDependent(oThat.Approve);oThat.Approve.setEscapeHandler(oThat.onEscapeApprove);oThat.Approve.open()},fnApproveReject:function(e){oThat.vId=e.getSource().getId();var a="";if(oThat.vId.indexOf("id_BtnApprove")!=-1){a="A"}else if(oThat.vId.indexOf("id_BtnReject")!=-1){a="R";if(oThat.oView.getModel("Approve").getData().Reason==""){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg9"));return}}var o={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Approval:"X",IvAction:a,IvWboj:oThat.EvWtype,IvWbid:oThat.oView.getModel("Approve").getData().Wbid,Outbound:"",PostReturnNav:[],PostWbHeaderNav:[{Reason:oThat.oView.getModel("Approve").getData().Reason}],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};oThat.Service="SAVE";oThat.onCallService(oThat.Service,o)},onClickBack:function(){oThat.Approve.destroy()},onEscapeApprove:function(){oThat.Approve.destroy()},onNavBack:function(){this.oRouter.navTo("Inbound")},_fetchPlantDataAndAutoSelect:function(){this._getPlantData().then(function(e){if(e?.results?.[0]?.F4PlantNav?.results?.length===1){this._handlePlantSelection(e.results[0].F4PlantNav.results[0].Werks);this._closePlantFragment()}else{this._setPlantModelToFragment(e)}}.bind(this)).catch(function(e){l.show("Error fetching plants: "+e)})},_getPlantData:function(){var e=this;return new Promise(function(t,a){var o=[new n("ProcessType",r.EQ,"X"),new n("Plant",r.EQ,"X"),new n("Vehtype",r.EQ,"X")];e.BusyDialog.open();e.oModel.read("/F4ParametersSet",{filters:o,urlParameters:{$expand:"F4DirectionNav,F4ProcessNav,F4PlantNav,F4TransporterNav,F4VehTypeNav"},success:function(a){e.BusyDialog.close();t(a)},error:function(t){e.BusyDialog.close();a(t)}})})},_openPlantFragment:function(){if(!this._pPlantFragment){this._pPlantFragment=i.load({id:this.getView().getId(),name:"ZGT_MM_INBOUND.Fragments.PlantSelection",controller:this}).then(function(e){this.getView().addDependent(e);e.open();return e}.bind(this))}else{this._pPlantFragment.then(function(e){e.open()})}},_setPlantModelToFragment:function(e){var t=new o(e);this.getView().setModel(t,"PlantF4")},onSelectPlantF4:function(){var e=this.byId("idPlantInputF4");var t=e.getValue();if(!t){l.show("Please select a plant");return}this._handlePlantSelection(t);this._closePlantFragment()},_handlePlantSelection:function(e){var t=this.byId("idPlantInputF4");t&&t.setValue(e);this._loadApprovallData(e)},_closePlantFragment:function(){this._pPlantFragment&&this._pPlantFragment.then(function(e){e.close()})},onValueHelpPlantF4:function(e){oThat.vId=e.getSource().getId();e.getSource().setValueState("None");var t=this.getView().getModel("PlantF4");if(!t){l.show("No plant data available");return}if(!oThat.ValueHelp){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Plant",this);oThat.getView().setModel(t,"F4Model");oThat.getView().addDependent(oThat.ValueHelp)}oThat.ValueHelp.open()},onValueHelpConfirmPlant:function(e){var t=e.getParameter("selectedItem");if(t){var a=t.getDescription();var o=sap.ui.getCore().byId(oThat.vId);o.setValue(a)}if(oThat.ValueHelp){oThat.ValueHelp.destroy();oThat.ValueHelp=null}},onValueHelpSearch:function(e){var t=e.getParameter("value");var a=new n([new n("Werks",r.Contains,t),new n("Name1",r.Contains,t)]);var o=e.getSource().getBinding("items");o.filter([a])},_loadApprovallData:function(e){oThat.Service="GET";var t={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:e,StatusUpdate:"",Approval:"X",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[],ApprovalNav:[]}};oThat.onCallService(oThat.Service,t)},fnSearchRefId:function(e){var t=e.getSource().getValue();var a=this.getView().byId("vech_ass");if(t&&t.length>0){var o=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter([o,n])}var i=a.getBinding("items");i.filter(r)}})});
//# sourceMappingURL=Approve.controller.js.map