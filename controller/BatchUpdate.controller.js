var oThat;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/MessageToast"],function(e,t,a,o,i,r){"use strict";return e.extend("ZGT_MM_INBOUND.controller.BatchUpdate",{onInit:function(){oThat=this;oThat.BusyDialog=new a;oThat.oView=this.getView();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("BatchUpdate").attachMatched(this._onRouteMatched,this);oThat.ReprintOpen="";oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin=""},_onRouteMatched:function(e){oThat.BusyDialog=new a;oThat=this;oThat.oView=oThat.getView();oThat.Core=sap.ui.getCore();oThat.oModel=oThat.getOwnerComponent().getModel();oThat.getView().byId("id_InDateBatch").setDateValue(new Date);oThat.oView.byId("id_InBatchValue").setValue("");oThat.oView.byId("id_InWbidBatch").setValue("");oThat.oView.byId("id_InVehicleNoBatch").setValue("");oThat.oView.byId("id_BtnSave").setEnabled(false);oThat.oView.byId("id_InVehicleNoBatch").setEnabled(true);oThat.getView().byId("id_InPO").setValue("");oThat.getView().byId("id_InPrLot").setValue("");oThat.getView().byId("id_InMaktx").setValue("");oThat.getView().byId("id_InMatnr").setValue("");oThat.getView().byId("id_InUnloc").setValue("");oThat.getView().byId("id_InWbidTrans").setValue("");oThat.getView().byId("id_HeaderText").setText();oThat.getView().byId("id_BtnSubmitText").setVisible(false);oThat.oView.setModel(new o({}),"JmOrigin");oThat.CurrentDateValue=oThat.getView().byId("id_InDateBatch").getValue();var t=oThat.getView().byId("id_BatchPanel");oThat.oView.setModel(new o([]),"JmLoadBags");t.destroyContent();oThat.getView().byId("SimpleFormDisplayBatch").setVisible(false);oThat.getView().byId("id_ListItemOut").setVisible(false);oThat.onOpenSettings()},onOpenSettings:function(){setTimeout(function(){oThat.ProcessSetting=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.ProcessType",oThat);oThat.oView.addDependent(oThat.ProcessSetting);oThat.ProcessSetting.open()},1e3)},fnOpenSettings:function(){oThat.ProcessSetting=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.ProcessType",oThat);oThat.oView.addDependent(oThat.ProcessSetting);oThat.ProcessSetting.open()},onCloseProcess:function(){oThat.ProcessSetting.destroy()},onSelectProcessType:function(){var e=sap.ui.getCore().byId("id_SelProcessType").getSelectedKey();if(e){oThat.ProcessType=e;oThat.getView().byId("SimpleFormDisplayBatch").setVisible(true);if(e==="01"){oThat.getView().byId("id_HeaderText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("PoUpd"));oThat.getView().byId("id_BtnSave").setVisible(false);oThat.getView().byId("id_BtnSavePort").setVisible(true);oThat.getView().byId("id_BtnSubmitText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Label11"));oThat.getView().byId("id_BtnSubmitText").setVisible(false);oThat.getView().byId("id_InMaktxLabel").setVisible(true);oThat.getView().byId("id_InMaktx").setVisible(true);oThat.getView().byId("id_InMatnr").setVisible(true);oThat.getView().byId("id_InMatLabel").setVisible(true);oThat.getView().byId("id_InBatchValue").setVisible(true);oThat.getView().byId("id_InBatchLabel").setVisible(true);oThat.getView().byId("id_InUnloc").setVisible(true);oThat.getView().byId("id_InLocLabel").setVisible(true);oThat.getView().byId("id_InPrLot").setVisible(true);oThat.getView().byId("id_InLotLabel").setVisible(true);oThat.getView().byId("id_InPO").setVisible(true);oThat.getView().byId("id_InPoLabel").setVisible(true);oThat.getView().byId("id_InWbidBatch").setVisible(true);oThat.getView().byId("id_InWbidBatch").setEnabled(false);oThat.getView().byId("id_InWbidBatch").setShowValueHelp(false);oThat.getView().byId("id_InWbidBatch").setValueHelpOnly(false);oThat.getView().byId("id_InWbBatchLabel").setVisible(true);oThat.getView().byId("id_InVehicleLabel").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setShowValueHelp(true);oThat.getView().byId("id_InDateLabel").setVisible(true);oThat.getView().byId("id_InDateBatch").setVisible(true);oThat.getView().byId("id_InWbidTrans").setVisible(false);oThat.getView().byId("id_InWbTransLabel").setVisible(false);oThat.getView().byId("id_ListItemOut").setVisible(true)}else if(e==="02"){oThat.getView().byId("id_HeaderText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("CharUpdate"));oThat.getView().byId("id_BtnSave").setVisible(true);oThat.getView().byId("id_BtnSavePort").setVisible(false);oThat.getView().byId("id_BtnSubmitText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Label11"));oThat.getView().byId("id_BtnSubmitText").setVisible(false);oThat.getView().byId("id_InMaktxLabel").setVisible(true);oThat.getView().byId("id_InMaktx").setVisible(true);oThat.getView().byId("id_InMatnr").setVisible(true);oThat.getView().byId("id_InMatLabel").setVisible(true);oThat.getView().byId("id_InBatchValue").setVisible(true);oThat.getView().byId("id_InBatchLabel").setVisible(true);oThat.getView().byId("id_InUnloc").setVisible(true);oThat.getView().byId("id_InLocLabel").setVisible(true);oThat.getView().byId("id_InPrLot").setVisible(true);oThat.getView().byId("id_InLotLabel").setVisible(true);oThat.getView().byId("id_InPO").setVisible(true);oThat.getView().byId("id_InPoLabel").setVisible(true);oThat.getView().byId("id_InWbidBatch").setVisible(true);oThat.getView().byId("id_InWbidBatch").setEnabled(false);oThat.getView().byId("id_InWbidBatch").setShowValueHelp(false);oThat.getView().byId("id_InWbidBatch").setValueHelpOnly(false);oThat.getView().byId("id_InWbBatchLabel").setVisible(true);oThat.getView().byId("id_InVehicleLabel").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setShowValueHelp(true);oThat.getView().byId("id_InDateLabel").setVisible(true);oThat.getView().byId("id_InDateBatch").setVisible(true);oThat.getView().byId("id_InWbidTrans").setVisible(false);oThat.getView().byId("id_InWbTransLabel").setVisible(false);oThat.getView().byId("id_ListItemOut").setVisible(false)}else if(e==="03"){oThat.getView().byId("id_BtnSavePort").setVisible(false);oThat.getView().byId("id_HeaderText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("BrUpdate"));oThat.getView().byId("id_BtnSubmitText").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("SaveChng"));oThat.getView().byId("id_BtnSubmitText").setEnabled(false);oThat.getView().byId("id_BtnSubmitText").setVisible(false);oThat.getView().byId("id_BtnSave").setVisible(false);oThat.getView().byId("id_InMaktxLabel").setVisible(false);oThat.getView().byId("id_InMaktx").setVisible(false);oThat.getView().byId("id_InMatnr").setVisible(false);oThat.getView().byId("id_InMatLabel").setVisible(false);oThat.getView().byId("id_InBatchValue").setVisible(false);oThat.getView().byId("id_InBatchLabel").setVisible(false);oThat.getView().byId("id_InUnloc").setVisible(false);oThat.getView().byId("id_InLocLabel").setVisible(false);oThat.getView().byId("id_InPrLot").setVisible(false);oThat.getView().byId("id_InLotLabel").setVisible(false);oThat.getView().byId("id_InPO").setVisible(false);oThat.getView().byId("id_InPoLabel").setVisible(false);oThat.getView().byId("id_InWbidBatch").setVisible(true);oThat.getView().byId("id_InWbidBatch").setEditable(true);oThat.getView().byId("id_InWbidBatch").setEnabled(true);oThat.getView().byId("id_InWbidBatch").setShowValueHelp(true);oThat.getView().byId("id_InWbidBatch").setValueHelpOnly(true);oThat.getView().byId("id_InWbBatchLabel").setVisible(true);oThat.getView().byId("id_InVehicleLabel").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setVisible(true);oThat.getView().byId("id_InVehicleNoBatch").setShowValueHelp(false);oThat.getView().byId("id_InDateLabel").setVisible(true);oThat.getView().byId("id_InDateBatch").setVisible(true);oThat.getView().byId("id_InWbidTrans").setVisible(true);oThat.getView().byId("id_InWbTransLabel").setVisible(true);oThat.getView().byId("id_ListItemOut").setVisible(false)}oThat.ProcessSetting.destroy();oThat.fnClearDatas()}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("PlSelProcess"))}},fnChangeVehicle:function(e){var t=e.getSource().getValue();t=t.replace(/[^a-zA-Z0-9/ /]/g,"");t=t.toUpperCase();e.getSource().setValue(t);if(t){e.getSource().setValueState("None")}oThat.getView().byId("id_BtnSubmitText").setEnabled(true);oThat.getView().byId("id_BtnSubmitText").setVisible(true)},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="REPRINT"||oThat.Service==="GETBATCH"){oThat.oModel.create("/GetHeadersSet",t,{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="GETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/BatchGetSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/PostBatchCharUpdSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="Vendor"){oThat.oModel.read("/F4TransportersSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="GETBAGS"||oThat.Service==="GETWT"||oThat.Service==="POSTBAGS"){oThat.BusyDialog.open();oThat.oModel.create("/PostBatchCharUpdSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e,a){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.oView.setModel(new o(e),"oStatusModel");oThat.oView.getModel("oStatusModel").refresh(true);if(e.StatusUpdateNav.results.length!=0){oThat.VehicleNo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.VehicleNo",oThat);oThat.oView.addDependent(oThat.VehicleNo);oThat.VehicleNo.open()}else{oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMSg16"))}}else if(oThat.Service==="REPRINT"){oThat.oView.setModel(new o(e),"oStatusModel");oThat.oView.getModel("oStatusModel").refresh(true);if(e.StatusUpdateNav.results.length!=0){oThat.VehicleNo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.TruckNo",oThat);oThat.oView.addDependent(oThat.VehicleNo);oThat.VehicleNo.open()}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMSg16"))}}else if(oThat.Service==="GETBATCH"){oThat.oView.setModel(new o(e.F4PrlotPrintNav.results),"LotF4Data");oThat.oView.getModel("LotF4Data").refresh(true);if(e.F4PrlotPrintNav.results.length!=0){oThat.LotF4=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.LotF4",oThat);oThat.oView.addDependent(oThat.LotF4);oThat.LotF4.open();if(oThat.ReprintOpen==="X"){oThat.LotF4.setMultiSelect(true)}else{oThat.LotF4.setMultiSelect(false)}}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("NoLotAvail"))}}else if(oThat.Service==="GETCHAR"){var i=false;if(e.GetReturnNav.results.length>0){if(e.GetReturnNav.results[0].Type=="E"){i=true}}if(!i){oThat.oView.setModel(new o(e.BatchCharsNav.results),"BATCH");oThat.oView.getModel("BATCH").refresh(true);oThat.onCreateChracteritis()}else{t.error(e.GetReturnNav.results[0].Message)}}else if(oThat.Service==="GETBAGS"){var i=false;if(e.ReturnNav.results.length>0){if(e.ReturnNav.results[0].Type=="E"){i=true}}if(!i){oThat.oView.setModel(new o(e.LoadBagsNav.results),"JmLoadBags");oThat.oView.setModel(new o(e.HatchNav.results),"JmHatch");oThat.oView.getModel("JmLoadBags").refresh(true);oThat.oView.getModel("JmHatch").refresh(true)}else{t.error(e.ReturnNav.results[0].Message)}}else if(oThat.Service==="GETWT"){var i=false;if(e.ReturnNav.results.length>0){if(e.ReturnNav.results[0].Type=="E"){i=true}}if(!i){oThat.getView().getModel("JmLoadBags").refresh()}else{t.error(e.ReturnNav.results[0].Message)}}else if(oThat.Service==="POSTBAGS"){if(e.ReturnNav.results.length!=0){var n=e.ReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){var s="";if(e.ReturnNav.results.length>0){for(var l=0;l<e.ReturnNav.results.length;l++){var d=l+1;s=s+" "+d+". "+e.ReturnNav.results[l].Message+"\n"}}t.error(s)}var g=e.ReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(g!=0){t.show(g[0].Message,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(e){if(e==="OK"){oThat.fnClearDatas();oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin="";oThat.oRouter.navTo("Inbound")}else{oThat.fnClearDatas();oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin="";oThat.oRouter.navTo("Inbound")}}})}}}else if(oThat.Service==="SETCHAR"){if(e.ReturnNav.results.length!=0){var h="";var T=e.ReturnNav.results.filter(function(e){h=h+e.Message+"\r\n"});var n=e.ReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){t.error(h)}var g=e.ReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(g!=0){t.show(g[0].Message,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(e){if(e==="OK"){if(oThat.ProcessType==="02"){t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(e){if(e==="YES"){var t=oThat.oModel.sServiceUrl;var a=oThat.oView.byId("id_InWbidBatch").getValue();var o="";if(oThat.ProcessType==="02"){o=oThat.oView.byId("id_InBatchValue").getValue()}var i="/DownloadSet(IvWbid='"+a+"',IvPrint='X',GateEntry='X',IvBatch='"+o+"')/$value";var r=t+i;if(sap.ui.Device.system.desktop){oThat.initiatePdfDialog();var n="<div><iframe src="+r+" width='100%' height='520'></iframe></div>";oThat.oImageDialog.getContent()[0].setContent(n);oThat.oImageDialog.addStyleClass("sapUiSizeCompact");oThat.oImageDialog.open()}else{window.open(r)}}else{oThat.fnClearDatas();oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin="";oThat.oRouter.navTo("Inbound")}}})}else{oThat.fnClearDatas();oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin="";oThat.oRouter.navTo("Inbound")}}else{oThat.fnClearDatas()}}})}}}else if(oThat.Service==="SAVE"){if(e.PostReturnNav.results.length!=0){var n=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){t.error(n[0].Message)}var g=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(g!=0){t.success(g[0].Message);oThat.oView.byId("id_BtnSave").setVisible(false);oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");oThat.oView.byId("id_InDateBatch").setValue("")}}else{oThat.oView.byId("id_BtnSave").setVisible(false);oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");oThat.oView.byId("id_InDateBatch").setValue("")}}else if(oThat.Service=="Vendor"){var u=new o(e);u.setSizeLimit(e.length);oThat.oView.setModel(u,"Vendor")}},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},onClickVehicleF4:function(e){var a=this;var o="",i="";if(a.ReprintOpen===""){if(a.ProcessType==="02"){o="C"}if(a.ProcessType==="03"){o="B"}if(a.ProcessType==="01"){o="P"}i="";var r=a.getView().byId("id_InDateBatch").getDateValue();var n=a.getView().byId("id_InDateBatch").getValue()}else{if(a.ProcessType==="02"){o="C"}if(a.ProcessType==="03"){o="B"}if(a.ProcessType==="01"){o="P"}i="";var r=sap.ui.getCore().byId("id_InDate").getDateValue();var n=sap.ui.getCore().byId("id_InDate").getValue()}a.vId=e.getSource().getId();if(n!==null&&n!==""){var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var l=s.format(r);a.Service="REPRINT";var d={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",StatusUpdate:"",ReprintF4:i,CharUpdF4:o,Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[{InDate:l}]}};a.onCallService(a.Service,d)}else{t.error(a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6"))}},onValueHelpSearch:function(e){var t=e.getSource()._sSearchFieldValue;if(oThat.vId.indexOf("id_InWbidTrans")===-1){if(t&&t.length>0){var a=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Lifnr",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Vehtyp",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter([a,o,i,r,n])}}else{if(t&&t.length>0){var i=new sap.ui.model.Filter("Lifnr",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Name1",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter([i,r])}}var l=e.getSource().getBinding("items");l.filter(s)},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");if(oThat.vId.indexOf("id_InWbidTrans")===-1){if(oThat.ReprintOpen===""){var t=e.getParameter("selectedItem");var a=e.getParameter("selectedItem").getBindingContext("oStatusModel").getObject();oThat.getView().byId("id_InVehicleNoBatch").setValue(a.Vehno);oThat.getView().byId("id_InWbidBatch").setValue(a.Wbid);if(oThat.ProcessType==="03"){oThat.getView().byId("id_InWbidTrans").setValue(a.Lifnr+" - "+a.Name1)}oThat.SelectedWbPlant=a.Werks;oThat.SelectedOrigin=a.Origin;var i={Origin:a.Origin};oThat.oView.setModel(new o(i),"JmOrigin");var r=oThat.getView().byId("id_BatchPanel");r.destroyContent();oThat.getView().byId("id_InBatchValue").setValue("");oThat.oView.byId("id_BtnSave").setEnabled(false)}else{var t=e.getParameter("selectedItem");var a=e.getParameter("selectedItem").getBindingContext("oStatusModel").getObject();sap.ui.getCore().byId("id_InVehicleNo").setValue(a.Vehno);sap.ui.getCore().byId("id_InWbid").setValue(a.Wbid)}}else{var a=e.getParameter("selectedItem").getBindingContext("Vendor").getObject();oThat.getView().byId("id_InWbidTrans").setValue(a.Lifnr+" - "+a.Name1);oThat.getView().byId("id_BtnSubmitText").setEnabled(true);oThat.getView().byId("id_BtnSubmitText").setVisible(true)}},fnTransHelp:function(e){oThat.vId=e.getSource().getId();var t=oThat.getView().byId("id_InWbidBatch").getValue();if(oThat.SelectedWbPlant&&t){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Transporter",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open();oThat.Service="Vendor";var a=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.SelectedWbPlant)];oThat.onCallService(oThat.Service,a)}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("PlSelWbId"))}},onPrLotF4:function(e){var a=this;a.vId=e.getSource().getId();var o=a.getView().byId("id_InDateBatch").getValue();var i=a.getView().byId("id_InWbidBatch").getValue();var r=false;var n="";if(a.ReprintOpen==="X"){var o=sap.ui.getCore().byId("id_InDate").getDateValue();var i=sap.ui.getCore().byId("id_InWbid").getValue();if(sap.ui.getCore().byId("id_InVehicleNo").getValue()===""||sap.ui.getCore().byId("id_InWbid").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()==null){r=true;n=a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg7")+"\r\n"}}else{var o=a.getView().byId("id_InDateBatch").getValue();var i=a.getView().byId("id_InWbidBatch").getValue();if(o==null&&o==""){r=true;n=a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6")+"\r\n"}if(!i){r=true;n=n+a.oView.getModel("i18n").getResourceBundle().getText("EnterVehNo")}var o=a.getView().byId("id_InDateBatch").getDateValue()}if(!r){var s=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var l=s.format(o);a.Service="GETBATCH";var d={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:i,IvWerks:"",StatusUpdate:"",ReprintF4:"",PrlotF4Print:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],F4PrlotPrintNav:[],StatusUpdateNav:[{InDate:l}]}};a.onCallService(a.Service,d)}else{t.error(n)}},onChargF4Search:function(e){var t=e.getSource()._sSearchFieldValue;if(t&&t.length>0){var a=new sap.ui.model.Filter("Lotno",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Bwtar",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Maktx",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter([a,o,i,r])}var s=e.getSource().getBinding("items");s.filter(n)},fnChangeInDate:function(e){if(oThat.CurrentDateValue!==oThat.getView().byId("id_InDateBatch").getValue()){oThat.fnClearDatas()}},fnClearDatas:function(){oThat.BatchObject="";oThat.oView.byId("id_InBatchValue").setValue("");oThat.oView.byId("id_InWbidBatch").setValue("");oThat.oView.byId("id_InVehicleNoBatch").setValue("");oThat.getView().byId("id_InPO").setValue("");oThat.getView().byId("id_InPrLot").setValue("");oThat.getView().byId("id_InMaktx").setValue("");oThat.getView().byId("id_InMatnr").setValue("");oThat.getView().byId("id_InUnloc").setValue("");oThat.getView().byId("id_InWbidTrans").setValue("");oThat.oView.byId("id_BtnSave").setEnabled(false);oThat.oView.byId("id_InVehicleNoBatch").setEnabled(true);oThat.getView().byId("id_BtnSavePort").setEnabled(false);oThat.oView.setModel(new o({}),"JmOrigin");oThat.getView().getModel("BATCH")===undefined?"":oThat.getView().getModel("BATCH").setData([]);var e=oThat.getView().byId("id_BatchPanel");e.destroyContent();oThat.oView.setModel(new o([]),"JmLoadBags")},onPressCheck:function(){var e=false,t="";if(oThat.ProcessType==="02"){if(!oThat.getView().byId("id_InVehicleNoBatch").getValue()){e=true;t=oThat.oView.getModel("i18n").getResourceBundle().getText("PlSelTruck")+"\r\n"}if(!oThat.getView().byId("id_InBatchValue").getValue()){e=true;t=t+oThat.oView.getModel("i18n").getResourceBundle().getText("SelBatch")}if(!e){oThat.getView().byId("id_InVehicleNoBatch").setEnabled(false);var a={MaterialNav:[],BatchCharsNav:[],BatchValuesNav:[],GetReturnNav:[]};var o={Matnr:oThat.BatchObject.Matnr,Werks:oThat.BatchObject.Werks,Lgort:"",Charg:oThat.BatchObject.Lotno.toUpperCase(),Msgid:"",Msgno:""};a.MaterialNav.push(o);oThat.Service="GETCHAR";oThat.onCallService(oThat.Service,a)}else{sap.m.MessageBox.error(t)}}if(oThat.ProcessType==="03"){if(!oThat.getView().byId("id_InVehicleNoBatch").getValue()){e=true;t=oThat.oView.getModel("i18n").getResourceBundle().getText("PlEnterVehicle")+"\r\n"}if(!e){oThat.Service="SETCHAR";var a={IFlag:"B",ICharg:"",IMatnr:"",IWerks:oThat.SelectedWbPlant,TruckNo:oThat.getView().byId("id_InVehicleNoBatch").getValue(),Lifnr:oThat.getView().byId("id_InWbidTrans").getValue().split(" - ")[0],WbId:oThat.getView().byId("id_InWbidBatch").getValue(),PostBatchCharNav:[],ReturnNav:[]};oThat.Service="SETCHAR";oThat.onCallService(oThat.Service,a)}else{sap.m.MessageBox.error(t)}}if(oThat.ProcessType==="01"){if(!oThat.getView().byId("id_InVehicleNoBatch").getValue()){e=true;t=oThat.oView.getModel("i18n").getResourceBundle().getText("PlSelTruck")+"\r\n"}if(!oThat.getView().byId("id_InBatchValue").getValue()){e=true;t=t+oThat.oView.getModel("i18n").getResourceBundle().getText("SelBatch")}if(!e){oThat.getView().byId("id_InVehicleNoBatch").setEnabled(false);var a={IFlag:"G",ICharg:oThat.BatchObject.Lotno.toUpperCase(),IMatnr:oThat.BatchObject.Matnr,IWerks:oThat.BatchObject.Werks,TruckNo:oThat.getView().byId("id_InVehicleNoBatch").getValue(),WbId:oThat.getView().byId("id_InWbidBatch").getValue(),PostBatchCharNav:[],ReturnNav:[],LoadBagsNav:[],HatchNav:[]};oThat.Service="GETBAGS";oThat.onCallService(oThat.Service,a)}else{sap.m.MessageBox.error(t)}}},onCreateChracteritis:function(){var e=this;var t=oThat.getView().byId("id_BatchPanel");t.destroyContent();if(oThat.oView.getModel("BATCH").getData()!=null){var a=oThat.oView.getModel("BATCH").getData();var o=0;var i=false,n=false;var s=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12"}).addStyleClass("sapUiSizeCompact Cl_Grid_Width sapUiSmallMarginTop");for(var l=0;l<a.length;l++){var d=[];var g="",h="",T="";var u=a[l].DescrChar;var c=false;if(a[l].SingleValue){n=false;i=false;var V=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var b=new sap.m.Label({text:u+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");V.addContent(b);var I="";var w="";if(a[l].DataType=="NUM"){I="Number"}else{I="Text"}w=a[l].NumberDigits;var v=new sap.m.Input({width:6+"rem",type:I,maxLength:w,value:a[l].ValueChar,liveChange:function(e){oThat.getView().byId("id_BtnSave").setEnabled(true);if(e.getSource().getParent().getContent().length=="3"){if(e.getSource().getParent().getContent()[2].getText().split(" ").length=="4"){var t=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[1]);var a=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[3]);var o=e.getSource().getType();var i=Number(e.getSource().getValue());if(i<t||i>a){if(i>a){e.getSource().setValue("")}e.getSource().setValueStateText(e.getSource().getParent().getContent()[2].getText());e.getSource().setValueState("Error")}else{e.getSource().setValueState("None")}}else{e.getSource().setValueState("None")}}else{var o=e.getSource().getType();var r="";var i="";if(o=="Number"){i=e.getSource().getValue();var n=e.getSource().getMaxLength();if(i.length>n){var s=i.substring(0,n);e.getSource().setValue("");e.getSource().setValue(s)}}e.getSource().setValueState("None")}}}).addStyleClass("");V.addContent(v);if(d.length>0){var f=oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_TextRange")+" "+Number(d[0].NumValFm)+" - "+Number(d[0].NumValTo);var y=new sap.m.Text({text:f}).addStyleClass("sapUiTinyMarginBegin");V.addContent(y)}s.addContent(V)}else if(!a[l].SingleValue&&d.length>0){var p;i=false;if(p==a[l].DescrChar){n=true}else{n=false}if(n==false){var B=0;var S=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var b=new sap.m.Label({text:u+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");S.addContent(b);var C=new sap.m.MultiComboBox({width:"6rem"}).addStyleClass("sapUiTinyMarginBegin");p=b.getText().split(" :")[0].toLocaleUpperCase();n=true}if(p==a[l].DescrChar){var _=new sap.ui.core.Item({text:a[l].ValueChar,key:B});B=B+1;C.insertItem(_)}else{n=false}S.addContent(C);s.addContent(S)}}t.addContent(s);if(oThat.oView.getModel("BATCH").getData().length!==0){}}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg8"))}},onPressSaveChanges:function(){var e=false;var a="";var o=oThat.getView().getModel("JmLoadBags").getData();for(var i=0;i<o.length;i++){if(Number(o[i].LoadWt)==0){e=true;a=oThat.oView.getModel("i18n").getResourceBundle().getText("plEntBags")}}if(!e){oThat.Service="POSTBAGS";var r={IFlag:"P",ICharg:oThat.BatchObject.Lotno.toUpperCase(),IMatnr:oThat.BatchObject.Matnr,IWerks:oThat.BatchObject.Werks,TruckNo:oThat.getView().byId("id_InVehicleNoBatch").getValue(),Lifnr:"",WbId:oThat.getView().byId("id_InWbidBatch").getValue(),PostBatchCharNav:[],LoadBagsNav:oThat.getView().getModel("JmLoadBags").getData(),ReturnNav:[]};oThat.Service="POSTBAGS";oThat.onCallService(oThat.Service,r)}else{t.error(a)}},onPressSave:function(e){var a=this;var o="",i="";var r=0;var n=oThat.getView().byId("id_BatchPanel").getContent()[0].getContent();for(var s=0;s<n.length;s++){var l=n[s].getContent();var d=n[s].getContent()[1].getId();i=n[s].getContent()[1];var g="",h="";if(n[s].getContent()[1].getId().search("input")!="-1"){g=n[s].getContent()[1].getValue();if(n[s].getContent().length=="3"){if(n[s].getContent()[2].getText().split(" ").length=="4"){var T=Number(n[s].getContent()[2].getText().split(" ")[1]);var u=Number(n[s].getContent()[2].getText().split(" ")[3]);var c=parseFloat(g);var V=isNaN(c);if(V==false){if(c<T||c>u){if(c>u){n[s].getContent()[1].setValue("")}n[s].getContent()[1].setValueStateText(n[s].getContent()[2].getText());n[s].getContent()[1].setValueState("Error");o=n[s].getContent()[2].getText();i.focus();break}else{n[s].getContent()[1].setValueState("None")}}}else{n[s].getContent()[1].setValueState("None")}}}else if(n[s].getContent()[1].getId().search("box")!="-1"){}else if(n[s].getContent()[1].getId().search("group")!="-1"){h=n[s].getContent()[1].getSelectedIndex();g=n[s].getContent()[1].getSelectedKey()}else if(n[s].getContent()[1].getId().search("select")!="-1"){if(n[s].getContent()[1].getSelectedIndex()==-1){h="";g=""}else{h=n[s].getContent()[1].getSelectedIndex();g=n[s].getContent()[1].getSelectedKey()}}if(oThat.oView.getModel("BATCH").getData()[s].EntryObligatory&&!g){o=oThat.oView.getModel("BATCH").getData()[s].DescrChar+" "+oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_ErrorMandit");i.focus();break}var b="";if(n[s].getContent()[1].getId().search("input")!="-1"){b=n[s].getContent()[1].getValue();if(b==""){r=r+1}}}if(r==n.length){o=oThat.oView.getModel("i18n").getResourceBundle().getText("PlEnterAnyOneCharac")}if(o){t.error(o)}else{for(var s=0;s<n.length;s++){var l=n[s].getContent();var d=n[s].getContent()[1].getId();i=n[s].getContent()[1];var g="",h="";if(n[s].getContent()[1].getId().search("input")!="-1"){g=n[s].getContent()[1].getValue();if(n[s].getContent().length=="3"){if(n[s].getContent()[2].getText().split(" ").length=="4"){var T=Number(n[s].getContent()[2].getText().split(" ")[1]);var u=Number(n[s].getContent()[2].getText().split(" ")[3]);var c=parseFloat(g);var V=isNaN(c);if(V==false){n[s].getContent()[1].setValueState("None")}}else{n[s].getContent()[1].setValueState("None")}}}else if(n[s].getContent()[1].getId().search("box")!="-1"){}else if(n[s].getContent()[1].getId().search("group")!="-1"){h=n[s].getContent()[1].getSelectedIndex();g=n[s].getContent()[1].getSelectedKey()}else if(n[s].getContent()[1].getId().search("select")!="-1"){if(n[s].getContent()[1].getSelectedIndex()==-1){h="";g=""}else{h=n[s].getContent()[1].getSelectedIndex();g=n[s].getContent()[1].getSelectedKey()}}for(var I=0;I<oThat.oView.getModel("BATCH").getData().length;I++){if(oThat.oView.getModel("BATCH").getData()[I].Werks==oThat.oView.getModel("BATCH").getData()[s].Werks&&oThat.oView.getModel("BATCH").getData()[I].Matnr==oThat.oView.getModel("BATCH").getData()[s].Matnr&&oThat.oView.getModel("BATCH").getData()[I].NameChar==oThat.oView.getModel("BATCH").getData()[s].NameChar){oThat.oView.getModel("BATCH").getData()[I].ValueChar=g;oThat.oView.getModel("BATCH").refresh(true);break}}}oThat.Service="SETCHAR";var w={IFlag:"C",ICharg:oThat.BatchObject.Lotno.toUpperCase(),IMatnr:oThat.BatchObject.Matnr,IWerks:oThat.BatchObject.Werks,PostBatchCharNav:[],ReturnNav:[]};if(oThat.oView.getModel("BATCH").getData().length!=0){var v=[];for(var f=0;f<oThat.oView.getModel("BATCH").getData().length;f++){v.push({CValue:oThat.oView.getModel("BATCH").getData()[f].DataType==="NUM"?oThat.oView.getModel("BATCH").getData()[f].ValueChar===""?"0":oThat.oView.getModel("BATCH").getData()[f].ValueChar:oThat.oView.getModel("BATCH").getData()[f].ValueChar,CDesc:oThat.oView.getModel("BATCH").getData()[f].DescrChar,Atnam:oThat.oView.getModel("BATCH").getData()[f].NameChar,Disp:""})}w.PostBatchCharNav=v}oThat.Service="SETCHAR";oThat.onCallService(oThat.Service,w)}},fnReprintDialog:function(){var e=this;e.Reprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.RePrint",e);e.oView.addDependent(e.Reprint);e.Reprint.open();e.ReprintOpen="X";sap.ui.getCore().byId("id_InBatch").setVisible(true);sap.ui.getCore().byId("id_InBatchLabel").setVisible(true)},onClickReprintDecline:function(){oThat.Reprint.destroy();oThat.ReprintOpen=""},fnClickonReprintOK:function(){var e=this;if(sap.ui.getCore().byId("id_InVehicleNo").getValue()===""||sap.ui.getCore().byId("id_InWbid").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()==null){t.error(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg7"))}else{var a=e.SelectedLots?e.SelectedLots:"";var o=sap.ui.getCore().byId("id_InWbid").getValue();var i=e.oModel.sServiceUrl;var r="/DownloadSet(IvWbid='"+o+"',IvPrint='X',GateEntry='X',IvBatch='"+a+"')/$value";var n=i+r;if(sap.ui.Device.system.desktop){e.initiatePdfDialog();var s="<div><iframe src="+n+" width='100%' height='520'></iframe></div>";e.oImageDialog.getContent()[0].setContent(s);e.oImageDialog.addStyleClass("sapUiSizeCompact");e.oImageDialog.open()}else{window.open(n)}e.Reprint.destroy();e.ReprintOpen=""}},onChargF4Confirm:function(e){var t=e.getParameter("selectedContexts");if(oThat.ReprintOpen===""){if(t.length>0){var a=e.getParameter("selectedItem");var o=[];var i="";var r="";oThat.BatchObject=t[0].getObject();for(var n=0;n<t.length;n++){var s=t[n].getObject();if(n===0){i=s.Lotno}else{i=i+"*"+s.Lotno}if(t.length>1){r=t[0].getObject().Lotno+"+ "+oThat.oView.getModel("i18n").getResourceBundle().getText("RemMore")}else{r=t[0].getObject().Lotno}}oThat.SelectedLots=i;oThat.getView().byId("id_InBatchValue").setValue(r);oThat.getView().byId("id_InPO").setValue(t[0].getObject().Ebeln);oThat.getView().byId("id_InPrLot").setValue(t[0].getObject().Bwtar);oThat.getView().byId("id_InMaktx").setValue(t[0].getObject().Maktx);oThat.getView().byId("id_InMatnr").setValue(t[0].getObject().Matnr);oThat.getView().byId("id_InUnloc").setValue(t[0].getObject().Lgort);oThat.onPressCheck()}var l=oThat.getView().byId("id_BatchPanel");l.destroyContent();oThat.oView.byId("id_BtnSave").setEnabled(false)}else{if(t.length>0){var a=e.getParameter("selectedItem");var o=[];var i="";var r="";for(var n=0;n<t.length;n++){var s=t[n].getObject();if(n===0){i=s.Lotno}else{i=i+"*"+s.Lotno}if(t.length>1){r=t[0].getObject().Lotno+"+ "+oThat.oView.getModel("i18n").getResourceBundle().getText("RemMore")}else{r=t[0].getObject().Lotno}}oThat.SelectedLots=i;sap.ui.getCore().byId("id_InBatch").setValue(r)}}oThat.LotF4.destroy()},initiatePdfDialog:function(){oThat.oImageDialog=new sap.m.Dialog({title:"PDF",contentWidth:"100%",contentHeight:"",content:new sap.ui.core.HTML({}),beginButton:new sap.m.Button({text:"Close",class:"sapUiSizeCompact",press:function(){oThat.oImageDialog.close();oThat.SelectedLots="";oThat.fnClearDatas();oThat.ProcessType="";oThat.SelectedWbPlant="";oThat.SelectedOrigin="";oThat.oRouter.navTo("Inbound")}})})},fnChangeHatch:function(e){var t=this;if(e.getSource().getBindingContext("JmLoadBags").getObject().Ebeln!==""){var a=e.getSource().getSelectedKey();e.getSource().getBindingContext("JmLoadBags").getObject().Hatch=a;t.getView().getModel("JmLoadBags").refresh(true);t.getView().byId("id_BtnSavePort").setEnabled(true)}else{e.getSource().setSelectedKey();sap.m.MessageToast.show(t.getView().getModel("i18n").getProperty("SelPrLot"))}},fnCalcBags:function(e){var t=this;var a=this;if(e.getSource().getBindingContext("JmLoadBags").getObject().Ebeln!==""){var o=e.getSource().getValue();o=o.replace(/[^\d.]/g,"");var i=false;var r=".!`@#$%^&*()+=[]\\';,/{}|\":<>?~_abcdefghijklmnopqrstuvwxyz";for(var n=0;n<o.length;n++){if(r.indexOf(o.charAt(n))!=-1){i=true;o="0"}}var s=o.indexOf(".");e.getSource().setValue(o);var l=e.getSource().getBindingContext("JmLoadBags").sPath.split("/")[1];var d=a.getView().getModel("JmLoadBags");var g=a.getView().getModel("JmLoadBags").getData();var h=Number(o)%1;if(h===0){var T=0;T+=Number(g[l].LoadSoundBag);T+=Number(g[l].LoadTornBag);T+=Number(g[l].LoadModBag);T+=Number(g[l].LoadTornEmpty);T+=Number(g[l].LoadSampleBag);g[l].LoadTotBag=T.toString();d.refresh(true);a.fnCalcTotMt(l)}else{e.getSource().setValue("0");sap.m.MessageToast.show(t.getView().getModel("i18n").getProperty("EnterValidBags"))}if(i){e.getSource().setValue("0");sap.m.MessageToast.show(t.getView().getModel("i18n").getProperty("EnterValidBags"))}}else{e.getSource().setValue("");sap.m.MessageToast.show(t.getView().getModel("i18n").getProperty("SelPrLot"))}},fnCalcTotMt:function(e){var t=this;var a=t.getView().getModel("JmLoadBags").getData();var o=a[e].LoadTotBag;var i=this;t.BusyDialog.open();var r={IFlag:"W",ICharg:"",IMatnr:a[e].Matnr,IWerks:oThat.BatchObject.Werks,TruckNo:oThat.getView().byId("id_InVehicleNoBatch").getValue(),Lifnr:"",WbId:"",LoadTotBag:o,LoadWt:"0.000",PostBatchCharNav:[],ReturnNav:[]};t.getView().getModel().create("/PostBatchCharUpdSet",r,{success:function(a,o){t.getView().getModel("JmLoadBags").getData()[e].LoadWt=a.LoadWt;t.getView().getModel("JmLoadBags").refresh();t.getView().byId("id_BtnSavePort").setEnabled(true);t.BusyDialog.close()},error:function(e){i.BusyDialog.close()}})},onNavBack:function(){this.oRouter.navTo("Inbound")}})});
//# sourceMappingURL=BatchUpdate.controller.js.map