var oThat=this;jQuery.sap.require("sap.ndc.BarcodeScanner");sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/core/Fragment"],function(e,t,a,i,r,o){"use strict";var n,s,d,s,l,g,c;var u;var m;var h;var f;var p;var v;var w;var M=0;return e.extend("ZGT_MM_INBOUND.controller.EwayBill",{onInit:function(){oThat=this;this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("EwayBill").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){oThat=this;oThat.onPressNewEway()},onOpenSettings:function(){this.OpenSelection()},OpenSelection:function(){var e=this;setTimeout(function(){e.Eway=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.EwayType",e);e.getView().addDependent(e.Eway);e.Eway.open()},1e3)},onCloseQueue:function(){oThat.Eway.close()},onNavBackEway:function(){this.oRouter.navTo("Inbound")},onPressNewEway:function(){u="X";this.getView().byId("id_segmentbtn").setSelectedKey("GEN");var e=this;sap.ui.core.BusyIndicator.show();var a={d:{IvProcess:"NEWLIST",QaListNav:[]}};this.getView().getModel().create("/QaLabelSet",a,{success:function(t,a){var i=new sap.ui.model.json.JSONModel;i.setData(t.QaListNav.results);e.getView().setModel(i,"JMEwayList");sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})},onPressEwayBillNewItem:function(e){oThat.oTableSelctedItem=e.getSource().getBindingContextPath();oThat.TableSelectedObject=e.getSource().getBindingContext("JMEwayList").getObject();oThat.oBjectItem=oThat.oView.getModel("JMEwayList").getObject(e.getSource().getBindingContextPath());var t=new sap.ui.model.json.JSONModel;t.setData(oThat.oBjectItem);oThat.getView().setModel(t,"JMEwayListBinding");oThat.getView().byId("id_SearchFieldWbid").setValue("");oThat.oRouter.navTo("EwayDetail",{lvWbid:oThat.oBjectItem.Wbid})},onCloseEwayGenerate:function(){oThat.EwayNew.close()},fnReprintDialog:function(){if(!oThat.EwayReprint){oThat.EwayReprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.ReprintEway",oThat);oThat.getView().addDependent(oThat.EwayReprint)}oThat.EwayReprint.open();sap.ui.getCore().byId("id_InEwayDate").setValue("");sap.ui.getCore().byId("id_InWbidReprint").setValue("");m=""},onClickReprintDecline:function(){oThat.EwayReprint.close()},fnclickReprinttoprint:function(){if(sap.ui.getCore().byId("id_InEwayDate").getValue()!==""){var e="/sap/opu/odata/sap/ZGW_GT_MM_WB_MOBILITY_SRV";var a="/QaLabelPrintSet(IvProcess='PRINT',IvWbid='"+m.Wbid+"',IvItem='"+m.Item+"')/$value";var i=e+a;if(sap.ui.Device.system.desktop){oThat.initiatePdfDialog();var r="<div><iframe src="+i+" width='100%' height='520'></iframe></div>";oThat.oImageDialog.getContent()[0].setContent(r);oThat.oImageDialog.addStyleClass("sapUiSizeCompact");oThat.oImageDialog.open()}else{window.open(i)}}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("ErrReprintDate"))}},initiatePdfDialog:function(){var e=this;e.oImageDialog=new sap.m.Dialog({title:"PDF",contentWidth:"100%",contentHeight:"",content:new sap.ui.core.HTML({}),beginButton:new sap.m.Button({text:"Close",class:"sapUiSizeCompact",press:function(){e.oImageDialog.close();if(oThat.EwayReprint){oThat.EwayReprint.close()}}})})},onPressUpdateEway:function(){this.onCloseQueue();u="Y";if(!oThat.EwayDetail){oThat.EwayDetail=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.GetEwayDet",oThat);oThat.getView().addDependent(oThat.EwayDetail)}oThat.EwayDetail.open()},onClickCloseGetDet:function(){oThat.EwayDetail.close()},onPressEwayBillUpdateItem:function(){if(!oThat.EwayUpdate){oThat.EwayUpdate=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.EwayUpdate",oThat);oThat.getView().addDependent(oThat.EwayUpdate)}oThat.EwayUpdate.open()},onCloseEwayUpdate:function(){oThat.EwayUpdate.close()},fnFilterEway:function(e){var t=e.getParameters("value").newValue;if(t){var a=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Batch",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Item",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter([a,i,r,o,n]);var d=sap.ui.getCore().byId("id_tablefiltereway").getBinding("items");d.filter([s],false)}else{var d=sap.ui.getCore().byId("id_tablefiltereway").getBinding("items");d.filter([])}},fnFilterEwayReprint:function(e){var t=e.getParameters("value").newValue;if(t){var a=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Batch",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Item",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter([a,i,r,o,n]);var d=sap.ui.getCore().byId("id_tablefilterReprint").getBinding("items");d.filter([s],false)}else{var d=sap.ui.getCore().byId("id_tablefilterReprint").getBinding("items");d.filter([])}},_handleConfirmWbid:function(e){m=e.getParameter("listItem").getBindingContext("JMUpdateWbid").getObject();this.SelectedWbid=e.getParameter("listItem").getBindingContext("JMUpdateWbid").getObject();t.confirm(this.getView().getModel("i18n").getResourceBundle().getText("MsgConfItem"),{icon:t.Icon.SUCCESS,actions:[t.Action.YES,t.Action.NO],onClose:function(e){if(e=="YES"){f="I"}else if(e=="NO"){f="A"}}});sap.ui.getCore().byId("id_InWbid").setValue(this.SelectedWbid.Wbid);oThat.f4Wbid1.close()},_handleConfirmWbidReprint:function(e){m=e.getParameter("listItem").getBindingContext("JMUpdateWbid").getObject();this.SelectedWbid=e.getParameter("listItem").getBindingContext("JMUpdateWbid").getObject();sap.ui.getCore().byId("id_InWbidReprint").setValue(this.SelectedWbid.Wbid);oThat.f4WbidReprint.close()},onCloseWbidf4:function(){oThat.f4Wbid1.close()},onCloseWbidf4Reprint:function(){oThat.f4WbidReprint.close()},loadZXingLibrary:function(){return new Promise((e,t)=>{var a=document.createElement("script");a.src=sap.ui.require.toUrl("ZGT_MM_INBOUND/ScannerAppLibrary/index.min.js");a.onload=e;a.onerror=t;document.head.appendChild(a)})},fnScanWbid:function(){f="";var e=this;var t=e.getView().getModel("i18n").getResourceBundle();var a=new i;if(ZXing!==undefined){this.loadZXingLibrary().then(()=>{d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(i=>{if(i.length>1){s=i[1].deviceId}else if(i.length===1){s=i[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){if(p!=="Y"){e.onScanBarcode(t.text.trim())}else{e.onScanWbidFilter(t.text.trim())}}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}if(i.length>=1){var r=[];i.forEach(i=>{var o={};o.text=i.label;o.value=i.deviceId;r.push(o);a.setData(r);this.getView().setModel(a,"oVideoDeviceModel");l=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:s,selectionChange:function(t){s=t.getSource().getSelectedKey();e._oScanQRDialog.close();d.reset()}});g=new sap.m.Button({text:t.getText("Start"),type:t.getText("Accept"),press:function(){e._oScanQRDialog.close();if(p!=="Y"){e.onScanBarcode(mResult.text.trim())}else{e.onScanWbidFilter(mResult.text.trim())}}});e.startScanning()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){if(p!=="Y"){e.onScanBarcode(t.text.trim())}else{e.onScanWbidFilter(t.text.trim())}}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}},startScanning:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var i=cordova.plugins.barcodeScanner;if(i){n=true}else{n=false}}catch(e){n=false}if(n===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){if(p!=="Y"){e.onScanBarcode(t.text.trim())}else{e.onScanWbidFilter(t.text.trim())}}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(s,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();if(p!=="Y"){e.onScanBarcode(mResult.text.trim())}else{e.onScanWbidFilter(mResult.text.trim())}}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){if(p!=="Y"){e.onScanBarcode(t.text.trim())}else{e.onScanWbidFilter(t.text.trim())}}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},fnClearFilter:function(e){var t=this;if(t.Scan){var a="";t.onScanBarcode(a);t.Scan=false}},fnSearchWbid:function(e){var t=e.getSource().getValue();if(u==="X"){var a=this.getView().byId("id_NewEwayTab")}else{var a=this.getView().byId("id_TabEwayUpdate")}if(t&&t.length>0){var i=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter([i])}var o=a.getBinding("items");o.filter(r)},fnSearchWbid1:function(e){var t=e.getSource().getValue();var a=this.getView().byId("id_TabEwayUpdate");if(t&&t.length>0){var i=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter([i])}var o=a.getBinding("items");o.filter(r)},onValueHelpBatch:function(){if(!oThat.EwayBatch){oThat.EwayBatch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.EwayBatch",oThat);oThat.getView().addDependent(oThat.EwayBatch)}oThat.EwayBatch.open()},onf4Wbid:function(){if(!oThat.f4Wbid){oThat.f4Wbid=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.QAUpdate",oThat);oThat.getView().addDependent(oThat.f4Wbid)}oThat.f4Wbid.open();sap.ui.getCore().byId("id_InEwayDate1").setValue("");sap.ui.getCore().byId("id_InWbid").setValue("")},getWbidDetails:function(){if(sap.ui.getCore().byId("id_InEwayDate1").getDateValue()<=new Date){sap.ui.getCore().byId("id_InEwayDate1").setValueState("None");var e=this;var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var i=a.format(new Date(sap.ui.getCore().byId("id_InEwayDate1").getDateValue()));var r={d:{IvProcess:"F4WBID",IvDate:i,F4QaWbidNav:[]}};sap.ui.core.BusyIndicator.show();this.getView().getModel().create("/QaLabelSet",r,{success:function(t,a){var i=new sap.ui.model.json.JSONModel;i.setData(t.F4QaWbidNav.results);e.getView().setModel(i,"JMUpdateWbid");sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{sap.ui.getCore().byId("id_InEwayDate1").setValueState("Error").setValueStateText(this.getView().getModel("i18n").getResourceBundle().getText("FutureDate"))}},getWbidDetailsforPrint:function(){if(sap.ui.getCore().byId("id_InEwayDate").getDateValue()<=new Date){sap.ui.getCore().byId("id_InEwayDate").setValueState("None");var e=this;var a=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var i=a.format(new Date(sap.ui.getCore().byId("id_InEwayDate").getDateValue()));var r={d:{IvProcess:"F4WBID",IvDate:i,F4QaWbidNav:[]}};sap.ui.core.BusyIndicator.show();this.getView().getModel().create("/QaLabelSet",r,{success:function(t,a){var i=new sap.ui.model.json.JSONModel;i.setData(t.F4QaWbidNav.results);e.getView().setModel(i,"JMUpdateWbid");sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{sap.ui.getCore().byId("id_InEwayDate").setValueState("Error").setValueStateText(this.getView().getModel("i18n").getResourceBundle().getText("FutureDate"))}},onWbidf4:function(){if(!oThat.f4Wbid1){oThat.f4Wbid1=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.WbidF4",oThat);oThat.getView().addDependent(oThat.f4Wbid1)}oThat.f4Wbid1.open()},onWbidf4Reprint:function(){if(sap.ui.getCore().byId("id_InEwayDate").getValue()!==""){if(!oThat.f4WbidReprint){oThat.f4WbidReprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.WbidReprint",oThat);oThat.getView().addDependent(oThat.f4WbidReprint)}oThat.f4WbidReprint.open()}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("ErrReprintDate"))}},onValueHelpConfirmBatch:function(){var e=oEvent.getParameter("selectedItem");this.getView().byId("id_InBatchUdateLabel").setValue(e.getTitle())},onValueHelpConfirmWbid:function(){var e=oEvent.getParameter("selectedItem");lvwbid=e.getTitle();this.getView().byId("id_InWbid").setValue(e.getTitle())},onClickUpdateDecline:function(){sap.ui.getCore().byId("id_InEwayDate1").setValue("");sap.ui.getCore().byId("id_InWbid").setValue("");oThat.f4Wbid.close()},_handleConfirmBatch:function(e){this.SelectedRefObj=e.getParameter("listItem").getBindingContext("JMEwayList").getObject();this.getView().getModel("JMEwayListBinding").getData().Matnr=this.SelectedRefObj.Matnr;this.getView().getModel("JMEwayListBinding").refresh();oThat.EwayBatch.close()},fnBatchSearch:function(e){var t=e.getSource().getValue();if(t){var a=new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter([a]);var r=sap.ui.getCore().byId("id_BatchSelectTab").getBinding("items");r.filter([i],false)}else{var r=sap.ui.getCore().byId("id_BatchSelectTab").getBinding("items");r.filter([])}},fnCloseBatch:function(){oThat.EwayBatch.close()},onF4BatchQA:function(){if(!oThat.f4QAbatch){oThat.f4QAbatch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.BatchQA",oThat);oThat.getView().addDependent(oThat.f4QAbatch)}oThat.f4QAbatch.open()},onScanBarcode:function(e){if(e!==""&&e.sId!=="press"){}else{e=sap.ui.getCore().byId("id_InWbid").getValue()}if(e!==""){var a=this;var i={d:{IvProcess:"GETQAID",IvWbid:e,WbItemNav:[],StatusLogNav:[],WbHeaderNav:[],WbPackMatNav:[],ReturnNav:[]}};sap.ui.core.BusyIndicator.show();this.getView().getModel().create("/QaLabelSet",i,{success:function(e,i){if(e.ReturnNav.results[0].Type==="S"){var r=new sap.ui.model.json.JSONModel;r.setData(e.WbHeaderNav.results);a.getView().setModel(r,"JMQALableUpdateHeader");var o=new sap.ui.model.json.JSONModel;o.setData(e.WbPackMatNav.results);a.getView().setModel(o,"JMPackMatItem");if(f==="I"){var n=[];for(var s=0;s<e.WbItemNav.results.length;s++){if(e.WbItemNav.results[s].Wbid===m.Wbid&&e.WbItemNav.results[s].Item===m.Item){n.push(e.WbItemNav.results[s])}}var d=new sap.ui.model.json.JSONModel;d.setData(n);a.getView().setModel(d,"JMQALableUpdateItem")}else{var d=new sap.ui.model.json.JSONModel;d.setData(e.WbItemNav.results);a.getView().setModel(d,"JMQALableUpdateItem")}var l=new sap.ui.model.json.JSONModel;l.setData(e.StatusLogNav.results);a.getView().setModel(l,"JMQALableUpdateStatus");var g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd.MM.yyyy"});a.getView().byId("id_ewaydate").setValue(g.format(new Date(e.StatusLogNav.results[0].Bmcnu)));var c=a.getView().getModel("JMQALableUpdateItem").getData();for(var s=0;s<c.length;s++){for(var u=0;u<e.StatusLogNav.results.length;u++){if(e.StatusLogNav.results[u].Trnsid===e.WbItemNav.results[s].Wbid&&e.WbItemNav.results[s].Item===e.StatusLogNav.results[u].Helperid){c[s].Dwerk=e.StatusLogNav.results[u].SendRef;c[s].Pmat2=e.StatusLogNav.results[u].RecRef;a.getView().getModel("JMQALableUpdateItem").refresh()}}}if(oThat.f4Wbid){oThat.f4Wbid.close()}sap.ui.core.BusyIndicator.hide()}else{t.error(e.ReturnNav.results[0].Message);sap.ui.core.BusyIndicator.hide()}},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("WbIdErr"))}},fnSegmentedChange:function(){if(this.getView().byId("id_segmentbtn").getSelectedKey()=="UPD"){this.getView().byId("id_updBtn").setVisible(true);this.getView().byId("id_updCheck").setVisible(true);this.getView().setModel(new i({}),"JMQALableUpdateHeader");this.getView().setModel(new i({}),"JMQALableUpdateItem");this.getView().setModel(new i({}),"JMQALableUpdateStatus");p=""}else{this.getView().byId("id_updBtn").setVisible(false);this.getView().byId("id_updCheck").setVisible(false)}},fnUpdateQALable:function(){sap.ui.core.BusyIndicator.show();var e=this;var a=this.getView().getModel("JMQALableUpdateHeader").getData();var i=this.getView().getModel("JMQALableUpdateItem").getData();var r=this.getView().getModel("JMQALableUpdateStatus").getData();var o=this.getView().getModel("JMPackMatItem").getData();var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var s=n.format(new Date(this.getView().byId("id_ewaydate").getDateValue()));var d=false;var l="";for(var g=0;g<i.length;g++){for(var c=g+1;c<i.length;c++){if(i[g].Batch.toUpperCase()===i[c].Batch.toUpperCase()){d=true;l=this.getView().getModel("i18n").getResourceBundle().getText("ErrSameBatch")+"\n";break}}}if(this.getView().byId("id_ewaydate").getValue()===""){d=true;l=this.getView().getModel("i18n").getResourceBundle().getText("ErrEway")+"\n"}if(s===""){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayDate")+"\n"}var u;for(var g=0;g<i.length;g++){u=i[g].Item;if(i[g].Batch===""){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrBatch")+u+"\n"}if(i[g].Config1===""||i[g].Config1==="0.000"){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayQty")+u+"\n"}if(i[g].Config4===""){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayUom")+u+"\n"}}for(var g=0;g<o.length;g++){u=o[g].Item;if(o[g].Pmat===""){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackMat")+" "+u+"\n"}if(o[g].PmatNo<=0){d=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackQnty")+" "+u+"\n"}}if(!d){if(r.length>0){var m=r[0].CarteGrise}else{var m=r.CarteGrise}var h=[];for(var f=0;f<i.length;f++){var p={Trnsid:a[0].Wbid,Item:i[f].Item,CarteGrise:m,Bmcnu:s.toString(),SendRef:i[f].Dwerk,RecRef:i[f].Pmat2,Werks:i[f].Werks};h.push(p)}for(var v=0;v<i.length;v++){if(i[v].Ebeln==="N/A"){i[v].Ebeln=""}}this.getView().getModel("JMQALableUpdateItem").refresh("true");var w={d:{IvProcess:"UPDATEQA",ReturnNav:[],WbItemNav:i,StatusLogNav:h,WbHeaderNav:a,WbPackMatNav:o}};this.getView().getModel().create("/QaLabelSet",w,{success:function(a,i){if(a.ReturnNav.results[0].Type==="S"){e.getView().byId("id_ewaydate").setValue("");sap.ui.core.BusyIndicator.hide();t.success(a.ReturnNav.results[0].Message,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(i){if(i=="OK"){e.fnClear();t.show(e.getView().getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:e.getView().getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){var i=a.WbHeaderNav.results[0].Wbid;var r="0000";var o="/sap/opu/odata/sap/ZGW_GT_MM_WB_MOBILITY_SRV";var n="/QaLabelPrintSet(IvProcess='PRINT',IvWbid='"+a.WbHeaderNav.results[0].Wbid+"',IvItem='"+r+"')/$value";var s=o+n;if(sap.ui.Device.system.desktop){e.initiatePdfDialog();var d="<div><iframe src="+s+" width='100%' height='520'></iframe></div>";e.oImageDialog.getContent()[0].setContent(d);e.oImageDialog.addStyleClass("sapUiSizeCompact");e.oImageDialog.open()}else{window.open(s)}}else if(t==="NO"){e.oRouter.navTo("EwayBill")}}})}}})}else{var r=a.ReturnNav.results.length;var o="";for(var n=0;n<r;n++){o=o+a.ReturnNav.results[n].Message+"\n"}t.error(o)}},error:function(a){e.fnClear();sap.ui.core.BusyIndicator.hide();t.error(a.message)}})}else{t.error(l)}},fnClear:function(){this.getView().getModel("JMQALableUpdateHeader").setData("");this.getView().getModel("JMQALableUpdateItem").setData("");this.getView().getModel("JMQALableUpdateStatus").setData("")},fnCheckUpdate:function(){sap.ui.core.BusyIndicator.show();var e=this;var a=this.getView().getModel("JMQALableUpdateHeader").getData();var i=this.getView().getModel("JMQALableUpdateItem").getData();var r=this.getView().getModel("JMQALableUpdateStatus").getData();var o=this.getView().getModel("JMPackMatItem").getData();var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var s=n.format(new Date(this.getView().byId("id_ewaydate").getDateValue()));var d=[];var l=false;var g="";for(var c=0;c<i.length;c++){for(var u=c+1;u<i.length;u++){if(i[c].Batch.toUpperCase()===i[u].Batch.toUpperCase()){l=true;g=this.getView().getModel("i18n").getResourceBundle().getText("ErrSameBatch")+"\n";break}}}if(this.getView().byId("id_ewaydate").getDateValue()===""){l=true;g=this.getView().getModel("i18n").getResourceBundle().getText("ErrEway")+"\n"}if(s===""){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayDate")+"\n"}var m;for(var c=0;c<i.length;c++){m=i[c].Item;if(i[c].Batch===""){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrBatch")+" "+m+"\n"}if(i[c].Config1===""||i[c].Config1==="0.000"){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayQty")+" "+m+"\n"}if(i[c].Config4===""){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayUom")+" "+m+"\n"}}for(var c=0;c<o.length;c++){m=o[c].Item;if(o[c].Pmat===""){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackMat")+" "+m+"\n"}if(o[c].PmatNo<=0){l=true;g=g+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackQnty")+" "+m+"\n"}}if(!l){if(r.length>0){var h=r[0].CarteGrise}else{var h=r.CarteGrise}for(var f=0;f<i.length;f++){var p={Trnsid:a[0].Wbid,Item:i[f].Item,CarteGrise:h,Bmcnu:s.toString(),SendRef:i[f].Dwerk,RecRef:i[f].Pmat2,Werks:i[f].Werks};d.push(p)}var v={d:{IvProcess:"CHECKUPDAT",ReturnNav:[],WbItemNav:i,StatusLogNav:d,WbHeaderNav:a,WbPackMatNav:o}};this.getView().getModel().create("/QaLabelSet",v,{success:function(e,a){if(e.ReturnNav.results[0].Type==="S"){t.success(e.ReturnNav.results[0].Message,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(e){if(e=="OK"){}}});sap.ui.core.BusyIndicator.hide()}else{var i=e.ReturnNav.results.length;var r="";for(var o=0;o<i;o++){r=r+e.ReturnNav.results[o].Message+"\n"}t.error(r)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{sap.ui.core.BusyIndicator.hide();t.error(g)}},fnlivechangeOnlyNumber:function(e){var t=e.getSource();var a=t.getValue();a=a.replace(/[^\d]/g,"");t.setValue(a)},fnFilterWbid:function(e){var t=e.getParameters("value").newValue;if(t){var a=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter([a,i]);var o=this.getView().byId("id_NewEwayTab").getBinding("items");o.filter([r],false)}else{var o=this.getView().byId("id_NewEwayTab").getBinding("items");o.filter([])}},fnSearchScanWbid:function(){p="Y";this.fnScanWbid()},onScanWbidFilter:function(e){var t=this;t.Scan=true;var a=e;var i=this.getView().byId("id_NewEwayTab");if(a&&a.length>0){var r=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,a);var o=new sap.ui.model.Filter([r])}var n=i.getBinding("items");n.filter(o)},fnClearFilter:function(e){var t=this;if(t.Scan){var a="";t.onScanWbidFilter(a);t.getView().byId("id_SearchFieldWbid").setValue("");t.Scan=false}},fnValidateEwayQty:function(e){var t=this.getView().getModel("JMQALableUpdateItem").getData();var a=e.getSource().getBindingContext("JMQALableUpdateItem").getPath();var i=a.split("/");var r=i[1];if(Number(e.mParameters.value).toString().length<=13){t[r].Config1=Number(t[r].Config1).toFixed(3)}else{t[r].Config1="";this.getView().getModel("JMQALableUpdateItem").refresh("true");MessageToast.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}},onF4PackMatType:function(e){if(!this.fragPackmat){this.fragPackmat=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PackingMat",this);this.getView().addDependent(this.fragPackmat)}var t=e.getSource().getBindingContext("JMPackItem").getPath();var a=t.split("/");h=a[1];this.fngetPackMat();this.fragPackmat.open()},fngetPackMat:function(){sap.ui.core.BusyIndicator.show();var e=this;var a={d:{IvProcess:"PACKMATF4",PackMatNav:[],ReturnNav:[],IvWbid:e.getView().getModel("JMQALableUpdateItem").getData()[0].Wbid,IvItem:this.getView().getModel("JMPackItem").getData()[0].Item}};this.getView().getModel().create("/QaLabelSet",a,{success:function(t,a){var i=new sap.ui.model.json.JSONModel;i.setData(t.PackMatNav.results);e.getView().setModel(i,"JMPackMat");sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})},onValueHelpSearchPack:function(e){var t=e.getParameter("value");var a;if(t==undefined){t=""}a=new sap.ui.model.Filter([new r("Bagtyp",sap.ui.model.FilterOperator.Contains,t)]);var i=new sap.ui.model.Filter(a,false);var o=e.getSource().getBinding("items");o.filter([i])},onValueHelpConfirmPackMat:function(e){var t=e.getParameter("selectedItem");var a=this.getView().getModel("JMPackItem").getData();var t=e.getParameter("selectedItem");a[h].Pmat=t.getTitle();this.getView().getModel("JMPackItem").refresh("true")},fnOpenPackingMaterialDetail:function(e){if(!this.Packingmat){this.Packingmat=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PackingDetail",this);this.getView().addDependent(this.Packingmat)}this.Packingmat.open();var t=e.getSource().getBindingContext("JMQALableUpdateItem").getPath();var a=this.getView().getModel("JMQALableUpdateItem").getData();var i=this.getView().getModel("JMPackMatItem").getData();var r=t.split("/");v=r[1];var o=[];for(var n=0;n<i.length;n++){if(a[v].Item===i[n].Item){o.push(i[n])}}M=o.length;var s=new sap.ui.model.json.JSONModel;s.setData(o);this.getView().setModel(s,"JMPackItem")},closePackMatDetailshDialog:function(){this.Packingmat.close()},onSavePackMAtDetails:function(){this.Packingmat.close()},fnLivechangePackingTare:function(e){if(e.mParameters.value!==""){var t=this.getView().getModel("JMPackItem").getData();var a=e.getSource().getBindingContext("JMPackItem").getPath();var i=a.split("/");var r=i[1];if(Number(e.mParameters.value).toString().length<=7){t[r].PmatWt=Number(e.mParameters.value).toFixed(3);t[r].TotPmatWt=Number(t[r].PmatWt*t[r].PmatNo).toFixed(3);this.getView().getModel("JMPackItem").refresh(true)}else{var o="0";t[v].PmatWt=Number(o).toFixed(3);t[r].TotPmatWt=Number(t[r].PmatWt*t[r].PmatNo).toFixed(3);MessageToast.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}}},fnLivechangePackingQty:function(e){if(e.mParameters.value!==""){var t=this.getView().getModel("JMPackItem").getData();var a=e.getSource().getBindingContext("JMPackItem").getPath();var i=a.split("/");var r=i[1];if(t[r].Brgew===""){t[r].Brgew=0}if(t[r].Ntgew===""){t[r].Ntgew=0}if(Number(e.mParameters.value).toString().length<=7){t[r].PmatNo=Number(e.mParameters.value);t[r].TotPmatWt=Number(t[r].PmatWt*t[r].PmatNo).toFixed(3);t[r].PmatNo=Number(e.mParameters.value).toString();this.getView().getModel("JMPackItem").refresh(true)}else{var o="0";t[r].PmatNo=Number(o).toFixed(3);t[r].TotPmatWt=Number(t[r].PmatWt*t[r].PmatNo).toFixed(3);this.getView().getModel("JMTMPItem").refresh(true);t[r].PmatNo=Number(o).toString();MessageToast.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}}},fnAddItem:function(e){var t=e.getSource().getBindingContext("JMWsHeader").getObject();var a=this.getView().getModel("JMWsHeader").getData();var i={GrossPackMatWt:t.GrossPackMatWt,Brgew:t.Brgew,Ntgew:t.Ntgew,MatUom:t.MatUom,Matnr:t.Matnr,Batch:t.Batch,Item:lv_temItem};a.push(i);this.getView().getModel("JMWsHeader").setData(a);this.getView().getModel("JMWsHeader").refresh(true);for(var r=0;r<MatItem_len;r++){var o={Item:lv_temItem,Pmat:copyDataItem[r].Pmat,PmatNo:copyDataItem[r].PmatNo,PmatWt:copyDataItem[r].PmatWt,TotPmatWt:copyDataItem[r].TotPmatWt,PackMatUom:copyDataItem[r].PackMatUom};copyDataItem.push(o)}this.getView().getModel("JMWsItem").setData(copyDataItem);this.getView().getModel("JMWsItem").refresh(true);for(var n=0;n<a.length;n++){lv_netWeight=Number(lv_netWeight)+Number(a[n].Ntgew);lv_grossWt=Number(lv_grossWt)+Number(a[n].Brgew);tot_pacwtg=Number(tot_pacwtg)+Number(a[n].GrossPackMatWt)}this.getView().byId("id_pacmatQty").setText(Number(tot_pacwtg).toFixed(3));this.getView().byId("id_Grossweight").setText(Number(lv_grossWt).toFixed(3));this.getView().byId("id_Netweight").setText(Number(lv_netWeight).toFixed(3))},onItemDelete:function(e){var a=0;var i=0;var r=0;var o=this.getView().getModel("JMWsHeader");var n=this.getView().getModel("JMWsHeader").getData();var s=[];var d=this.getView().getModel("JMWsItem").getData();var l=this.getView().getModel("JMTMPItem").getData();var g=o.getData();var c=e.getSource().getBindingContext("JMWsHeader").getObject();var u=this,m=this;if(g.length>1){var h=e.getSource().getBindingContext("JMWsHeader").getPath();var f=h.split("/");var p=f[1];var v=0;for(var w=0;w<d.length;w++){if(n[p].Item===d[w].Item){s.push(d[w])}}for(var M=0;M<d.length;M++){for(var I=0;I<s.length;I++){if(d[M].Item===s[I].Item){d.splice(M,1)}}}g.splice(f[1],1);o.setData(g);o.refresh(true);var b=0;for(var y=0;y<n.length;y++){b++;for(var V=0;V<d.length;V++){if(n[y].Item===d[V].Item){if(b<9){d[V].Item="0000"+b}else if(b>=99&&b<999){d[V].Item="00"+b}else if(b>=999){d[V].Item="0"+b}else{d[V].Item="000"+b}}}if(b<9){n[y].Item="0000"+b}else if(b>=99&&b<999){n[y].Item="00"+b}else if(b>=999){n[y].Item="0"+b}else{n[y].Item="000"+b}}this.getView().getModel("JMWsHeader").refresh("true");this.getView().getModel("JMWsItem").refresh("true");for(var T=0;T<n.length;T++){a=Number(a)+Number(n[T].Ntgew);i=Number(i)+Number(n[T].Brgew);r=Number(r)+Number(n[T].GrossPackMatWt)}this.getView().byId("id_pacmatQty").setText(Number(r).toFixed(3));this.getView().byId("id_Grossweight").setText(Number(i).toFixed(3));this.getView().byId("id_Netweight").setText(Number(a).toFixed(3))}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("Singledel"))}},onUOMf4:function(e){var t=this;if(!t.f4Uom){t.f4Uom=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Uom",t);t.getView().addDependent(t.f4Uom)}var a=e.getSource().getBindingContext("JMQALableUpdateItem").getPath().split("/");t.fnUomData(a);t.f4Uom.open()},fnUomData:function(e){var a=this;var i=this.getView().getModel("JMQALableUpdateItem").getData();w=e[1];sap.ui.core.BusyIndicator.show();var o=[new r("ImMatnr",sap.ui.model.FilterOperator.EQ,i[w].Matnr),new r("Uom",sap.ui.model.FilterOperator.EQ,"X")];this.getView().getModel().read("/F4ParametersSet",{filters:o,urlParameters:{$expand:"F4UomNav"},success:function(e,t){var i=new sap.ui.model.json.JSONModel;i.setData(e.results[0].F4UomNav.results);a.getView().setModel(i,"UOM");sap.ui.core.BusyIndicator.hide()},error:function(e){t.error(e);sap.ui.core.BusyIndicator.hide()}})},onValueHelpConfirmUom:function(e){var t=e.getParameter("selectedItem");this.getView().getModel("JMQALableUpdateItem").getData()[w].Config4=t.getTitle();this.getView().getModel("JMQALableUpdateItem").refresh("true")},fnAddItem:function(e){if(M<3){var a=e.getSource().getBindingContext("JMPackItem").getObject();var i=this.getView().getModel("JMPackItem").getData();var r=this.getView().getModel("JMPackMatItem").getData();var o={Pmat:a.Pmat,PmatWt:a.PmatWt,PmatNo:a.PmatNo,TotPmatWt:a.TotPmatWt,PackMatUom:a.PackMatUom,Item:a.Item};i.push(o);r.push(o);this.getView().getModel("JMPackItem").refresh(true);this.getView().getModel("JMPackMatItem").refresh(true);M++}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("AddItemErr"))}},onItemDelete:function(e){var a=this.getView().getModel("JMPackItem");var i=a.getData();var r=this.getView().getModel("JMPackMatItem").getData();var o=e.getSource().getBindingContext("JMPackItem").getObject();var n=this;if(i.length>1){var s=e.getSource().getBindingContext("JMPackItem").getPath();var d=s.split("/");var l=d[1];for(var g=0;g<r.length;g++){if(o.Item===r[g].Item&&o.TotPmatWt===r[g].TotPmatWt&&o.Pmat===r[g].Pmat&&o.PmatWt===r[g].PmatWt&&o.PmatNo===r[g].PmatNo){r.splice(g,1);break}}i.splice(d[1],1);a.setData(i);a.refresh(true);this.getView().getModel("JMPackMatItem").refresh("true");M=this.getView().getModel("JMPackMatItem").getData().length}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("Singledel"))}}})});
//# sourceMappingURL=EwayBill.controller.js.map