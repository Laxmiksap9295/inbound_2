sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/core/Fragment","sap/m/MessageToast"],function(e,t,a,r,i,o,n){"use strict";var s;var g;var l=this;var u;var d;var c;var m=0;return e.extend("ZGT_MM_INBOUND.controller.EwayDetail",{onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("EwayDetail").attachMatched(this._onRouteMatched,this);var e=this;u=sap.ui.core.format.DateFormat.getDateInstance({pattern:"dd-MM-YYYY"});e.oDisplayIN={Ebeln:"214193000631"};var t={SearchCrit:[{Name:"00001"},{Name:"00002"},{Name:"00003"}]};var a=new sap.ui.model.json.JSONModel;a.setData(t);this.getView().setModel(a,"POPRItem");e.getView().setModel(new r({}),"JMQALableGen");var i={CarteGrise:"",Bmcnu:""};var o=new sap.ui.model.json.JSONModel;o.setData(i);this.getView().setModel(o,"JMQALableGenerateStatus")},_onRouteMatched:function(e){s=e.getParameters().arguments.lvWbid;sap.ui.core.BusyIndicator.show();this.fngetWidData()},fngetWidData:function(){var e=this;var a={d:{IvProcess:"NEWWBID",IvWbid:s,ReturnNav:[],WbItemNav:[],StatusLogNav:[],WbHeaderNav:[],WbPackMatNav:[]}};this.getView().getModel().create("/QaLabelSet",a,{success:function(t,a){var r=new sap.ui.model.json.JSONModel;r.setData(t.WbHeaderNav.results);e.getView().setModel(r,"JMQALableGenerateHeader");var i=new sap.ui.model.json.JSONModel;i.setData(t.WbItemNav.results);e.getView().setModel(i,"JMQALableGenerateItem");var o=new sap.ui.model.json.JSONModel;o.setData(t.StatusLogNav.results);e.getView().setModel(o,"JMQALableGenerateStatus");var n=new sap.ui.model.json.JSONModel;n.setData(t.WbPackMatNav.results);e.getView().setModel(n,"JMPackMatItem");e.getView().byId("id_ewaydate").setDateValue(new Date);sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})},fnSubmitQALabel:function(){var e=this;var a=this.getView().getModel("JMQALableGenerateHeader").getData();var r=this.getView().getModel("JMQALableGenerateItem").getData();var i=this.getView().getModel("JMQALableGenerateStatus").getData();var o=this.getView().getModel("JMPackMatItem").getData();var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var s=n.format(this.getView().byId("id_ewaydate").getDateValue());var g=false;var l="";if(this.getView().byId("id_EwayID").getValue()===""){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEway")+"\n"}if(s===""){g=true;l=this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayDate")+"\n"}for(var u=0;u<r.length;u++){for(var d=u+1;d<r.length;d++){if(r[u].Batch!==""||r[d].Batch!==""){if(r[u].Batch.toUpperCase()===r[d].Batch.toUpperCase()&&r[u].NoBatchValidate===""){g=true;l=this.getView().getModel("i18n").getResourceBundle().getText("ErrSameBatch")+"\n";break}}}}var c;for(var u=0;u<r.length;u++){c=r[u].Item;if(r[u].Batch===""){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrBatch")+" "+c+"\n"}if(r[u].Config1===""||r[u].Config1==="0.000"){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayQty")+" "+c+"\n"}if(r[u].Config4===""){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayUom")+" "+c+"\n"}}for(var u=0;u<o.length;u++){c=o[u].Item;if(o[u].Pmat===""){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackMat")+" "+c+"\n"}if(o[u].PmatNo<=0){if(o[u].Pmat!==this.getView().getModel("i18n").getResourceBundle().getText("NA")){g=true;l=l+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackQnty")+" "+c+"\n"}}}if(!g){var m=[];for(var h=0;h<r.length;h++){var v={Trnsid:a[0].Wbid,Item:r[h].Item,CarteGrise:i.CarteGrise,Bmcnu:s.toString(),SendRef:r[h].Dwerk,RecRef:r[h].Pmat2,Werks:r[h].Werks};m.push(v)}for(var M=0;M<r.length;M++){if(r[M].Ebeln==="N/A"){r[M].Ebeln=""}}this.getView().getModel("JMQALableGenerateItem").refresh("true");var f={d:{IvProcess:"CREATEQA",ReturnNav:[],WbItemNav:r,StatusLogNav:m,WbHeaderNav:a,WbPackMatNav:o}};sap.ui.core.BusyIndicator.show();this.getView().getModel().create("/QaLabelSet",f,{success:function(a,r){if(a.ReturnNav.results[0].Type==="S"){var i=a.ReturnNav.results.length;var o="";for(var n=0;n<i;n++){o=o+a.ReturnNav.results[n].Message+"\n"}t.success(o,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(r){if(r=="OK"){t.show(e.getView().getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:e.getView().getModel("i18n").getResourceBundle().getText("Title16"),escapeHandler:"onNavBackEwayDet",actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){var r=a.WbHeaderNav.results[0].Wbid;var i="/sap/opu/odata/sap/ZGW_GT_MM_WB_MOBILITY_SRV";var o="0000";var n="/QaLabelPrintSet(IvProcess='PRINT',IvWbid='"+a.WbHeaderNav.results[0].Wbid+"',IvItem='"+o+"')/$value";var s=i+n;if(sap.ui.Device.system.desktop){e.initiatePdfDialog();var g="<div><iframe src="+s+" width='100%' height='520'></iframe></div>";e.oImageDialog.getContent()[0].setContent(g);e.oImageDialog.addStyleClass("sapUiSizeCompact");e.oImageDialog.open()}else{window.open(s)}}else if(t==="NO"){e.oRouter.navTo("EwayBill")}}})}}})}else{var s=a.ReturnNav.results.length;var g="";for(var n=0;n<s;n++){g=g+a.ReturnNav.results[n].Message+"\n"}t.error(g)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{t.error(l)}},onNavBackEwayDet:function(){this.oRouter.navTo("EwayBill")},initiatePdfDialog:function(){var e=this;e.oImageDialog=new sap.m.Dialog({title:"PDF",contentWidth:"100%",contentHeight:"",content:new sap.ui.core.HTML({}),beginButton:new sap.m.Button({text:"Close",class:"sapUiSizeCompact",press:function(){e.oImageDialog.close();e.oRouter.navTo("EwayBill")}})})},fncheck:function(){var e=this;var a=this.getView().getModel("JMQALableGenerateHeader").getData();var r=this.getView().getModel("JMQALableGenerateItem").getData();var i=this.getView().getModel("JMQALableGenerateStatus").getData();var o=this.getView().getModel("JMPackMatItem").getData();var n=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddThh:mm:ss"});var s=n.format(this.getView().byId("id_ewaydate").getDateValue());var g=[];var l=false;var u="";if(this.getView().byId("id_EwayID").getValue()===""){l=true;u=this.getView().getModel("i18n").getResourceBundle().getText("ErrEway")+"\n"}if(s===""){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayDate")+"\n"}for(var d=0;d<r.length;d++){for(var c=d+1;c<r.length;c++){if(r[d].Batch!==""||r[c].Batch!==""){if(r[d].Batch.toUpperCase()===r[c].Batch.toUpperCase()&&r[d].NoBatchValidate===""){l=true;u=this.getView().getModel("i18n").getResourceBundle().getText("ErrSameBatch")+"\n";break}}}}var m;for(var d=0;d<r.length;d++){m=r[d].Item;if(r[d].Batch===""){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrBatch")+" "+m+"\n"}if(r[d].Config1===""||r[d].Config1==="0.000"){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayQty")+" "+m+"\n"}if(r[d].Config4===""){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrEwayUom")+" "+m+"\n"}}for(var d=0;d<o.length;d++){m=o[d].Item;if(o[d].Pmat===""){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackMat")+" "+m+"\n"}if(o[d].PmatNo<=0){if(o[d].Pmat!==this.getView().getModel("i18n").getResourceBundle().getText("NA")){l=true;u=u+this.getView().getModel("i18n").getResourceBundle().getText("ErrPackQnty")+" "+m+"\n"}}}if(!l){for(var h=0;h<r.length;h++){var v={Trnsid:a[0].Wbid,Item:r[h].Item,CarteGrise:i.CarteGrise,Bmcnu:s.toString(),SendRef:r[h].Dwerk,RecRef:r[h].Pmat2,Werks:r[h].Werks};g.push(v)}var M={d:{IvProcess:"CHECKCREAT",ReturnNav:[],WbItemNav:r,StatusLogNav:g,WbHeaderNav:a,WbPackMatNav:o}};sap.ui.core.BusyIndicator.show();this.getView().getModel().create("/QaLabelSet",M,{success:function(e,a){if(e.ReturnNav.results[0].Type==="S"){t.success(e.ReturnNav.results[0].Message,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(e){if(e=="OK"){}}});sap.ui.core.BusyIndicator.hide()}else{var r=e.ReturnNav.results.length;var i="";for(var o=0;o<r;o++){i=i+e.ReturnNav.results[o].Message+"\n"}t.error(i)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}else{t.error(u)}},onUOMf4:function(e){var t=this;if(!t.f4Uom){t.f4Uom=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Uom",t);t.getView().addDependent(t.f4Uom)}var a=e.getSource().getBindingContext("JMQALableGenerateItem").getPath().split("/");t.fnUomData(a);t.f4Uom.open()},fnUomData:function(e){var a=this;var r=this.getView().getModel("JMQALableGenerateItem").getData();g=e[1];sap.ui.core.BusyIndicator.show();var o=[new i("ImMatnr",sap.ui.model.FilterOperator.EQ,r[g].Matnr),new i("Uom",sap.ui.model.FilterOperator.EQ,"X")];this.getView().getModel().read("/F4ParametersSet",{filters:o,urlParameters:{$expand:"F4UomNav"},success:function(e,t){var r=new sap.ui.model.json.JSONModel;r.setData(e.results[0].F4UomNav.results);a.getView().setModel(r,"UOM");sap.ui.core.BusyIndicator.hide()},error:function(e){t.error(e);sap.ui.core.BusyIndicator.hide()}})},onValueHelpConfirmUom:function(e){var t=e.getParameter("selectedItem");this.getView().getModel("JMQALableGenerateItem").getData()[g].Config4=t.getTitle();this.getView().getModel("JMQALableGenerateItem").refresh(true)},fnlivechangeOnlyNumber:function(e){var t=e.getSource();var a=t.getValue();a=a.replace(/[^\d]/g,"");t.setValue(a)},handleChangeDate:function(e){var t=this.getView();var a=t.byId("id_ewaydate").getDateValue();var r=t.getModel("i18n");if(a>new Date){t.byId("id_ewaydate").setValueState("Error").setValueStateText(r.getProperty("FutureDate"))}else{t.byId("id_ewaydate").setValueState("None")}},handleChangeDateReprint:function(e){var t=this.getView();var a=t.byId("id_InEwayDate").getDateValue();var r=t.getModel("i18n");if(u.format(new Date(a))>u.format(new Date)){t.byId("id_InEwayDate").setValueState("Error").setValueStateText(r.getProperty("FutureDate"))}else{t.byId("id_InEwayDate").setValueState("None")}},fnValidateEwayQty:function(e){var t=this.getView().getModel("JMQALableGenerateItem").getData();var a=e.getSource().getBindingContext("JMQALableGenerateItem").getPath();var r=a.split("/");var i=r[1];if(Number(e.mParameters.value).toString().length<=13){t[i].Config1=Number(t[i].Config1).toFixed(3)}else{t[i].Config1="";this.getView().getModel("JMQALableGenerateItem").refresh("true");n.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}},onF4PackMatType:function(e){if(!this.fragPackmat){this.fragPackmat=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PackingMat",this);this.getView().addDependent(this.fragPackmat)}var t=e.getSource().getBindingContext("JMPackItem").getPath();var a=t.split("/");d=a[1];this.fngetPackMat();this.fragPackmat.open()},fngetPackMat:function(){sap.ui.core.BusyIndicator.show();var e=this;var a={d:{IvProcess:"PACKMATF4",PackMatNav:[],ReturnNav:[],IvWbid:this.getView().getModel("JMQALableGenerateHeader").getData()[0].Wbid,IvItem:this.getView().getModel("JMPackItem").getData()[0].Item}};this.getView().getModel().create("/QaLabelSet",a,{success:function(t,a){var r=new sap.ui.model.json.JSONModel;r.setData(t.PackMatNav.results);e.getView().setModel(r,"JMPackMat");sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})},onValueHelpSearchPack:function(e){var t=e.getParameter("value");var a;if(t==undefined){t=""}a=new sap.ui.model.Filter([new i("Bagtyp",sap.ui.model.FilterOperator.Contains,t)]);var r=new sap.ui.model.Filter(a,false);var o=e.getSource().getBinding("items");o.filter([r])},onValueHelpUomSearch:function(e){var t=e.getParameter("value");var a;if(t==undefined){t=""}a=new sap.ui.model.Filter([new i("Meinh",sap.ui.model.FilterOperator.Contains,t)]);var r=new sap.ui.model.Filter(a,false);var o=e.getSource().getBinding("items");o.filter([r])},onValueHelpConfirmPackMat:function(e){var t=e.getParameter("selectedItem");var a=this.getView().getModel("JMPackItem").getData();var t=e.getParameter("selectedItem");a[d].Pmat=t.getTitle();this.getView().getModel("JMPackItem").refresh("true")},fnLiveChangeEwayValidate:function(e){var t=e.getSource();var a=t.getValue();a=a.replace(/[^a-zA-Z0-9 ]/g,"");t.setValue(a.toUpperCase())},fnReprintDialog:function(){if(!this.EwayReprint){this.EwayReprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.ReprintGen",this);this.getView().addDependent(l.EwayReprint)}this.EwayReprint.open()},fnOpenPackingMaterialDetail:function(e){if(!this.Packingmat){this.Packingmat=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PackingDetail",this);this.getView().addDependent(this.Packingmat)}this.Packingmat.open();var t=e.getSource().getBindingContext("JMQALableGenerateItem").getPath();var a=this.getView().getModel("JMQALableGenerateItem").getData();var r=this.getView().getModel("JMPackMatItem").getData();var i=t.split("/");c=i[1];var o=[];for(var n=0;n<r.length;n++){if(a[c].Item===r[n].Item){o.push(r[n])}}m=o.length;var s=new sap.ui.model.json.JSONModel;s.setData(o);this.getView().setModel(s,"JMPackItem")},closePackMatDetailshDialog:function(){this.Packingmat.close();m=0},onSavePackMAtDetails:function(){this.Packingmat.close()},fnLivechangePackingTare:function(e){if(e.mParameters.value!==""){var t=this.getView().getModel("JMPackItem").getData();var a=e.getSource().getBindingContext("JMPackItem").getPath();var r=a.split("/");var i=r[1];if(Number(e.mParameters.value).toString().length<=7){t[i].PmatWt=Number(e.mParameters.value).toFixed(3);t[i].TotPmatWt=Number(t[i].PmatWt*t[i].PmatNo).toFixed(3);this.getView().getModel("JMPackItem").refresh(true)}else{var o="0";t[c].PmatWt=Number(o).toFixed(3);t[i].TotPmatWt=Number(t[i].PmatWt*t[i].PmatNo).toFixed(3);n.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}}},fnLivechangePackingQty:function(e){if(e.mParameters.value!==""){var t=this.getView().getModel("JMPackItem").getData();var a=e.getSource().getBindingContext("JMPackItem").getPath();var r=a.split("/");var i=r[1];if(t[i].Brgew===""){t[i].Brgew=0}if(t[i].Ntgew===""){t[i].Ntgew=0}if(Number(e.mParameters.value).toString().length<=7){t[i].PmatNo=Number(e.mParameters.value);t[i].TotPmatWt=Number(t[i].PmatWt*t[i].PmatNo).toFixed(3);t[i].PmatNo=Number(e.mParameters.value).toString();this.getView().getModel("JMPackItem").refresh(true)}else{var o="0";t[i].PmatNo=Number(o);t[i].TotPmatWt=Number(t[i].PmatWt*t[i].PmatNo).toFixed(3);t[i].PmatNo=Number(o).toString();this.getView().getModel("JMTMPItem").refresh(true);n.show(this.getView().getModel("i18n").getResourceBundle().getText("EnterValid"))}}},fnAddItem:function(e){if(m<3){var a=e.getSource().getBindingContext("JMPackItem").getObject();var r=this.getView().getModel("JMPackItem").getData();var i=this.getView().getModel("JMPackMatItem").getData();var o={Pmat:a.Pmat,PmatWt:a.PmatWt,PmatNo:a.PmatNo,TotPmatWt:a.TotPmatWt,PackMatUom:a.PackMatUom,Item:a.Item};r.push(o);i.push(o);this.getView().getModel("JMPackItem").refresh(true);this.getView().getModel("JMPackMatItem").refresh(true);m++}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("AddItemErr"))}},onItemDelete:function(e){var a=this.getView().getModel("JMPackItem");var r=a.getData();var i=this.getView().getModel("JMPackMatItem").getData();var o=e.getSource().getBindingContext("JMPackItem").getObject();var n=this;if(r.length>1){var s=e.getSource().getBindingContext("JMPackItem").getPath();var g=s.split("/");var l=g[1];for(var u=0;u<i.length;u++){if(o.Item===i[u].Item&&o.TotPmatWt===i[u].TotPmatWt&&o.Pmat===i[u].Pmat&&o.PmatWt===i[u].PmatWt&&o.PmatNo===i[u].PmatNo){i.splice(u,1);break}}r.splice(g[1],1);a.setData(r);a.refresh(true);this.getView().getModel("JMPackMatItem").refresh("true");m=this.getView().getModel("JMPackMatItem").getData().length}else{t.error(this.getView().getModel("i18n").getResourceBundle().getText("Singledel"))}}})});
//# sourceMappingURL=EwayDetail.controller.js.map