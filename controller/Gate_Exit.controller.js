var oThat;jQuery.sap.require("sap.ndc.BarcodeScanner");sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/TablePersoController","ZGT_MM_INBOUND/Util/DemoPersoExit"],function(e,t,a,o,r,i,n){"use strict";var s,l,d,l,c,g,u;return e.extend("ZGT_MM_INBOUND.controller.Gate_Exit",{onInit:function(){oThat=this;oThat.Images=[];oThat.BusyDialog=new a;oThat.oView=this.getView();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("GateExit").attachMatched(this._onRouteMatched,this);this._oTPC1=new i({table:oThat.oView.byId("id_gateexit2"),persoService:n}).activate()},onExit:function(){if(this._oTPC1!=undefined){this._oTPC1.destroy();this.byId("id_gateexit2").destroy()}},_onRouteMatched:function(e){oThat.BusyDialog=new a;oThat=this;oThat.getView().byId("id_SearchFieldGE").setValue("");oThat.oView=oThat.getView();oThat.oView.setModel(new o,"oViewModel");oThat.oView.getModel("oViewModel").setProperty("/cmsContract",false);oThat.oView.getModel("oViewModel").setProperty("/refNumber",false);oThat.oModel=oThat.getOwnerComponent().getModel();if(sap.ui.Device.system.phone){oThat.oDevice="P"}else{oThat.oDevice="D"}oThat.Service="GET";var t={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"X",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",GateExitNav:[]}};oThat.onCallService(oThat.Service,t)},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GET"||oThat.Service==="ITEM"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="GATE"){oThat.oModel.read("/F4GatesSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="EXIT"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.oExitData=JSON.parse(JSON.stringify(e));var a=new o(e);oThat.oView.setModel(a,"oExitModel");var i=new o(e);oThat.oView.setModel(i,"oExitModelDel")}else if(oThat.Service=="ITEM"){oThat.EvWtype=e.EvWtype;var a=new o(e);oThat.oView.setModel(a,"ITEM");var n=oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Werks;oThat.Service="GATE";var s=[new r("Werks",sap.ui.model.FilterOperator.EQ,n),new r("Wbobj",sap.ui.model.FilterOperator.EQ,oThat.EvWtype)];oThat.onCallService(oThat.Service,s);oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Gate="";oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].GateName="";oThat.getView().getModel("ITEM").refresh();if(e.WbHeaderNav.results.length===1){if(e.WbHeaderNav.results[0].Config3!==""){e.WbHeaderNav.results[0].Gate=e.WbHeaderNav.results[0].Config3;e.WbHeaderNav.results[0].GateName=e.WbHeaderNav.results[0].GateName}}else{e.WbHeaderNav.results[0].Gate=""}if(e.WbHeaderNav.results.length===1){var l=e.WbHeaderNav.results[0].Config15;var d=oThat.getView().getModel("ITEM");var c=d.getData();if(l&&l.trim()!==""){var g=l.substring(l.indexOf("-")+1).trim();var u=l.split("-")[0].trim();c.WbHeaderNav.results[0].Config15=g;if(u==="W"){c.WbHeaderNav.results[0].Config15UIType="Warning"}else{c.WbHeaderNav.results[0].Config15UIType="Information"}c.WbHeaderNav.results[0].Config15UIMsgStrip=true}else{c.WbHeaderNav.results[0].Config15UIMsgStrip=false}d.refresh(true)}if(e.WbHeaderNav.results.length>0){if(e.WbHeaderNav.results[0].Status==="X"){oThat.oView.getModel("oViewModel").setProperty("/cmsContract",true)}else if(e.WbHeaderNav.results[0].Status==="A"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsgCMS"));oThat.GateExitFrag.destroy()}if(e.WbHeaderNav.results[0].Config16.trim().length>0&&e.WbHeaderNav.results[0].Wtype==="MISC"){oThat.oView.getModel("oViewModel").setProperty("/refNumber",true)}}}else if(oThat.Service==="GATE"){oThat.oView.setModel(new o(e),"GATE");if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Config3===""){if(e.results.length===1){oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Gate=e.results[0].Gate;oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].GateName=e.results[0].GateName;oThat.oView.getModel("ITEM").refresh()}}}else if(oThat.Service==="EXIT"){if(e.PostReturnNav.results.length!=0){var h=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(h!=0){var v="";for(var f=0;f<h.length;f++){v=h[f].Message+"\n"+v}t.error(v)}var T=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(T!=0){var v="";for(var f=0;f<T.length;f++){v=T[f].Message+"\n"+v}t.success(v);if(oThat.TableSelectedObject){var p=oThat.oView.getModel("oExitModelDel").getData();for(var f=0;f<p.GateExitNav.results.length;f++){if(p.GateExitNav.results[f].Wbid==oThat.TableSelectedObject.Wbid){p.GateExitNav.results.splice(f,1);break}}oThat.oView.getModel("oExitModelDel").refresh()}var a=new o(p);oThat.oView.setModel(a,"oExitModel");oThat.oView.getModel("oExitModel").refresh();oThat.getView().byId("id_SearchFieldGE").setValue("")}}else{oThat.Service="GET";var m={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"X",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",GateExitNav:[]}};oThat.onCallService(oThat.Service,m)}}},myErrorHandler:function(){oThat.BusyDialog.close()},onGateItemPress:function(e){oThat.oTableSelctedItem=e.getSource().getBindingContextPath();oThat.TableSelectedObject=e.getSource().getBindingContext("oExitModel").getObject();oThat.oBjectItem=oThat.oView.getModel("oExitModel").getObject(e.getSource().getBindingContextPath());oThat.GateExitFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.GateExit",this);oThat.oView.addDependent(oThat.GateExitFrag);oThat.GateExitFrag.setEscapeHandler(oThat.onEscapeGateExit);oThat.GateExitFrag.open();var t={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"X",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:oThat.oBjectItem.Wbid,IvWerks:"",WbHeaderNav:[],GateExitNav:[]}};oThat.Service="ITEM";oThat.onCallService(oThat.Service,t)},onClickBack:function(){oThat.GateExitFrag.destroy()},onGateItemSubmit:function(e){oThat.oView.getModel("oExitModel").refresh();var a=true;if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Config16.length>0&&oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wtype==="MISC"){if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Config17.length<9){a=false;t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("errmsgRef"));return}}if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Gate!==""||oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wsgate){var o="";if(oThat.EvWtype=="WB"){o=oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Gate}else{o=oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wsgate}var r={Gate:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Gate,Wsgate:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wsgate,Vehno:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Vehno,Vehtyp:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Vehtyp,Dname:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Dname,DriverMob:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].DriverMob,Remark:oThat.oBjectItem.Item,Wbid:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wbid,Erdat:null,Ertim:"PT00H00M00S",Config3:o,Config17:oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Config17};var i={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"X",Inbound:"X",Outbound:"",PostReturnNav:[],PostWbHeaderNav:[],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};i.d.PostWbHeaderNav.push(r);oThat.Service="EXIT";oThat.GateExitFrag.destroy();oThat.onCallService(oThat.Service,i)}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg5"))}},onFileDeleted:function(e){var t=e.getParameter("documentId");for(var a=0;a<oThat.Images.length;a++){if(oThat.Images[a].Documentid==t){oThat.Images.splice(oThat.Images[a],1);break}}oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true);var r=oThat.byId("imagePreview");var i=oThat.byId("previewContainer");if(r&&r.getSrc()){var n=r.getSrc();var s=n&&n.includes(t);if(s&&i){r.setSrc("");i.setVisible(false)}}},onCompleteUpload:function(e){var t=this;var a=sap.ui.getCore().byId("id_RadioBtn").getSelectedButton().getId();var r=sap.ui.getCore().byId("id_RadioBtn").getSelectedButton().getText();if(t.Images.length!=0){for(var i=0;i<t.Images.length;i++){if(t.Images[i].Doknr==a){t.Images.splice(i,1);break}}}var n=e.getSource()._getFileUploader()._aXhr[0]["file"];var s={};s.Documentid=jQuery.now().toString();var l="";if(n&&n.name){var d=n.name.lastIndexOf(".");if(d!==-1){l=n.name.substring(d)}}s.Fname=r.trim()+(l?""+l.toLowerCase():"");s.Ftype=n.type;s.Objky="";s.Doknr=a;e.getSource()._getFileUploader()._aXhr.splice(0,1);if(n){var c=new FileReader;var g="data:"+n.type+";base64,";c.onloadend=function(e){return function(e){var a=e.target.result.indexOf(g)+g.length;var r=e.target.result.substring(a);s.Filename=r;s.documentUrl=URL.createObjectURL(n);t.Images.unshift(s);s={};t.getView().setModel(new o(t.Images),"MASS");t.getView().getModel("MASS").refresh(true);t.BusyDialog.close()}}(n)}c.readAsDataURL(n)},onBeforeUploadStarts:function(){oThat.BusyDialog.open()},onFilePreview:function(e){var t=oThat.getView().getModel("i18n").getResourceBundle();var a=new sap.m.BusyDialog;a.open();var o=e.getSource();var r=o;while(r){if(r.getMetadata&&r.getMetadata().getName()==="sap.m.Dialog"){break}r=r.getParent&&r.getParent()}if(!r){sap.m.MessageToast.show("Dialog container not found");return}var i=r;var n=i.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewContainer")!==-1})[0];var s=i.findAggregatedObjects(true,function(e){return e.getId().indexOf("imagePreview")!==-1})[0];var l=i.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewTitle")!==-1})[0];if(!n||!s||!l){sap.m.MessageToast.show("Preview controls not found");return}var d=o.getBindingContext("MASS");var c=d?d.getObject():null;if(!c){sap.m.MessageToast.show("File data not found");return}var g=c.documentUrl||c.url||"";var u=c.Fname||"";var h=u.split(".").pop().toLowerCase();if(!g){sap.m.MessageToast.show("Document preview not available");return}if(["jpg","jpeg","png","gif","bmp","svg"].includes(h)){s.attachEventOnce("load",function(){a.close()});s.attachEventOnce("error",function(){a.close();sap.m.MessageToast.show("Failed to load image preview")});s.setSrc(g);l.setText("Preview: "+u);n.setVisible(true)}else{a.close();var v=document.createElement("a");v.href=g;v.download=u;document.body.appendChild(v);v.click();document.body.removeChild(v)}},onClosePreview:function(e){var t=e.getSource();var a=t;while(a){if(a.getMetadata&&a.getMetadata().getName()==="sap.m.Dialog"){break}a=a.getParent&&a.getParent()}if(!a){return}var o=a;var r=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewContainer")!==-1})[0];var i=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("imagePreview")!==-1})[0];var n=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewTitle")!==-1})[0];if(r)r.setVisible(false);if(i)i.setSrc("");if(n)n.setText("")},onValueHelpPress:function(e){var t=e.getSource().getModel("ITEM").getData().WbHeaderNav.results[0].Werks;oThat.Service="GATE";var a=[new r("Werks",sap.ui.model.FilterOperator.EQ,t),new r("Wbobj",sap.ui.model.FilterOperator.EQ,oThat.EvWtype)];oThat.onCallService(oThat.Service,a);oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Gate",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open()},onValueHelpSearch:function(e){var t=e.getParameter("value");var a;a=new sap.ui.model.Filter([new r("Gate",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var i=e.getSource().getBinding("items");i.filter([o])},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");var a=t.getTitle();if(oThat.EvWtype=="WB"){oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Gate=a;oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].GateName=e.getParameter("selectedItem").getNumber()}else{oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wsgate=a}oThat.oView.getModel("ITEM").refresh(true);oThat.ValueHelp.destroy()},onValueHelpCancel:function(e){oThat.ValueHelp.destroy()},onEscapeGateExit:function(){oThat.GateExitFrag.destroy()},onNavBack:function(){this.oRouter.navTo("Inbound")},onGateExitFilter:function(e){var t=this;if(t.getView().getModel("oGateFilterExit")==undefined){var a=t.getView().getModel("oExitModel").getData().GateExitNav.results;var r=[];var i=[new Set(a.map(function(e){return e.Gate}))];var n=i[0].values();for(var s=0;s<i[0].size;s++){var l=n.next().value;var d="";for(var c=0;c<a.length;c++){if(l==a[c].Gate){d=a[c].GateName;break}}var g={Gate:l,GateName:d};r.push(g)}r.push({Gate:"All",GateName:""});t.getView().setModel(new o(r),"oGateFilterExit")}if(!oThat.GateFilterEssxit){oThat.GateFilterExit=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.GateFilter_GateExit",oThat);oThat.getView().addDependent(oThat.GateFilterExit)}oThat.GateFilterExit.fireSearch();oThat.GateFilterExit.open()},onSearchGate:function(e){var t=e.getSource()._sSearchFieldValue;if(t&&t.length>0){var a=new sap.ui.model.Filter("Gate",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("GateName",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter([a,o])}var i=e.getSource().getBinding("items");i.filter(r)},onConfirmGate:function(e){var t=this;var a=e.getParameter("selectedItem");var o=oThat.oExitData.GateExitNav.results;if(a.getTitle().split(" ")[0]!="All"){var r=o.filter(function(e){return e.Gate==a.getTitle().split(" ")[0]});t.getView().getModel("oExitModel").getData().GateExitNav.results=r;t.getView().getModel("oExitModel").refresh(true)}else{oThat.Service="GET";var i={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"X",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",GateExitNav:[]}};oThat.onCallService(oThat.Service,i)}},onSettings:function(e){var t=this;t._oTPC1.openDialog()},onTablePersoRefresh:function(){n.resetPersData();this._oTPC1.refresh()},fnSearchRefId:function(e){var t=e.getSource().getValue();var a=this.getView().byId("id_gateexit2");if(t&&t.length>0){var o=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("DriverMob",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Batch",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter([o,r,i,n])}var l=a.getBinding("items");l.filter(s)},fnScanWB:function(){var e=this;var t=e.getView().getModel("i18n").getResourceBundle();var a=new o;if(ZXing!==undefined&&!sap.ui.Device.system.desktop){this.loadZXingLibrary().then(()=>{d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(o=>{if(o.length>1){l=o[1].deviceId}else if(o.length===1){l=o[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}if(o.length>=1){var r=[];o.forEach(o=>{var i={};i.text=o.label;i.value=o.deviceId;r.push(i);a.setData(r);this.getView().setModel(a,"oVideoDeviceModel");c=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:l,selectionChange:function(t){l=t.getSource().getSelectedKey();e._oScanQRDialog.close();d.reset()}});g=new sap.m.Button({text:t.getText("Start"),type:t.getText("Accept"),press:function(){e._oScanQRDialog.close();e.fnScanWB()}});e.startScanning()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}},startScanning:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){s=true}else{s=false}}catch(e){s=false}if(s===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(l,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();e.onScanBarcode(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},onScanBarcode:function(e){var t=this;t.Scan=true;var a=e.split("#")[0];var o=this.getView().byId("id_gateexit2");if(a&&a.length>0){var r=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,a);var i=new sap.ui.model.Filter([r])}var n=o.getBinding("items");n.filter(i)},fnClearFilter:function(e){var t=this;if(t.Scan){var a="";t.onScanBarcode(a);t.getView().byId("id_SearchFieldNew").setValue("");t.Scan=false}},onScanQRValue:function(e){this.ScanBtnPress=e.getSource().getTooltip();var t=this;var a=t.getView().getModel("i18n").getResourceBundle();var r=new o;if(ZXing!==undefined&&!sap.ui.Device.system.desktop){d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(e=>{if(e.length>1){l=e[1].deviceId}else if(e.length===1){l=e[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.onScanBarcode(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}if(e.length>=1){var o=[];e.forEach(e=>{if(e.label.includes("0")){l=e.deviceId}var i={};i.text=e.label;i.value=e.deviceId;o.push(i);r.setData(o);this.getView().setModel(r,"oVideoDeviceModel");c=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:l,selectionChange:function(e){l=e.getSource().getSelectedKey();t._oScanQRDialog.close();d.reset()}});g=new sap.m.Button({text:a.getText("Start"),type:a.getText("Accept"),press:function(){t._oScanQRDialog.close();t.onScanQRValue()}});t.startScanning()})}})}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.onScanBarcode(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},startScanning:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){s=true}else{s=false}}catch(e){s=false}if(s===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(l,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();e.onScanBarcode(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},onScanBarcode:function(e){var a=oThat.getView().getModel("i18n").getResourceBundle();if(this.ScanBtnPress===a.getText("RefNo")){if(e.length===13||e.length===10){oThat.BusyDialog.open();var o=[],r=new sap.ui.model.Filter("RgpRef",sap.ui.model.FilterOperator.EQ,"X"),i=new sap.ui.model.Filter("IvRef",sap.ui.model.FilterOperator.EQ,e),n=new sap.ui.model.Filter("IvGate",sap.ui.model.FilterOperator.EQ,"E"),s=new sap.ui.model.Filter("IvProc",sap.ui.model.FilterOperator.EQ," ");o=[r,i,n,s];oThat.oModel.read("/F4ParametersSet",{filters:o,urlParameters:{$expand:"ReturnNav"},success:function(o,r){oThat.BusyDialog.close();if(o.results[0].ReturnNav.results.length>0){if(o.results[0].ReturnNav.results[0].Type==="E")t.show(o.results[0].ReturnNav.results[0].Message)}else{var i=oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Config17.trim();if(i.length>=32){sap.m.MessageToast.show(a.getText("refscanValidation"))}else if(i.length===0){oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Config17=e}else{oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Config17+=","+e}oThat.getView().getModel("ITEM").refresh()}},error:function(e){oThat.BusyDialog.close();sap.m.MessageToast.show(a.getText("Title21"))}})}else{sap.m.MessageToast.show(a.getText("incorrect"))}}},fnBarcodeFailed:function(){sap.m.MessageBox.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg2"))},onresetRefNo:function(){oThat.getView().getModel("ITEM").getData().WbHeaderNav.results[0].Config17="";oThat.getView().getModel("ITEM").refresh()}})});
//# sourceMappingURL=Gate_Exit.controller.js.map