var oThat;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/MessageToast","sap/m/TablePersoController","ZGT_MM_INBOUND/Util/DemoPersoService","ZGT_MM_INBOUND/Util/Formatter"],function(e,t,a,o,r,i,n,s,l){"use strict";return e.extend("ZGT_MM_INBOUND.controller.PreQuality_Check",{Formatter:l,onInit:function(){oThat=this;oThat.oView=this.getView();oThat.BusyDialog=new a;this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("PreQuality").attachMatched(this._onRouteMatched,this);this._oTPC=new n({table:oThat.oView.byId("pre_qual"),persoService:s}).activate()},_onRouteMatched:function(e){oThat=this;oThat.oView=oThat.getView();oThat.BusyDialog=new a;oThat.oModel=oThat.getOwnerComponent().getModel();oThat.Service="GET";var t={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,t)},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GET"||oThat.Service==="ITEM"||oThat.Service==="BATCH"||oThat.Service=="CONTINUE"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="GETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/BatchGetSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/PostBatchSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SAVE"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="OriginCombo"){oThat.oModel.read("/F4ParametersSet",{filters:t,urlParameters:{$expand:"F4OriginSetNav"},success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.EvQueuing=e.EvQueuing;var a=new o(e);oThat.oView.setModel(a,"oQualityModel");if(e.ExPrlotLayout==="N"){oThat.getView().byId("id_wbitem").setVisible(true);oThat.getView().byId("id_PONo").setVisible(true);oThat.getView().byId("id_Poitem").setVisible(true);oThat.getView().byId("id_EwayNo").setVisible(true);oThat.getView().byId("id_batch").setVisible(true);oThat.getView().byId("id_DlNo").setVisible(true);oThat.getView().byId("id_DLitem").setVisible(true)}else{oThat.getView().byId("id_wbitem").setVisible(false);oThat.getView().byId("id_PONo").setVisible(false);oThat.getView().byId("id_Poitem").setVisible(false);oThat.getView().byId("id_EwayNo").setVisible(false);oThat.getView().byId("id_batch").setVisible(false);oThat.getView().byId("id_DlNo").setVisible(false);oThat.getView().byId("id_DLitem").setVisible(false)}}else if(oThat.Service==="ITEM"){oThat.EvWtype=e.EvWtype;var i={PreQualNav:e.PreQualNav,BatchCharsNav:[],BatchValuesNav:[]};oThat.oView.setModel(new o(e),"BATCH");oThat.oView.getModel("BATCH").refresh(true);if(e.GetReturnNav.results.length!=0){var n=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){var s;for(var l=0;l<n.length;l++){s=n[l].Message+"\n"}t.show(s,{icon:t.Icon.ERROR,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title21"),actions:[t.Action.OK],onClose:function(e){}})}else{var g=e.GetReturnNav.results.filter(function(e){if(e.Type=="W"){return e}});if(g!=0){for(var l=0;l<g.length;l++){s=g[l].Message+"\n"}t.show(s,{icon:t.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title22"),actions:[t.Action.OK],onClose:function(e){oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.setEscapeHandler(oThat.onEscapeQueue);oThat.oQueueFrag.open()}})}}}else{oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.setEscapeHandler(oThat.onEscapeQueue);oThat.oQueueFrag.open()}}else if(oThat.Service==="BATCH"){var i={BatchCharsNav:[],BatchValuesNav:[]};oThat.oView.setModel(new o(e),"BATCH");oThat.oView.getModel("BATCH").refresh(true);oThat.oView.getModel("Head").getData().Charg=e.QualCharNav.results[0].Charg;oThat.oView.getModel("Head").getData().Matxt=e.QualCharNav.results[0].Matxt;oThat.oView.getModel("Head").refresh();if(e.GetReturnNav.results.length!=0){var n=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){var s;for(var l=0;l<n.length;l++){s=n[l].Message+"\n"}t.show(s,{icon:t.Icon.ERROR,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title21"),actions:[t.Action.OK],onClose:function(e){}})}else{var g=e.GetReturnNav.results.filter(function(e){if(e.Type=="W"){return e}});if(g!=0){for(var l=0;l<g.length;l++){s=g[l].Message+"\n"}t.show(s,{icon:t.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title22"),actions:[t.Action.OK],onClose:function(t){if(oThat.EvQueuing=="X"&&e.EvOrigin!=="N"){oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.setEscapeHandler(oThat.onEscapeQueue);oThat.oQueueFrag.open()}else if(e.EvOrigin==="N"){oThat.oPreQAEway=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PreQAEway",oThat);oThat.oView.addDependent(oThat.oPreQAEway);oThat.oPreQAEway.open()}else{oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.BatchChar",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.setEscapeHandler(oThat.onEscapeBatch);oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumberChk").setEnabled(false)}}}})}}}else{if(oThat.EvQueuing=="X"&&e.EvOrigin!=="N"){if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&e.EvOrigin==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){oThat.OriginIvc=e.EvOrigin;oThat.Wtype=oThat.oView.getModel("Head").getData().Wtype;oThat.Service="OriginCombo";var d=[new r("OriginGQ",sap.ui.model.FilterOperator.EQ,"X"),new r("IvWerks",sap.ui.model.FilterOperator.EQ,e.IvWerks)];oThat.onCallService(oThat.Service,d)}else{oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.setEscapeHandler(oThat.onEscapeQueue);oThat.oQueueFrag.open();oThat.OriginIvc=e.EvOrigin}}else if(e.EvOrigin==="N"){oThat.oPreQAEway=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PreQAEway",oThat);oThat.oView.addDependent(oThat.oPreQAEway);oThat.oPreQAEway.open()}else{if(!oThat.Batch){oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.BatchChar",oThat);oThat.getView().addDependent(oThat.Batch)}oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumberChk").setEnabled(false)}}}}else if(oThat.Service==="GETCHAR"){oThat.oView.getModel("BATCH").getData().BatchCharsNav=e.BatchCharsNav;oThat.oView.getModel("BATCH").getData().BatchValuesNav=e.BatchValuesNav;oThat.oView.getModel("BATCH").refresh(true);oThat.onCreateChracteritis()}else if(oThat.Service=="SETCHAR"){if(e.PostReturnNav.results.length!=0){var n=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(n!=0){var s="";for(var l=0;l<n.length;l++){s=s+n[l].Message+"\n"}t.error(s)}var h=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(h!=0){var s;for(var l=0;l<h.length;l++){s=h[l].Message+"\n"}var u=e.IWbid;var T=e.IItem;t.show(s,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK,"Preview PDF Print"],onClose:function(e){if(e==="Preview PDF Print"){oThat.onPreviewPDF(u,T)}else{oThat.Batch.destroy();if(oThat.oQueueFrag){oThat.oQueueFrag.destroy()}if(oThat.getView().getModel("ExceptionModel")){oThat.getView().getModel("ExceptionModel").setData([])}oThat.Service="GET";var t={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,t)}}})}}else{oThat.Service="GET";oThat.Batch.destroy();if(oThat.oQueueFrag){oThat.oQueueFrag.destroy()}var c={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,c)}}else if(oThat.Service==="SAVE"){if(e.PostReturnNav.results[0].Type==="E"){sap.m.MessageBox.error(e.PostReturnNav.results[0].Message)}else{oThat.onCloseQueuing();oThat.onCloseQueue();oThat.Service="GET";var c={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,c)}}else if(oThat.Service==="CONTINUE"){if(e.PreQualNav!=null){if(e.PreQualNav.results.length==0){var C=sap.ui.getCore().byId("id_PanelCharChk");C.destroyContent();oThat.Batch.destroy();oThat.oQueueFrag.destroy();oThat.Service="GET";var c={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,c)}else{t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg1"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){oThat.oView.getModel("BATCH").getData().BatchCharsNav=[];oThat.oView.getModel("BATCH").getData().BatchValuesNav=[];oThat.oView.getModel("BATCH").getData().PreQualNav=e.PreQualNav;oThat.oView.getModel("BATCH").refresh(true);var a=sap.ui.getCore().byId("id_PanelCharChk");a.destroyContent();oThat.oView.getModel("Head").getData().Charg="";oThat.oView.getModel("Head").getData().Matnr=""}else{var a=sap.ui.getCore().byId("id_PanelCharChk");a.destroyContent();oThat.Batch.destroy();oThat.oQueueFrag.destroy();oThat.Service="GET";var o={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,o)}}})}}else{var C=sap.ui.getCore().byId("id_PanelCharChk");C.destroyContent();oThat.Batch.destroy();oThat.oQueueFrag.destroy();oThat.Service="GET";var c={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,c)}}else if(oThat.Service==="OriginCombo"){var v=new o;var f=e.results[0].F4OriginSetNav.results;if(f.length>0){v.setData(f);oThat.oView.setModel(v,"OriginComboModel");oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.open()}else{oThat.oQueueFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queue",oThat);oThat.oView.addDependent(oThat.oQueueFrag);oThat.oQueueFrag.open()}}},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},onPressQualItem:function(e){if(e!=undefined&&e!=null){oThat.oBject=e.getSource().getBindingContext("oQualityModel").getObject();oThat.Service="ITEM"}else{oThat.Service="CONTINUE"}var t={Charg:"",Ebeln:oThat.oBject.Ebeln,Ebelp:oThat.oBject.Ebelp,Matnr:oThat.oBject.Matnr,Matxt:oThat.oBject.Maktx,Posnr:oThat.oBject.Posnr,Vbeln:oThat.oBject.Vbeln,Wbid:oThat.oBject.Wbid,Werks:oThat.oBject.Werks,IvHours:0,Vehno:oThat.oBject.Vehno,Aedat:oThat.oBject.Aedat,Aetim:oThat.oBject.Aetim,Item:oThat.oBject.Item,Batch:oThat.oBject.Batch,Wtype:oThat.oBject.Wtype};oThat.oView.setModel(new o(t),"Head");oThat.oView.getModel("Head").refresh("true");var a={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:oThat.oBject.Wbid,IvWerks:oThat.oBject.Werks,IvItem:oThat.oBject.Item,QualWbidNav:[],PreQualNav:[],QualCharNav:[],GetReturnNav:[]}};a.d.QualCharNav.push({Wbid:oThat.oBject.Wbid,Item:oThat.oBject.Item,Matnr:oThat.oBject.Matnr,Werks:oThat.oBject.Werks,Ebeln:oThat.oBject.Ebeln,Vbeln:oThat.oBject.VbelBATCHn,Ebelp:oThat.oBject.Ebelp,Posnr:oThat.oBject.Posnr});oThat.Service="BATCH";oThat.onCallService(oThat.Service,a)},onPressQueuing:function(e){var t=e.getSource().getId();if(t.indexOf("id_Queue1")!==-1){if(!oThat.Queuing){oThat.Queuing=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Queuing",oThat);oThat.oView.addDependent(oThat.Queuing)}oThat.Queuing.open()}else if(t.indexOf("id_QA")!==-1){oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.BatchChar",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumberChk").setEnabled(false)}if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&oThat.OriginIvc==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){sap.ui.getCore().byId("id_TokenField").setVisible(false);sap.ui.getCore().byId("id_TokenLabel").setVisible(false);sap.ui.getCore().byId("id_TokenFieldCombo").setValue("");sap.ui.getCore().byId("id_TokenFieldCombo").setVisible(true);sap.ui.getCore().byId("id_TokenLabelCombo").setVisible(true)}else if(oThat.OriginIvc==="E"){sap.ui.getCore().byId("id_TokenField").setValue("");sap.ui.getCore().byId("id_TokenField").setVisible(true);sap.ui.getCore().byId("id_TokenLabel").setVisible(true);sap.ui.getCore().byId("id_TokenFieldCombo").setVisible(false);sap.ui.getCore().byId("id_TokenLabelCombo").setVisible(false)}else{sap.ui.getCore().byId("id_TokenField").setVisible(false);sap.ui.getCore().byId("id_TokenLabel").setVisible(false);sap.ui.getCore().byId("id_TokenFieldCombo").setVisible(false);sap.ui.getCore().byId("id_TokenLabelCombo").setVisible(false)}}else if(t.indexOf("id_RejQA")!==-1){oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.BatchChar",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumberChk").setEnabled(false)}}},onCloseQueuing:function(){oThat.Queuing.close()},onCloseQueue:function(){oThat.oQueueFrag.destroy()},onSaveQueue:function(e){var t={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",Queuein:"X",IvHours:oThat.oView.getModel("Head").getData().IvHours.toString(),IvWbid:oThat.oView.getModel("Head").getData().Wbid,IvWboj:oThat.EvWtype,PostReturnNav:[],PostWbHeaderNav:[],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};oThat.Service="SAVE";oThat.onCallService(oThat.Service,t)},handleChange:function(e){var t=e.getSource(),a=t.getSelectedKey(),o=t.getValue();if(!a&&o){t.setValueState("Error");var r=t.getItems().some(function(e){return e.getText().toLowerCase()===o.toLowerCase()});if(!r){t.setValue("")}}else{t.setValueState("None")}},onValueHelpPress:function(e){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Material",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open()},onValueHelpSearch:function(e){var t=e.getParameter("value");var a;a=new sap.ui.model.Filter([new r("Matnr",sap.ui.model.FilterOperator.Contains,t),new r("Maktx",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var i=e.getSource().getBinding("items");i.filter([o])},onValueHelpConfirm:function(e){var t=oThat.oView.getModel("BATCH").getObject(e.getParameter("selectedItem").getBindingContextPath());oThat.oView.getModel("Head").setData(t);oThat.oView.getModel("Head").refresh();sap.ui.getCore().byId("id_PanelCharChk").addContent("");sap.ui.getCore().byId("id_BtnCharChk").setEnabled(true);sap.ui.getCore().byId("id_BtnCharSaveChk").setVisible(false);sap.ui.getCore().byId("id_BtnRejCharChek").setVisible(false);sap.ui.getCore().byId("id_BtnExceptionQA").setVisible(false);sap.ui.getCore().byId("id_BtnCheck").setVisible(false);var a={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",QualWbidNav:[],PreQualNav:[],QualCharNav:[]}};a.d.QualCharNav.push(t);oThat.Service="BATCH";oThat.onCallService(oThat.Service,a)},onClose:function(){oThat.Batch.destroy();if(oThat.getView().getModel("ExceptionModel")){oThat.getView().getModel("ExceptionModel").setData([])}oThat.Service="GET";var e={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.onCallService(oThat.Service,e)},onPressCharacteristics:function(e){if(oThat.oView.getModel("Head").getData().Charg===""){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg4"))}else{var a={MaterialNav:[],BatchCharsNav:[],BatchValuesNav:[]};var o={Matnr:oThat.oView.getModel("Head").getData().Matnr,Werks:oThat.oView.getModel("Head").getData().Werks,Lgort:"",Charg:oThat.oView.getModel("Head").getData().Charg,Msgid:"",Msgno:""};a.MaterialNav.push(o);oThat.Service="GETCHAR";oThat.onCallService(oThat.Service,a)}},onCreateChracteritis:function(){var e=this;var t=sap.ui.getCore().byId("id_PanelCharChk");t.destroyContent();if(oThat.oView.getModel("BATCH").getData().BatchCharsNav!=null&&oThat.oView.getModel("BATCH").getData().BatchValuesNav!=null){sap.ui.getCore().byId("id_BtnCharSaveChk").setVisible(true);sap.ui.getCore().byId("id_BtnRejCharChek").setVisible(true);if(oThat.oView.getModel("BATCH").getData().PreQualExp==="X"){sap.ui.getCore().byId("id_BtnExceptionQA").setVisible(true);sap.ui.getCore().byId("id_BtnCheck").setVisible(true)}else{sap.ui.getCore().byId("id_BtnExceptionQA").setVisible(false);sap.ui.getCore().byId("id_BtnCheck").setVisible(false)}var a=oThat.oView.getModel("BATCH").getData().BatchCharsNav.results;var o=0;var r=false,n=false;var s=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12"}).addStyleClass("sapUiSizeCompact Cl_Grid_Width sapUiSmallMarginTop");for(var l=0;l<a.length;l++){var g=[];for(var d=0;d<oThat.oView.getModel("BATCH").getData().BatchValuesNav.results.length;d++){if(a[l].NameChar==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].NameChar&&a[l].Werks==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].Werks&&a[l].Matnr==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].Matnr){g.push(oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d])}}var h="",u="",T="";var c=a[l].DescrChar;var C=false;if(g.length>0){if(g[0].ValRelatn=="1"){C=true;var v={CharValue:"",DescrCval:"",Lgort:"",Matnr:"",NameChar:"",NumValFm:"",NumValTo:"",ValRelatn:"1",Werks:""};g.splice(0,0,v)}}if(a[l].SingleValue&&a[l].NameChar==="TRUCKTYPE"){var f=new sap.m.Label({text:c+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");T=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");if(!a[l].Batchindex){a[l].Batchindex=0}a[l].Batchindex=parseInt(a[l].Batchindex);u=new sap.m.Select({forceSelection:false,width:"10rem",items:[new sap.ui.core.Item({key:"A",text:"A"}),new sap.ui.core.Item({key:"M",text:"M"})]}).addStyleClass("sapUiTinyMarginTop");T.addContent(f);T.addContent(u);s.addContent(T);h=f.getText().split(" :")[0].toLocaleUpperCase()}else if(a[l].SingleValue&&g.length>0&&C){n=false;var f=new sap.m.Label({text:c+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");T=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");if(!a[l].Batchindex){a[l].Batchindex=0}a[l].Batchindex=parseInt(a[l].Batchindex);u=new sap.m.Select({forceSelection:false,width:"10rem"}).addStyleClass("sapUiTinyMarginTop");if(g[1].DescrCval!=""){var p=new sap.ui.core.Item({key:"{Data>CharValue}",text:"{Data>DescrCval}"})}else{var p=new sap.ui.core.Item({key:"{Data>NumValFm}",text:"{Data>NumValFm}"})}var I=new sap.ui.model.json.JSONModel;var V={Select:g};I.setData(V);I.setSizeLimit(V.Select.length);u.bindAggregation("items","Data>/Select",p);u.setModel(I,"Data");if(g[1].DescrCval!==""){u.setSelectedKey(V.Select[a[l].Batchindex].CharValue)}else{u.setSelectedKey(V.Select[a[l].Batchindex].NumValFm)}T.addContent(f);T.addContent(u);s.addContent(T);h=f.getText().split(" :")[0].toLocaleUpperCase()}else if(a[l].SingleValue){n=false;r=false;var b=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var f=new sap.m.Label({text:c+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");b.addContent(f);var M="";var w="";if(a[l].DataType=="NUM"){M="Number"}else{M="Text"}w=a[l].NumberDigits;var B=new sap.m.Input({width:12+"rem",type:M,maxLength:w,value:a[l].ValueChar,liveChange:function(e){if(e.getSource().getParent().getContent().length=="3"){if(e.getSource().getParent().getContent()[2].getText().split(" ").length=="4"){var t=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[1]);var a=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[3]);var o=Number(e.getSource().getValue());if(o<t||o>a){if(o>a){e.getSource().setValue("")}e.getSource().setValueStateText(e.getSource().getParent().getContent()[2].getText());e.getSource().setValueState("Error")}else{e.getSource().setValueState("None")}}else{e.getSource().setValueState("None")}}else{var r=e.getSource().getType();var i="";var o="";if(r=="Number"){o=e.getSource().getValue();var n=e.getSource().getMaxLength();if(o.length>n){var s=o.substring(0,n);e.getSource().setValue("");e.getSource().setValue(s)}}e.getSource().setValueState("None")}}}).addStyleClass("");b.addContent(B);if(g.length>0){var N=oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_TextRange")+" "+Number(g[0].NumValFm)+" - "+Number(g[0].NumValTo);var m=new sap.m.Text({text:N}).addStyleClass("sapUiTinyMarginBegin");b.addContent(m)}s.addContent(b)}else if(!a[l].SingleValue&&g.length>0){var D;r=false;if(D==a[l].DescrChar){n=true}else{n=false}if(n==false){var y=0;var S=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var f=new sap.m.Label({text:c+" :",tooltip:a[l].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");S.addContent(f);var E=new sap.m.MultiComboBox({width:"6rem"}).addStyleClass("sapUiTinyMarginBegin");D=f.getText().split(" :")[0].toLocaleUpperCase();n=true}if(D==a[l].DescrChar){var H=new sap.ui.core.Item({text:a[l].ValueChar,key:y});y=y+1;E.insertItem(H)}else{n=false}S.addContent(E);s.addContent(S)}}t.addContent(s);if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length!==0){sap.ui.getCore().byId("id_BtnCharChk").setEnabled(false);sap.ui.getCore().byId("id_BtnCharSaveChk").setVisible(true);sap.ui.getCore().byId("id_BtnRejCharChek").setVisible(true)}}else{i.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg8"));sap.ui.getCore().byId("id_BatchNumberChk").setVisible(false);sap.ui.getCore().byId("id_BtnRejCharChek").setVisible(false)}},onExceptionQA:function(){var e=oThat.getView();if(!oThat._oExceptionQADialog){oThat._oExceptionQADialog=sap.ui.xmlfragment(e.getId(),"ZGT_MM_INBOUND.Fragments.PreQuality_Check_Expection",oThat);e.addDependent(oThat._oExceptionQADialog);var t=new sap.ui.model.json.JSONModel({Grade:"",Surcharge:"",Reason:""});e.setModel(t,"ExceptionModel")}oThat._oExceptionQADialog.open()},onQclose:function(){oThat._oExceptionQADialog.close()},fnSaveBatchChar:function(e){var a=e.getSource().getId();var o;if(a.indexOf("id_BtnCharSaveChk")!=-1){oThat.IApprove="A"}else if(a.indexOf("id_BtnRejCharChek")!=-1){oThat.IApprove="R"}else if(a.indexOf("id_BtnExceptionQA2")!=-1){var r=oThat.getView().getModel("ExceptionModel").getData();if(!r.Grade&&!r.Reason&&!r.Surcharge){i.show("Please fill Grade, Surcharge and Reason before saving.")}else{oThat._oExceptionQADialog.close();oThat.IApprove="E"}}if(oThat.oBject.Werks!=="6534"){var n=this;var s="",l="";var g=sap.ui.getCore().byId("id_PanelCharChk").getContent()[0].getContent();for(var d=0;d<g.length;d++){var h=g[d].getContent();var a=g[d].getContent()[1].getId();l=g[d].getContent()[1];var u="",T="";if(g[d].getContent()[1].getId().search("input")!="-1"){u=g[d].getContent()[1].getValue();if(g[d].getContent().length=="3"){if(g[d].getContent()[2].getText().split(" ").length=="4"){var c=Number(g[d].getContent()[2].getText().split(" ")[1]);var C=Number(g[d].getContent()[2].getText().split(" ")[3]);var v=parseFloat(u);var f=isNaN(v);if(f==false){if(v<c||v>C){if(v>C){g[d].getContent()[1].setValue("")}g[d].getContent()[1].setValueStateText(g[d].getContent()[2].getText());g[d].getContent()[1].setValueState("Error");s=g[d].getContent()[2].getText();l.focus();break}else{g[d].getContent()[1].setValueState("None")}}}else{g[d].getContent()[1].setValueState("None")}}}else if(g[d].getContent()[1].getId().search("box")!="-1"){}else if(g[d].getContent()[1].getId().search("group")!="-1"){T=g[d].getContent()[1].getSelectedIndex();u=g[d].getContent()[1].getSelectedKey()}else if(g[d].getContent()[1].getId().search("select")!="-1"){if(g[d].getContent()[1].getSelectedIndex()==-1){T="";u=""}else{T=g[d].getContent()[1].getSelectedIndex();u=g[d].getContent()[1].getSelectedKey()}}if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[d].EntryObligatory&&!u){s=oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[d].DescrChar+" "+oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_ErrorMandit");l.focus();break}if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&oThat.OriginIvc==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){if(sap.ui.getCore().byId("id_TokenFieldCombo").getValue()==""){s=oThat.oView.getModel("i18n").getResourceBundle().getText("OriginMandat");sap.ui.getCore().byId("id_TokenFieldCombo").focus()}}else if(oThat.OriginIvc==="E"){if(sap.ui.getCore().byId("id_TokenField").getValue()==""){s=oThat.oView.getModel("i18n").getResourceBundle().getText("OriginMandat");sap.ui.getCore().byId("id_TokenField").focus()}}}if(s){t.error(s)}else{for(var d=0;d<g.length;d++){var h=g[d].getContent();var a=g[d].getContent()[1].getId();l=g[d].getContent()[1];var u="",T="";if(g[d].getContent()[1].getId().search("input")!="-1"){u=g[d].getContent()[1].getValue();if(g[d].getContent().length=="3"){if(g[d].getContent()[2].getText().split(" ").length=="4"){var c=Number(g[d].getContent()[2].getText().split(" ")[1]);var C=Number(g[d].getContent()[2].getText().split(" ")[3]);var v=parseFloat(u);var f=isNaN(v);if(f==false){g[d].getContent()[1].setValueState("None")}}else{g[d].getContent()[1].setValueState("None")}}}else if(g[d].getContent()[1].getId().search("box")!="-1"){}else if(g[d].getContent()[1].getId().search("group")!="-1"){T=g[d].getContent()[1].getSelectedIndex();u=g[d].getContent()[1].getSelectedKey()}else if(g[d].getContent()[1].getId().search("select")!="-1"){if(g[d].getContent()[1].getSelectedIndex()==-1){T="";u=""}else{T=g[d].getContent()[1].getSelectedIndex();u=g[d].getContent()[1].getSelectedKey()}}for(var p=0;p<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;p++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].Werks==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[d].Werks&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].Matnr==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[d].Matnr&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].NameChar==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[d].NameChar){oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].ValueChar=u;var I="/"+"BatchCharsNav/results/"+p+"/Flag";oThat.oView.getModel("BATCH").setProperty(I,true);oThat.oView.getModel("BATCH").refresh(true);break}}}oThat.Service="SETCHAR";if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&oThat.OriginIvc==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){var V=sap.ui.getCore().byId("id_TokenFieldCombo").getValue()}else{var V=sap.ui.getCore().byId("id_TokenField").getValue()}var b={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IToken:V,IApprove:oThat.IApprove,Grade:r?.Grade||"",Surcharge:r?.Surcharge||"",Reason:r?.Reason||"",PostBatchCharNav:[],PostReturnNav:[]};if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length!=0){var M=[];for(var w=0;w<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;w++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[w].Flag!==undefined&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[w].ValueChar!==""){M.push({CValue:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[w].ValueChar,CDesc:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[w].DescrChar,Atnam:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[w].NameChar,Disp:""})}}b.PostBatchCharNav=M}oThat.onCallService(oThat.Service,b)}}else{oThat.Service="SETCHAR";var b={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IApprove:oThat.IApprove,Grade:r.Grade,Surcharge:r.Surcharge,Reason:r.Reason,PostBatchCharNav:[],PostReturnNav:[]};oThat.onCallService(oThat.Service,b)}},fnSaveCheck:function(e){if(oThat.oBject.Werks!=="6534"){var a=this;var o="",r="";var i=sap.ui.getCore().byId("id_PanelCharChk").getContent()[0].getContent();for(var n=0;n<i.length;n++){var s=i[n].getContent();var l=i[n].getContent()[1].getId();r=i[n].getContent()[1];var g="",d="";if(i[n].getContent()[1].getId().search("input")!="-1"){g=i[n].getContent()[1].getValue();if(i[n].getContent().length=="3"){if(i[n].getContent()[2].getText().split(" ").length=="4"){var h=Number(i[n].getContent()[2].getText().split(" ")[1]);var u=Number(i[n].getContent()[2].getText().split(" ")[3]);var T=parseFloat(g);var c=isNaN(T);if(c==false){if(T<h||T>u){if(T>u){i[n].getContent()[1].setValue("")}i[n].getContent()[1].setValueStateText(i[n].getContent()[2].getText());i[n].getContent()[1].setValueState("Error");o=i[n].getContent()[2].getText();r.focus();break}else{i[n].getContent()[1].setValueState("None")}}}else{i[n].getContent()[1].setValueState("None")}}}else if(i[n].getContent()[1].getId().search("box")!="-1"){}else if(i[n].getContent()[1].getId().search("group")!="-1"){d=i[n].getContent()[1].getSelectedIndex();g=i[n].getContent()[1].getSelectedKey()}else if(i[n].getContent()[1].getId().search("select")!="-1"){if(i[n].getContent()[1].getSelectedIndex()==-1){d="";g=""}else{d=i[n].getContent()[1].getSelectedIndex();g=i[n].getContent()[1].getSelectedKey()}}if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[n].EntryObligatory&&!g){o=oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[n].DescrChar+" "+oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_ErrorMandit");r.focus();break}if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&oThat.OriginIvc==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){if(sap.ui.getCore().byId("id_TokenFieldCombo").getValue()==""){o=oThat.oView.getModel("i18n").getResourceBundle().getText("OriginMandat");sap.ui.getCore().byId("id_TokenFieldCombo").focus()}}else if(oThat.OriginIvc==="E"){if(sap.ui.getCore().byId("id_TokenField").getValue()==""){o=oThat.oView.getModel("i18n").getResourceBundle().getText("OriginMandat");sap.ui.getCore().byId("id_TokenField").focus()}}}if(o){t.error(o)}else{for(var n=0;n<i.length;n++){var s=i[n].getContent();var l=i[n].getContent()[1].getId();r=i[n].getContent()[1];var g="",d="";if(i[n].getContent()[1].getId().search("input")!="-1"){g=i[n].getContent()[1].getValue();if(i[n].getContent().length=="3"){if(i[n].getContent()[2].getText().split(" ").length=="4"){var h=Number(i[n].getContent()[2].getText().split(" ")[1]);var u=Number(i[n].getContent()[2].getText().split(" ")[3]);var T=parseFloat(g);var c=isNaN(T);if(c==false){i[n].getContent()[1].setValueState("None")}}else{i[n].getContent()[1].setValueState("None")}}}else if(i[n].getContent()[1].getId().search("box")!="-1"){}else if(i[n].getContent()[1].getId().search("group")!="-1"){d=i[n].getContent()[1].getSelectedIndex();g=i[n].getContent()[1].getSelectedKey()}else if(i[n].getContent()[1].getId().search("select")!="-1"){if(i[n].getContent()[1].getSelectedIndex()==-1){d="";g=""}else{d=i[n].getContent()[1].getSelectedIndex();g=i[n].getContent()[1].getSelectedKey()}}for(var C=0;C<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;C++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].Werks==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[n].Werks&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].Matnr==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[n].Matnr&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].NameChar==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[n].NameChar){oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].ValueChar=g;var v="/"+"BatchCharsNav/results/"+C+"/Flag";oThat.oView.getModel("BATCH").setProperty(v,true);oThat.oView.getModel("BATCH").refresh(true);break}}}if(oThat.oView.getModel("Head").getData().Wtype==="PROCURE"&&oThat.OriginIvc==="X"&&oThat.oView.getModel("Head").getData().Ebeln==""){var f=sap.ui.getCore().byId("id_TokenFieldCombo").getValue()}else{var f=sap.ui.getCore().byId("id_TokenField").getValue()}var p={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IToken:f,IApprove:"",IBatchCharUpd:"X",PostBatchCharNav:[],PostReturnNav:[]};if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length!=0){var I=[];for(var V=0;V<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;V++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[V].Flag!==undefined&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[V].ValueChar!==""){I.push({CValue:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[V].ValueChar,CDesc:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[V].DescrChar,Atnam:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[V].NameChar,Disp:""})}}p.PostBatchCharNav=I}}}else{var p={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IApprove:"",IBatchCharUpd:"X",PostBatchCharNav:[],PostReturnNav:[]}}oThat.BusyDialog.open();oThat.oModel.create("/PostBatchSet",p,{success:function(e,a){oThat.BusyDialog.close();if(e.PostReturnNav.results.length!=0){var o=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(o!=0){var r="";for(var i=0;i<o.length;i++){r=r+o[i].Message+"\n"}t.error(r)}var n=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(n!=0){var r;for(var i=0;i<n.length;i++){r=n[i].Message+"\n"}t.show(r,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(){oThat.onPressCharacteristics()}})}}},error:function(e){oThat.BusyDialog.close();sap.m.MessageBox.error(e.responseText)}})},initiatePdfDialog:function(){var e=this;if(e.oPdfDialog){e.oPdfDialog.destroy()}e.oPdfDialog=new sap.m.Dialog({title:"PDF Preview",contentWidth:"80%",contentHeight:"600px",resizable:true,draggable:true,content:new sap.ui.core.HTML({content:"<div id='pdfContainer' style='height:100%;'></div>"}),buttons:[new sap.m.Button({text:"Print",type:"Emphasized",press:function(){var e=document.getElementById("pdfIframe");if(e&&e.contentWindow){e.contentWindow.focus();e.contentWindow.print()}else{sap.m.MessageToast.show("PDF not loaded yet.")}}}),new sap.m.Button({text:"Close",press:function(){e.oPdfDialog.close()}})]});e.getView().addDependent(e.oPdfDialog)},onPreviewPDF:function(e,t){var a=this;var o=a.oModel.sServiceUrl;var r="";var i="/QastatusprintSet(IvWbid='"+e+"',IvItem='"+t+"')/$value";var n=o+i;if(sap.ui.Device.system.desktop){a.initiatePdfDialog();var s="<div style='height:100%;'>"+"<iframe id='pdfIframe' src='"+n+"' width='100%' height='100%' frameborder='0'></iframe>"+"</div>";a.oPdfDialog.getContent()[0].setContent(s);a.oPdfDialog.addStyleClass("sapUiSizeCompact");a.oPdfDialog.open()}else{window.open(n)}if(a.Reprint){a.Reprint.destroy()}},onChangeHour:function(e){var t=e.getSource().getValue();e.getSource().setValueState("None");if(t<0||t>12){e.getSource().setValueState("Error");e.getSource().setValueStateText(oThat.oView.getModel("i18n").getResourceBundle().getText("Enter_Hour"))}},onSettings:function(e){if(!this._oTPC){this._oTPC=new n({table:oThat.oView.byId("pre_qual"),persoService:s}).activate()}this._oTPC.openDialog()},onTablePersoRefresh:function(){s.resetPersData();this._oTPC.refresh()},onNavBack:function(){if(this._oTP!=undefined){this._oTPC.destroy()}this.oRouter.navTo("Inbound")},onEscapeBatch:function(){oThat.Batch.destroy()},onEscapeQueue:function(){oThat.oQueueFrag.destroy()},onExit:function(){if(this._oTP!=undefined){this._oTPC.destroy()}},onClosePreEway:function(){oThat.oPreQAEway.destroyContent();oThat.oPreQAEway.close()},fnSaveApproveQA:function(e){var a=e.getSource().getId();var o;if(a.indexOf("id_BtnCharSaveChk")!=-1){oThat.IApprove="A"}else if(a.indexOf("id_BtnRejCharChek")!=-1){oThat.IApprove="R"}var r=this;var i={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IApprove:oThat.IApprove,PostBatchCharNav:[],PostReturnNav:[]};oThat.oModel.create("/PostBatchSet",i,{success:function(e,a){if(e.PostReturnNav.results[0].Type==="S"){t.success(e.PostReturnNav.results[0].Message,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(e){if(e=="OK"){r._onRouteMatched();oThat.oPreQAEway.destroyContent();oThat.oPreQAEway.close()}}})}else{t.error(e.PostReturnNav.results[0].Message)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})},fnSaveRejectQA:function(e){var a=e.getSource().getId();var o;if(a.indexOf("id_BtnCharSaveChk")!=-1){oThat.IApprove="A"}else if(a.indexOf("id_BtnRejCharChek")!=-1){oThat.IApprove="R"}var r={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IApprove:oThat.IApprove,PostBatchCharNav:[],PostReturnNav:[]};oThat.oModel.create("/PostBatchSet",r,{success:function(e,a){if(e.PostReturnNav.results[0].Type==="S"){t.success(e.PostReturnNav.results[0].Message,{icon:t.Icon.SUCCESS,actions:[t.Action.OK],onClose:function(e){if(e=="OK"){oThat.oPreQAEway.destroyContent();oThat._onRouteMatched();oThat.oPreQAEway.close()}}})}else{t.error(e.PostReturnNav.results[0].Message)}sap.ui.core.BusyIndicator.hide()},error:function(e){sap.ui.core.BusyIndicator.hide();t.error(e.message)}})}})});
//# sourceMappingURL=PreQuality_Check.controller.js.map