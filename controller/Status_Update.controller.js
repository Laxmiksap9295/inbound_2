var oThat;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/MessageToast","sap/ui/model/FilterOperator"],function(e,t,a,o,i,n,r){"use strict";return e.extend("ZGT_MM_INBOUND.controller.Status_Update",{onInit:function(){oThat=this;oThat.BusyDialog=new a;oThat.oView=this.getView();this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("Status").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){oThat.BusyDialog=new a;oThat=this;oThat.oView=oThat.getView();oThat.Core=sap.ui.getCore();oThat.oModel=oThat.getOwnerComponent().getModel();oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");oThat.oView.byId("id_InDate").setValue("");oThat.oView.byId("id_BtnSave").setVisible(false);oThat._getPlantData()},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GET"||oThat.Service==="CHECK"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SAVE"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e,a){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.oView.setModel(new o(e),"oStatusModel");oThat.oView.getModel("oStatusModel").refresh(true);if(e.StatusUpdateNav.results.length!=0){oThat.VehicleNo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.VehicleNo",oThat);oThat.oView.addDependent(oThat.VehicleNo);oThat.VehicleNo.open()}else{oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");n.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMSg16"))}}else if(oThat.Service==="CHECK"){if(e.GetReturnNav.results.length!=0){var i=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});var r="";if(i!=0){for(var l=0;l<i.length;l++){r=r+"\n"+i[l].Message}t.error(r)}}else{oThat.oView.byId("id_BtnSave").setVisible(true)}}else if(oThat.Service==="SAVE"){if(e.PostReturnNav.results.length!=0){var i=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(i!=0){t.error(i[0].Message)}var s=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(s!=0){t.success(s[0].Message);oThat.oView.byId("id_BtnSave").setVisible(false);oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");oThat.oView.byId("id_InDate").setValue("")}}else{oThat.oView.byId("id_BtnSave").setVisible(false);oThat.oView.byId("id_InReason").setValue("");oThat.oView.byId("id_InVehicleNo").setValue("");oThat.oView.byId("id_InWbid").setValue("");oThat.oView.byId("id_InDate").setValue("")}}},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},onDateChange:function(){oThat.onValueHelpPress()},onValueHelpPlantF4:function(e){oThat.vId=e.getSource().getId();e.getSource().setValueState("None");var t=this.getView().getModel("PlantF4");if(!t){n.show("No plant data available");return}if(!oThat.ValueHelpPlant){oThat.ValueHelpPlant=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Plant",this);oThat.getView().setModel(t,"F4Model");oThat.getView().addDependent(oThat.ValueHelpPlant)}oThat.ValueHelpPlant.open()},onValueHelpConfirmPlant:function(e){var t=e.getParameter("selectedItem");if(t){var a=t.getDescription();var o=sap.ui.getCore().byId(oThat.vId);o.setValue(a)}if(oThat.ValueHelpPlant){oThat.ValueHelpPlant.destroy();oThat.ValueHelpPlant=null}},onValueHelpSearch:function(e){var t=e.getParameter("value");var a=e.getSource().getBinding("items");if(!a)return;var o=a.getPath();var n;if(o.includes("F4PlantNav")){n=new i([new i("Werks",r.Contains,t),new i("Name1",r.Contains,t)],false)}else{n=new i([new i("Vehno",r.Contains,t),new i("Wbid",r.Contains,t)],false)}a.filter(n?[n]:[])},_getPlantData:function(){var e=this;return new Promise(function(t,a){var o=e.getView().getModel();var n=[new i("ProcessType",r.EQ,"X"),new i("Plant",r.EQ,"X"),new i("Vehtype",r.EQ,"X")];e.BusyDialog.open();o.read("/F4ParametersSet",{filters:n,urlParameters:{$expand:"F4DirectionNav,F4ProcessNav,F4PlantNav,F4TransporterNav,F4VehTypeNav"},success:function(a){e.BusyDialog.close();t(a);var o=a?.results?.[0]?.F4PlantNav?.results||[];var i=new sap.ui.model.json.JSONModel(a);e.getView().setModel(i,"PlantF4");if(o.length===1){var n=o[0].Plant||o[0].PlantCode||"";if(n){var r=e.getView().byId("id_InPlant");if(r){r.setValue(n)}}}else{var r=e.getView().byId("id_InPlant");if(r){r.setValue("")}}},error:function(t){e.BusyDialog.close();a(t)}})})},onValueHelpPress:function(e){var a=oThat.oView.byId("id_InDate").getValue();var o=oThat.oView.byId("id_InPlant").getValue();if(!o){return}if(a!==null&&a!==""){var a=oThat.oView.byId("id_InDate").getDateValue();var i=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var n=i.format(a);oThat.Service="GET";var r={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:o,StatusUpdate:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[{InDate:n}]}};oThat.onCallService(oThat.Service,r)}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6"))}},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");oThat.oView.byId("id_InVehicleNo").setValue(t.getTitle());oThat.oView.byId("id_InWbid").setValue(t.getDescription())},onPressCheck:function(e){if(oThat.oView.byId("id_InVehicleNo").getValue()===""||oThat.oView.byId("id_InWbid").getValue()===""||oThat.oView.byId("id_InDate").getValue()===""||oThat.oView.byId("id_InPlant").getValue()===""||oThat.oView.byId("id_InDate").getValue()==null){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg7"))}else{var a=oThat.oView.byId("id_InDate").getDateValue();var o=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var i=o.format(a);var n=oThat.oView.byId("id_InPlant").getValue();oThat.Service="CHECK";var r={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:oThat.oView.byId("id_InWbid").getValue(),IvWerks:n,StatusUpdate:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[{InDate:i,Vehno:oThat.oView.byId("id_InVehicleNo").getValue(),Wbid:oThat.oView.byId("id_InWbid").getValue(),Reason:oThat.oView.byId("id_InReason").getValue()}]}};oThat.onCallService(oThat.Service,r)}},onStatusSubmit:function(e){if(oThat.oView.byId("id_InReason").getValue()===""||oThat.oView.byId("id_InVehicleNo").getValue()===""||oThat.oView.byId("id_InWbid").getValue()===""||oThat.oView.byId("id_InDate").getValue()===""||oThat.oView.byId("id_InDate").getValue()==null){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg11"))}else{var a=oThat.oView.byId("id_InDate").getDateValue();var o=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var i=o.format(a);oThat.Service="SAVE";var n={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",StatusUpdate:"X",IvWboj:oThat.EvWtype,Outbound:"",PostReturnNav:[],PostWbHeaderNav:[],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};var r={Vehno:oThat.oView.byId("id_InVehicleNo").getValue(),Wbid:oThat.oView.byId("id_InWbid").getValue(),Erdat:i,Ertim:"PT00H00M00S",Tmode:"MOBILITY",Direction:"IN",Del:"X",Reason:oThat.oView.byId("id_InReason").getValue()};n.d.PostWbHeaderNav.push(r);oThat.onCallService(oThat.Service,n)}},onNavBack:function(){this.oRouter.navTo("Inbound")}})});
//# sourceMappingURL=Status_Update.controller.js.map