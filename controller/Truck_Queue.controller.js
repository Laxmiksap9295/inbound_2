var oThat;var sCurrentDirection="IN";sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/BusyDialog","sap/m/MessageToast"],function(e,t,r,n,o,s,a){"use strict";return e.extend("ZGT_MM_INBOUND.controller.Truck_Queue",{onInit:function(){oThat=this;this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("TruckQueue").attachMatched(this._onRouteMatched,this);this.oRouter.attachRouteMatched(e=>{const t=e.getParameter("name");if(t!=="TruckQueue"){this._stopAutoRefresh();console.log("⏹️ Auto refresh stopped due to route change:",t)}})},_onRouteMatched:function(e){var t=this;var r=this.getView();var n=r.byId("idRefreshTimer");var o=60;t._loadTruckData();if(this._refreshInterval)clearInterval(this._refreshInterval);if(this._countdownInterval)clearInterval(this._countdownInterval);if(typeof sCurrentDirection==="undefined"){sCurrentDirection="IN"}this._refreshInterval=setInterval(function(){sCurrentDirection=sCurrentDirection==="IN"?"OUT":"IN";console.log("Refreshing Truck Data for Direction:",sCurrentDirection);a.show("Refreshing Truck Data for Direction: "+sCurrentDirection);t._loadTruckData();o=60},6e4);this._countdownInterval=setInterval(function(){if(o>0){n.setText("Refreshing in "+o+"s ("+sCurrentDirection+")");o--}},1e3)},_stopAutoRefresh:function(){if(this._refreshInterval){clearInterval(this._refreshInterval);this._refreshInterval=null}if(this._countdownInterval){clearInterval(this._countdownInterval);this._countdownInterval=null}console.log("⏹️ Auto-refresh stopped.")},onExit:function(){this._stopAutoRefresh()},onBeforeRendering:function(){this._stopAutoRefresh()},onNavBack:function(){this._stopAutoRefresh();oThat.oRouter.navTo("Inbound")},_loadTruckData:function(){var e=this.getOwnerComponent().getModel();var a=[new n("Check",o.EQ,"X"),new n("Direction",o.EQ,sCurrentDirection)];oThat.BusyDialog=new s;oThat.BusyDialog.open();e.read("/GetTruckSet",{filters:a,urlParameters:{$expand:"InboundNav,OutBoundNav,ReturnNav"},success:function(e){oThat.BusyDialog.close();if(e.results&&e.results.length>0){var r=e.results[0];var n=new t({Inbound:r.InboundNav.results||[],Outbound:r.OutBoundNav.results||[],Direction:sCurrentDirection,Flags:{View:r.View,Edit:r.Edit}});this.getView().setModel(n,"TruckModel")}}.bind(this),error:function(e){oThat.BusyDialog.close();r.error(e.responseText)}})},onPrioritize:function(){oThat.BusyDialog=new s;if(sCurrentDirection==="IN"){var e=this.byId("idInboundTable");var t=e.getSelectedItem()}else{var a=this.byId("idOutboundTable");var t=a.getSelectedItem()}if(!t){sap.m.MessageToast.show(oThat.getView().getModel("i18n").getResourceBundle().getText("Pleaseselectrow"));return}var i=t.getBindingContext("TruckModel");var u=i.getObject();var l=i.getPath();var c=parseInt(l.split("/").pop(),10);var h=u.WbId;var d=new sap.m.Dialog({title:"Enter Reason for Prioritization",type:"Message",content:[new sap.m.Label({text:"Please enter reason:",labelFor:"reasonInput"}),new sap.m.Input("reasonInput",{width:"100%",placeholder:"Type your reason here for"+(h?" ("+h+")":"")})],beginButton:new sap.m.Button({text:"Submit",type:"Emphasized",press:function(){var e=sap.ui.getCore().byId("reasonInput").getValue().trim();if(!e){sap.ui.getCore().byId("reasonInput").setValueState("Error");sap.ui.getCore().byId("reasonInput").setValueStateText("Reason is mandatory");return}d.close();oThat.BusyDialog.open();var t=[new n("Check",o.EQ,"X"),new n("WbId",o.EQ,u.WbId),new n("Reason",o.EQ,e),new n("Direction",o.EQ,sCurrentDirection)];var s=oThat.getOwnerComponent().getModel();s.read("/GetTruckSet",{filters:t,urlParameters:{$expand:"InboundNav,OutBoundNav,ReturnNav"},success:function(e){oThat.BusyDialog.close();if(e.results&&e.results.length>0&&e.results[0].ReturnNav){var t=e.results[0].ReturnNav.results;if(t&&t.length>0){var r=t.filter(function(e){return e.Type==="E"});var n=t.filter(function(e){return e.Type==="S"});if(r.length>0){var o=r.map(function(e){return e.Message}).join("\n");sap.m.MessageBox.error(o)}else if(n.length>0){var s=n.map(function(e){return e.Message}).join("\n");sap.m.MessageBox.success(s,{onClose:function(e){oThat._loadTruckData()}.bind(this)})}}}}.bind(this),error:function(e){oThat.BusyDialog.close();r.error("OData Error: "+e.responseText)}})}}),endButton:new sap.m.Button({text:"Cancel",press:function(){d.close()}}),afterClose:function(){d.destroy()}});oThat.getView().addDependent(d);d.open()},onTableSelectionChange:function(e){var t=e.getSource();var r=this.getView();var n=r.byId("idInboundTable");var o=r.byId("idOutboundTable");if(t!==n){n.removeSelections(true)}if(t!==o){o.removeSelections(true)}}})});
//# sourceMappingURL=Truck_Queue.controller.js.map