var oThat;var plantFlag;var scanPlantFlag;jQuery.sap.require("sap.ndc.BarcodeScanner");sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/m/MessageToast","ZGT_MM_INBOUND/Util/Formatter"],function(e,t,a,o,i,r,l){"use strict";var s,n,d,n,g,T,h;return e.extend("ZGT_MM_INBOUND.controller.Truck_Reporting",{Formatter:l,onInit:function(){oThat=this;oThat.Images=[];oThat.BusyDialog=new a;oThat.oView=this.getView();oThat.VendorCFM="";oThat.oView.setModel(new o({}),"oDisplayModel");this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);oThat.oScannedAsnNubers=[];this.oRouter.getRoute("TruckReporting").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){oThat.BusyDialog=new a;oThat=this;oThat.oView=oThat.getView();oThat.Core=sap.ui.getCore();oThat.oView.setModel(new o,"oViewModel");oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false);oThat.oView.getModel("oViewModel").setProperty("/TransferProperty",false);oThat.oView.getModel("oViewModel").setProperty("/VendorIEProperty",false);oThat.getView().setModel(new sap.ui.model.json.JSONModel([]),"JmRem");oThat.oView.byId("id_InRemarksLabel").setVisible(false);oThat.oView.byId("id_InRemarks").setVisible(false);oThat.oView.byId("id_InMatDocLabel").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_InMatDoc").setTokens([]);oThat.oView.byId("id_InRemarks").setValue("");oThat.oView.byId("id_Rbref").setVisible(false);oThat.oView.byId("id_RefTb").setVisible(false);oThat.oView.byId("id_Rbref").setSelectedIndex(-1);oThat.oView.byId("id_Param7Key").setState(true);oThat.oView.byId("id_Vendor").setValue("");oThat.oView.byId("vTextId").setText("");oThat.oView.setModel(new o({}),"oDisplayModel");scanPlantFlag="";oThat.VendorCFM="";oThat.oAsnHeaderData="";oThat.oAsnItemData="";oThat.Asnnumber="";oThat.multiAsnHeader="";oThat.oMultiPlant="";oThat.oScannedAsnNubers=[];oThat.oView.byId("id_VehiNo").setEditable(true);oThat.oView.byId("id_VehicleTy").setEditable(true);oThat.oView.byId("id_InDriver").setEditable(true);oThat.oView.byId("id_InDriverMob").setEditable(true);oThat.oView.byId("id_InTransport").setEditable(true);oThat.oView.byId("id_VehicleTyCombo").setEditable(true);oThat.oView.byId("id_Vendor").setEditable(true);oThat.oView.byId("id_scanid").setEnabled(true);oThat.oView.byId("id_InPlant").setEditable(true);oThat.oView.byId("id_DeliveryF").setVisible(false);oThat.getView().byId("id_ParkingYard").setSelectedKey("");oThat.TruckReporting="";oThat.PoStoFlag="";if(e){oThat.EvVehGateEntry="X"}else{oThat.EvVehGateEntry="X"}var t={QRCode:true,Manual:false};oThat.oView.setModel(new o(t),"VISI");oThat.oView.getModel("VISI").refresh(true);oThat.oView.byId("id_POBtn").setVisible(false);oThat.oView.byId("id_ScanToolbar").setVisible(false);oThat.oView.byId("id_LblProcess").setVisible(false);oThat.oView.byId("id_ComboProcess").setVisible(false);oThat.oView.byId("id_scanid").setState(true);oThat.oView.byId("id_VendorBox").setVisible(false);if(oThat.EvVehGateEntry=="X"){oThat.oView.byId("id_POBtn").setVisible(true);oThat.oView.byId("id_ScanToolbar").setVisible(true);oThat.oView.byId("id_POBtn").setVisible(true);oThat.oView.byId("id_ScanToolbar").setVisible(true);oThat.oView.byId("id_LblProcess").setVisible(true);oThat.oView.byId("id_ComboProcess").setVisible(true)}oThat.oModel=oThat.getOwnerComponent().getModel();if(sap.ui.Device.system.phone){oThat.oDevice="P"}else{oThat.oDevice="D"}oThat.gVPlant="";oThat.onSetPostModel();oThat.aQRCodeArray=[];oThat.gVPlant="";oThat.gvPlantname="";oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true);oThat.oView.setModel(new o(oThat.aQRCodeArray),"POLIST");oThat.Service="F4Model";var r=[new i("ProcessType",sap.ui.model.FilterOperator.EQ,"X"),new i("Plant",sap.ui.model.FilterOperator.EQ,"X"),new i("Vehtype",sap.ui.model.FilterOperator.EQ,"X")];oThat.onCallService(oThat.Service,r);oThat.oDataInitial={Items:[{columnKey:"Challan",text:oThat.oView.getModel("i18n").getResourceBundle().getText("Delivery")}],ColumnsItems:[{columnKey:"Challan",visible:false,index:0}]};oThat.oDataBeforeOpen={};oThat.oPersonalModel=new o(jQuery.extend(true,{},oThat.oDataInitial));oThat.oView.setModel(oThat.oPersonalModel)},onSetPostModel:function(){oThat.gVPlant="";oThat.gvPlantname="";var e={Images:[],PoItem:[],Werks:oThat.gVPlant,Lifnr:"",Gate:"",Vehno:"",Vehtyp:"",Dname:"",DriverMob:"","Remark ":"",Wtype:"",Wbid:"",Erdat:null,Ertim:"PT00H00M00S",Challan:"",Token:"",Name1:oThat.gvPlantname,Wbname:"",VendorName:"",MatnrDesc:"",LifnrDesc:"",IvWbid:"",IvItem:"",DONo:"",ParkingYard:""};oThat.oView.setModel(new o(e),"POST");oThat.oView.byId("id_LblWbId").setVisible(false);oThat.oView.byId("id_InWbId").setVisible(false);oThat.oView.byId("id_LblWbItem").setVisible(false);oThat.oView.byId("id_InWbItem").setVisible(false);oThat.oView.byId("id_LblDoNo").setVisible(false);oThat.oView.byId("id_InDoNo").setVisible(false);oThat.oView.byId("id_Param7").setVisible(false);oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_InManualCFM").setTokens([]);oThat.oView.byId("id_InRefNo").setVisible(false);oThat.oView.byId("id_InRefNoValue").setValue("");oThat.oView.byId("id_Vendor").setEditable(true)},onGetPlantFlag:function(){oThat.oModel.read("/F4ParametersSet",{filters:[new i("IvWerks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)],urlParameters:{$expand:"F4DirectionNav"},success:function(e,t){if(e.results[0].EvFlagBrazil==="X"){oThat.oView.byId("id_driverno").setVisible(true);plantFlag="X"}else{oThat.oView.byId("id_driverno").setVisible(false);plantFlag=""}}.bind(this),error:function(e){}})},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GATE"){oThat.oModel.read("/F4GatesSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler});oThat.onGetPlantFlag()}else if(oThat.Service==="SAVE"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="VALIDATE"||oThat.Service=="PDF"||oThat.Service=="VEHICLE"||oThat.Service=="VALIDWBID"||oThat.Service=="VALIDDELIVERY"||oThat.Service=="VEHICLEVALIDATE"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="F4Model"){oThat.oModel.read("/F4ParametersSet",{filters:t,urlParameters:{$expand:"F4DirectionNav,F4ProcessNav,F4PlantNav,F4TransporterNav,F4VehTypeNav"},success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="MaterialF4"){oThat.oModel.read("/F4MaterialSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="Vendor"){oThat.oModel.read("/F4TransportersSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="REPRINT"){oThat.oModel.create("/GetHeadersSet",t,{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service=="TruckTypeCombo"){oThat.oModel.read("/F4ParametersSet",{filters:t,urlParameters:{$expand:"F4TruckTypeSetNav"},success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e,a){oThat.BusyDialog.close();if(oThat.Service==="GATE"){if(e.results.length===1){oThat.getView().byId("id_InGate").setValue(e.results[0].Gate+" - "+e.results[0].Wbname);oThat.oView.getModel("POST").getData().Gate=e.results[0].Gate;oThat.oView.getModel("POST").getData().Wbname=e.results[0].Wbname;oThat.vWb=e.results[0].Wbobj}oThat.oView.setModel(new o(e),"GATE")}else if(oThat.Service==="SAVE"){oThat._onRouteMatched();if(e.PostReturnNav.results.length!=0){var i=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(i!=0){t.error(i[0].Message)}var l=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(l!=0){oThat.oView.byId("id_Vendor").setValue("");oThat.oView.byId("id_VendorBox").setVisible(false);if(e.PostWbHeaderNav.results[0].Challan!=""){oThat.oView.byId("id_InManual").setEnabled(true)}scanPlantFlag="";oThat.aQRCodeArray=[];oThat.oView.getModel("POLIST").setData(oThat.aQRCodeArray);oThat.oView.getModel("POLIST").refresh(true);oThat.oView.setModel(new o(e),"RETURN");oThat.onSetPostModel();t.show(l[0].Message,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(a){oThat.onDmsPost(e.PostWbHeaderNav.results[0].Wbid);if(a==="OK"){oThat.oView.getModel("POST").getData().Werks="";oThat.oView.getModel("POST").refresh();t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){var a=e.PostWbHeaderNav.results[0].Wbid;var i=oThat.oModel.sServiceUrl;var r="";var l="/DownloadSet(IvWbid='"+a+"',IvPrint='X',GateEntry='X',IvBatch='"+r+"')/$value";var s=i+l;if(sap.ui.Device.system.desktop){oThat.initiatePdfDialog();var n="<div><iframe src="+s+" width='100%' height='520'></iframe></div>";oThat.oImageDialog.getContent()[0].setContent(n);oThat.oImageDialog.addStyleClass("sapUiSizeCompact");oThat.oImageDialog.open()}else{window.open(s)}scanPlantFlag="";oThat.aQRCodeArray=[];oThat.oView.getModel("POLIST").setData(oThat.aQRCodeArray);oThat.oView.getModel("POLIST").refresh(true);oThat.oView.setModel(new o(e),"RETURN");oThat.onSetPostModel()}else{scanPlantFlag="";oThat.aQRCodeArray=[];oThat.oView.getModel("POLIST").setData(oThat.aQRCodeArray);oThat.oView.getModel("POLIST").refresh(true);oThat.oView.setModel(new o(e),"RETURN");oThat.onSetPostModel()}}})}}})}}else{oThat.aQRCodeArray=[];oThat.oView.getModel("POLIST").setData(oThat.aQRCodeArray);oThat.oView.getModel("POLIST").refresh(true);oThat.oView.byId("id_InManual").setEnabled(true);oThat.oView.setModel(new o(e),"RETURN")}}else if(oThat.Service=="VALIDATE"){if(e.GetReturnNav.results.length!=0){var i=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});var s="";if(i!=0){for(var n=0;n<i.length;n++){s=s+"\n"+i[0].Message}t.error(s);if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="C"){oThat.oView.getModel("POST").getData().DONo="";oThat.oView.getModel("POST").refresh(true);oThat.oView.getModel("POST").refresh()}}else{var d="";var g=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(g.length!=0){d=g[0].Process}if(d=="TRIP"){oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_WbIdItem").setValue("");oThat.oView.getModel("POST").getData().IvWbid=e.IvWbid;oThat.oView.getModel("POST").getData().IvItem=e.IvItem;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().Wbname=e.WbHeaderNav.results[0].GateName;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Token=e.WbHeaderNav.results[0].Token;oThat.oView.getModel("POST").getData().Wbid=e.WbHeaderNav.results[0].Wbid;if(e.WbHeaderNav.results[0].Gate!=""){oThat.vWb="WB";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Gate}if(e.WbHeaderNav.results[0].Wsgate!=""){oThat.vWb="WS";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Wsgate}if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}if(e.WbHeaderNav.results[0].Vehno!==""&&e.WbHeaderNav.results[0].Vehno!==undefined){oThat.oView.byId("id_VehiNo").setValueState("None")}oThat.oView.getModel("POLIST").setData(e.WbItemNav.results);oThat.oView.getModel("POLIST").refresh();if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="C"){oThat.oView.getModel("POST").getData().DONo=e.WbItemNav.results[0].Config10}oThat.oView.getModel("POST").refresh(true)}else{oThat.oView.byId("id_InManual").setValue("");if(oThat.oView.byId("id_MatnrDesc").getText()){oThat.oView.byId("id_MatnrDesc").setText("");oThat.oView.getModel("POST").getData().MatnrDesc="";oThat.oView.getModel("POST").refresh()}if(e.PoItemNav.results.length>0){if(e.PoItemNav.results[0].FLAG==="X"){oThat.oView.byId("id_driverno").setVisible(true);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);if(d!=="RETURN"){oThat.oView.getModel("oViewModel").setProperty("/BagProperty",true)}else{oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false)}oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true)}else{oThat.oView.byId("id_driverno").setVisible(false);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false)}}if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text3")){oThat.oView.setModel(new o(e.PoItemNav),"oPoitemModel");oThat.oView.getModel("oPoitemModel").refresh();oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open();if(plantFlag==="X"){if(scanPlantFlag==="X"){oThat.onScanPost()}}}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){e.PoItemNav.results[0].Parnr=oThat.oView.byId("id_Vendor").getValue();oThat.oView.getModel("POLIST").getData().push(e.PoItemNav.results[0]);oThat.oView.getModel("POLIST").refresh(true)}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){if(e.WbHeaderNav.results.length!=0){oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh()}oThat.oView.setModel(new o(e.DelItemNav),"oPoitemModel");oThat.oView.getModel("oPoitemModel").refresh();oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.DelItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}}}}else{var d="";var g=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(g.length!=0){d=g[0].Process}if(d=="TRIP"){oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_WbIdItem").setValue("");oThat.oView.getModel("POST").getData().IvWbid=e.WbItemNav.results[0].Wbid;oThat.oView.getModel("POST").getData().IvItem=e.WbItemNav.results[0].Item;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().Wbname=e.WbHeaderNav.results[0].GateName;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Token=e.WbHeaderNav.results[0].Token;oThat.oView.getModel("POST").getData().Wbid=e.WbHeaderNav.results[0].Wbid;if(e.WbHeaderNav.results[0].Gate!=""){oThat.vWb="WB";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Gate}if(e.WbHeaderNav.results[0].Wsgate!=""){oThat.vWb="WS";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Wsgate}if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}if(e.WbHeaderNav.results[0].Vehno!==""&&e.WbHeaderNav.results[0].Vehno!==undefined){oThat.oView.byId("id_VehiNo").setValueState("None")}oThat.oView.getModel("POLIST").setData(e.WbItemNav.results);oThat.oView.getModel("POLIST").refresh();if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="C"){oThat.oView.getModel("POST").getData().DONo=e.WbItemNav.results[0].Config10}oThat.oView.getModel("POST").refresh(true)}else{oThat.oView.byId("id_InManual").setValue("");if(oThat.oView.byId("id_MatnrDesc").getText()){oThat.oView.byId("id_MatnrDesc").setText("");oThat.oView.getModel("POST").getData().MatnrDesc="";oThat.oView.getModel("POST").refresh()}if(e.PoItemNav.results.length>0){if(e.PoItemNav.results[0].FLAG==="X"){oThat.oView.byId("id_driverno").setVisible(true);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true);if(d!=="RETURN"){oThat.oView.getModel("oViewModel").setProperty("/BagProperty",true)}else{oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false)}plantFlag="X"}else{oThat.oView.byId("id_driverno").setVisible(false);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false);plantFlag=""}}if(e.DelItemNav.results.length>0){if(e.DelItemNav.results[0].Flag==="X"){oThat.oView.byId("id_driverno").setVisible(true);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true);if(d!=="RETURN"){oThat.oView.getModel("oViewModel").setProperty("/BagProperty",true)}else{oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false)}plantFlag="X"}else{oThat.oView.byId("id_driverno").setVisible(false);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false);plantFlag=""}}if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text3")){oThat.oView.setModel(new o(e.PoItemNav),"oPoitemModel");if(plantFlag==="X"){if(scanPlantFlag==="X"){for(var T=0;T<e.PoItemNav.results.length;T++){oThat.scanArry.results.push(e.PoItemNav.results[T])}if(oThat.scanArry.results.length===oThat.aData.length){oThat.oView.setModel(new o(oThat.scanArry),"oPoitemModel");oThat.onScanPost()}}else{oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}}else if(oThat.Asnnumber){var h=oThat.oView.getModel("oPoitemModel").getData().results;var V=oThat.oAsnItemData;function I(e){return e.replace(/^0+/,"")}V.forEach(function(e){var t=e.Ponumber;var a=e.PoitemId;var o=e.Material.match(/\d+/)[0];var i=I(o);var r=h.filter(function(e){return e.Ebeln===t&&I(e.Matnr)===i&&e.Ebelp===a});if(Object.keys(r).length){r[0].AsnNumber=oThat.Asnnumber}if(r.length){Array.prototype.push.apply(oThat.oView.getModel("POLIST").getData(),r)}});oThat.oView.getModel("POLIST").refresh()}else{oThat.PoStoFlag=e.PoStoFlag;if(oThat.oView.getModel("POST").getData().Wtype==="01"&&oThat.PoStoFlag==="X"){oThat.oView.byId("id_DeliveryF").setVisible(true)}else{oThat.oView.byId("id_DeliveryF").setVisible(false)}oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="H"){if(e.Transfer==="X"){e.PoItemNav.results[0].Parnr=oThat.oView.byId("id_Vendor").getValue();e.PoItemNav.results[0].Vendor=oThat.oView.byId("id_Vendor").getValue();e.PoItemNav.results[0].Vname=oThat.oView.byId("vTextId").getText();oThat.oView.getModel("POLIST").refresh(true);oThat.oView.getModel("oViewModel").setProperty("/TransferProperty",true);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/Spotproperty",false);oThat.oView.getModel("oViewModel").setProperty("/BagProperty",false);oThat.oView.byId("id_driverno").setVisible(true);oThat.oView.setModel(new o(e.PoItemNav),"oPoitemModel");oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}else{if(oThat.oView.getModel("oViewModel").getData().CMSProperty!==true){e.PoItemNav.results[0].Parnr=oThat.oView.byId("id_Vendor").getValue();for(var n=0;n<e.PoItemNav.results.length;n++){oThat.oView.getModel("POLIST").getData().push(e.PoItemNav.results[n])}oThat.oView.getModel("POLIST").refresh(true)}}}if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"&&d!=="TRANSFER"){if(oThat.oView.getModel("oViewModel").getData().CMSProperty!==true){e.PoItemNav.results[0].Parnr=oThat.oView.byId("id_Vendor").getValue();for(var n=0;n<e.PoItemNav.results.length;n++){oThat.oView.getModel("POLIST").getData().push(e.PoItemNav.results[n])}oThat.oView.getModel("POLIST").refresh(true)}}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"&&d=="TRANSFER"){oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_WbIdItem").setValue("");oThat.oView.getModel("POST").getData().IvWbid=e.IvWbid;oThat.oView.getModel("POST").getData().IvItem=e.IvItem;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().Wbname=e.WbHeaderNav.results[0].GateName;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Token=e.WbHeaderNav.results[0].Token;oThat.oView.getModel("POST").getData().Wbid=e.WbHeaderNav.results[0].Wbid;if(e.WbHeaderNav.results[0].Gate!=""){oThat.vWb="WB";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Gate}if(e.WbHeaderNav.results[0].Wsgate!=""){oThat.vWb="WS";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Wsgate}if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}if(e.WbHeaderNav.results[0].Vehno!==""&&e.WbHeaderNav.results[0].Vehno!==undefined){oThat.oView.byId("id_VehiNo").setValueState("None")}oThat.oView.getModel("POLIST").setData(e.WbItemNav.results);oThat.oView.getModel("POLIST").refresh();if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="C"){oThat.oView.getModel("POST").getData().DONo=e.WbItemNav.results[0].Config10}oThat.oView.getModel("POST").refresh(true)}if(e.PoItemNav.results.length>0){if(e.PoItemNav.results[0].FLAG==="X"){oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/Spotproperty",false);oThat.oView.getModel("oViewModel").setProperty("/VendorIEProperty",true);oThat.oView.setModel(new o(e.PoItemNav),"oPoitemModel");if(plantFlag==="X"){if(scanPlantFlag==="X"){for(var T=0;T<e.PoItemNav.results.length;T++){oThat.scanArry.results.push(e.PoItemNav.results[T])}if(oThat.scanArry.results.length===oThat.aData.length){oThat.oView.setModel(new o(oThat.scanArry),"oPoitemModel");oThat.onScanPost()}}else{oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}}else{oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag)}}}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){if(e.WbHeaderNav.results.length!=0){oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Wbid=e.WbHeaderNav.results[0].Wbid;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh();oThat.oView.getModel("oDisplayModel").getData().EvOrigin=e.EvOrigin;oThat.oView.getModel("oDisplayModel").refresh()}oThat.oView.setModel(new o(e.DelItemNav),"oPoitemModel");oThat.oView.getModel("oPoitemModel").refresh();if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="L"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="J"){oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.DelItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.open()}else{oThat.onClosePoIteList()}}}}}else if(oThat.Service=="VEHICLE"){if(e.GetReturnNav.results.length!=0){var i=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e.Message}});var s="";for(var n=0;n<e.GetReturnNav.results.length;n++){s=s+"\n"+e.GetReturnNav.results[n].Message}if(i.length!=0){t.error(s);oThat.oView.getModel("POST").getData().Vehno=""}oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh(true);if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}}else{oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh(true);if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}}}else if(oThat.Service=="VEHICLEVALIDATE"){if(e.GetReturnNav.results.length!=0){var i=[];i=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e.Message}});var s="";for(var n=0;n<e.GetReturnNav.results.length;n++){s=s+"\n"+e.GetReturnNav.results[n].Message}if(i.length!=0){t.error(s);oThat.oView.getModel("POST").getData().Vehno=""}oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh(true);if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}if(i.length==0){oThat.onPressSave()}}else{oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh(true);if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}oThat.onPressSave()}}else if(oThat.Service==="F4Model"){oThat.getOwnerComponent().getModel("F4Model").setData(e);oThat.getOwnerComponent().getModel("F4Model").refresh(true);oThat.oView.getModel("POST").getData().EvSixtyBag=e.results[0].EvSixtyBag;if(oThat.getOwnerComponent().getModel("F4Model").getData().results[0].F4PlantNav.results.length==1){oThat.oView.getModel("POST").getData().Werks=e.results[0].F4PlantNav.results[0].Werks;oThat.oView.getModel("POST").getData().Name1=e.results[0].F4PlantNav.results[0].Name1;oThat.SelectedPlant=e.results[0].F4PlantNav.results[0];oThat.gVPlant=e.results[0].F4PlantNav.results[0].Werks;oThat.gvPlantname=e.results[0].F4PlantNav.results[0].Name1;oThat.oView.getModel("POST").refresh();var u={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:"",TruckReport:"X",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.oModel.create("/GetHeadersSet",u,{success:function(e,t){oThat.oView.setModel(new o(e),"oDisplayModel");if(e.EvWithoutwb==="X"){oThat.oView.byId("id_Param7").setVisible(true)}else{oThat.oView.byId("id_Param7").setVisible(false)}oThat.oView.byId("id_LblWbId").setVisible(false);oThat.oView.byId("id_InWbId").setVisible(false);oThat.oView.byId("id_LblWbItem").setVisible(false);oThat.oView.byId("id_InWbItem").setVisible(false);oThat.oView.byId("id_LblDoNo").setVisible(false);oThat.oView.byId("id_InDoNo").setVisible(false);oThat.oView.byId("id_POBtn").setVisible(true);if(oThat.oView.getModel("POST").getData().Wtype==="04"){if(e.EvOrigin==="A"||e.EvOrigin==="B"||e.EvOrigin==="D"||e.EvOrigin==="F"||e.EvOrigin==="G"||e.EvOrigin==="I"){oThat.oView.byId("id_LblWbId").setVisible(true);oThat.oView.byId("id_InWbId").setVisible(true);oThat.oView.byId("id_LblWbItem").setVisible(true);oThat.oView.byId("id_InWbItem").setVisible(true);oThat.oView.byId("id_POBtn").setVisible(false)}else if(e.EvOrigin==="C"){oThat.oView.byId("id_LblDoNo").setVisible(true);oThat.oView.byId("id_InDoNo").setVisible(true)}}if(plantFlag==="X"){oThat.Service="GATE";oThat.onCallService(oThat.Service)}},error:function(e){}})}}else if(oThat.Service==="Transport"){oThat.oView.setModel(new o(e),"oTrnsportModel");oThat.oView.getModel("oTrnsportModel").refresh(true)}else if(oThat.Service=="MaterialF4"){var w=new o(e);w.setSizeLimit(e.length);oThat.oView.setModel(w,"Material")}else if(oThat.Service=="Vendor"){var w=new o(e);w.setSizeLimit(e.length);oThat.oView.setModel(w,"Vendor")}else if(oThat.Service==="REPRINT"){oThat.oView.setModel(new o(e),"oStatusModel");oThat.oView.getModel("oStatusModel").refresh(true);if(e.StatusUpdateNav.results.length!=0){oThat.VehicleNo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.VehicleNo",oThat);oThat.oView.addDependent(oThat.VehicleNo);oThat.VehicleNo.open()}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMSg16"))}}else if(oThat.Service==="TruckTypeCombo"){var w=new o;var b=e.results[0].F4TruckTypeSetNav.results;if(b.length>0){w.setData(b);oThat.oView.setModel(w,"TruckTypeComboModel");oThat.oView.byId("id_VehicleTy").setVisible(false);oThat.oView.byId("id_VehicleTyCombo").setVisible(true)}else{oThat.oView.byId("id_VehicleTy").setVisible(true);oThat.oView.byId("id_VehicleTyCombo").setVisible(false)}}else if(oThat.Service==="VALIDWBID"){if(e.GetReturnNav.results.length!=0){var i=e.GetReturnNav.results.filter(function(e){return e.Type==="E"});var s="";for(var n=0;n<e.GetReturnNav.results.length;n++){s=s+"\n"+e.GetReturnNav.results[n].Message}if(i.length!=0){oThat.oView.getModel("POST").getData().Wbid="";oThat.oView.getModel("POST").getData().Token="";oThat.oView.getModel("POST").refresh();t.error(s)}}else{oThat.oView.getModel("POST").setData(e.WbHeaderNav.results[0]);oThat.oView.getModel("POST").getData().Token=e.IvWbid;oThat.oView.getModel("POST").getData().Wtype="05";oThat.oView.setModel(new o(e),"ReferenceWbModel");if(e.WbHeaderNav.results[0].Gate!=""){oThat.vWb="WB";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Gate}else{oThat.vWb="WS";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Wsgate}if(e.WsItemNav.results.length!=0){oThat.oView.getModel("POLIST").setData(e.WsItemNav.results);oThat.oView.getModel("POLIST").refresh()}else if(e.WbItemNav.results.length!=0){oThat.oView.getModel("POLIST").setData(e.WbItemNav.results);oThat.oView.getModel("POLIST").refresh()}var M=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.find(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(M){if(M.Po=="X"){oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text3"));oThat.oView.byId("id_VendorBox").setVisible(false);oThat.oView.byId("id_InManual").setMaxLength(11);oThat.oView.byId("id_InManual").setShowValueHelp(false);oThat.oView.byId("id_InManual").setValue("")}else if(M.Po=="M"){oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text21"));oThat.oView.byId("id_VendorBox").setVisible(true);oThat.oView.byId("id_InManual").setMaxLength(18);oThat.oView.byId("id_InManual").setShowValueHelp(true);oThat.oView.byId("id_InManual").setValue("")}else{oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text4"));oThat.oView.byId("id_VendorBox").setVisible(false);oThat.oView.byId("id_InManual").setMaxLength(10);oThat.oView.byId("id_InManual").setShowValueHelp(false);oThat.oView.byId("id_InManual").setValue("")}}oThat.oView.getModel("POST").refresh()}}else if(oThat.Service==="VALIDDELIVERY"){if(e.GetReturnNav.results.length!=0){var i=e.GetReturnNav.results.filter(function(e){return e.Type==="E"});var s="";for(var n=0;n<e.GetReturnNav.results.length;n++){s=s+"\n"+e.GetReturnNav.results[n].Message}if(i.length!=0){oThat.oView.getModel("POST").getData().Challan="";oThat.oView.getModel("POST").refresh();t.error(s)}else{oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh();oThat.oView.byId("id_InManual").setEnabled(false);oThat.oView.byId("id_ToolbarManual").setVisible(false);oThat.oView.setModel(new o(e.DelItemNav),"oPoitemModel");oThat.oView.getModel("oPoitemModel").refresh();oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.DelItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.setEscapeHandler(oThat.onEscapeHandler);oThat.oPoItemFrag.open()}}else{oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").refresh();oThat.oView.byId("id_InManual").setEnabled(false);oThat.oView.byId("id_ToolbarManual").setVisible(false);oThat.oView.setModel(new o(e.DelItemNav),"oPoitemModel");oThat.oView.getModel("oPoitemModel").refresh();oThat.oPoItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.DelItemList",oThat);oThat.oView.addDependent(oThat.oPoItemFrag);oThat.oPoItemFrag.setEscapeHandler(oThat.onEscapeHandler);oThat.oPoItemFrag.open()}}},onEscapeHandler:function(e){oThat.oPoItemFrag.destroy()},onScanPost:function(){if(this.ahead[0]==="IN - Purchase"){oThat.getView().getModel("POST").getData().Wtype="01";oThat.onNotaFiscalChangeQR();oThat.onClosePoIteList()}else{oThat.getView().getModel("POST").getData().Wtype="05";oThat.onNotaFiscalChangeQR();oThat.onClosePoIteList()}},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},onValueHelpPress:function(e){oThat.vId=e.getSource().getId();e.getSource().setValueState("None");if(oThat.vId.indexOf("id_InPlant")!=-1){oThat.ValueHelp=sap.ui.xmlfragment(oThat.vId,"ZGT_MM_INBOUND.Fragments.Plant",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open()}else if(oThat.vId.indexOf("id_InGate")!=-1){if(oThat.oView.getModel("POST").getData().Werks!=""){oThat.ValueHelp=sap.ui.xmlfragment(oThat.vId,"ZGT_MM_INBOUND.Fragments.Gate",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open();oThat.Service="GATE";var a=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,a)}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("Plant_Mandatory"))}}else if(oThat.vId.indexOf("id_InTransport")!=-1){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Transporter",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open();oThat.Service="Vendor";var a=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,a)}else if(oThat.vId.indexOf("id_Vendor")!=-1){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Vendor",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.open();oThat.Service="Vendor";var a=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,a)}else if(oThat.vId.indexOf("id_InManual")!=-1){var o="";var r=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(r.length!=0){o=r[0].Process}oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.MaterialF4",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.setMultiSelect(false);oThat.ValueHelp.open();oThat.Service="MaterialF4";var a=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,a)}},fnCfmMatHelp:function(){var e=false;if(!oThat.getView().byId("id_Param7").getVisible()){if(oThat.getView().byId("id_Rbref").getVisible()){if(oThat.getView().byId("id_Rbref").getSelectedIndex()==-1){e=true}}}if(!e){var t=oThat.oView.getModel("POLIST").getData();if(t.length>0){if(t[0].Pmblnr!==""||t[0].Remarks!==""){var a=oThat.oView.getModel("i18n").getResourceBundle().getText("ListExitsed");sap.m.MessageBox.show(a,{icon:sap.m.MessageBox.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Warning"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e==sap.m.MessageBox.Action.YES){oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.MaterialF4CFM",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.setMultiSelect(true);oThat.ValueHelp.open();oThat.Service="MaterialF4";var t=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,t);oThat.oView.getModel("POLIST").setData([]);oThat.oView.byId("id_InManualCFM").setTokens([]);oThat.oView.byId("id_InManualCFM").setValue("")}else{sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ActCanc"))}}})}else{oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.MaterialF4CFM",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.setMultiSelect(true);oThat.ValueHelp.open();oThat.Service="MaterialF4";var o=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,o)}}else{oThat.ValueHelp=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.MaterialF4CFM",oThat);oThat.oView.addDependent(oThat.ValueHelp);oThat.ValueHelp.setMultiSelect(true);oThat.ValueHelp.open();oThat.Service="MaterialF4";var o=[new i("Werks",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("POST").getData().Werks)];oThat.onCallService(oThat.Service,o)}}else{sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("PlsSelectRefType"))}},onValueHelpConfirmCFM:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("id_InManualCFM");var o=a.getTokens();var i=e.getParameter("selectedItems");var r=i.length;var l=[];var s=1;for(var n=0;n<r;n++){var d=new sap.m.Token({text:i[n].getTitle(),key:i[n].getTitle()});o.push(d)}var g=[];var T=[];T=o.filter(function(e){if(g.indexOf(e.getKey())===-1){g.push(e.getKey());return true}return false});a.removeAllTokens();a.setTokens(T)},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");if(oThat.vId.indexOf("id_InPlant")!=-1){oThat.oView.getModel("POST").getData().Werks=t.getDescription();oThat.oView.getModel("POST").getData().Name1=t.getTitle();oThat.oView.getModel("POST").refresh(true)}else if(oThat.vId.indexOf("id_InGate")!=-1){oThat.oView.getModel("POST").getData().Gate=t.getTitle();oThat.oView.getModel("POST").getData().Wbname=t.getNumber();oThat.vWb=t.getNumberUnit()}else if(oThat.vId.indexOf("id_InTransport")!=-1){oThat.oView.getModel("POST").getData().Lifnr=t.getDescription();oThat.oView.getModel("POST").getData().LifnrDesc=t.getTitle()}else if(oThat.vId.indexOf("id_Vendor")!=-1){oThat.oView.byId("id_Vendor").setValue(t.getDescription());oThat.oView.getModel("POST").getData().VendorName=t.getTitle();if(oThat.oView.getModel("POLIST")){if(oThat.oView.byId("id_POBtn").getText()!==oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){if(oThat.oView.getModel("POLIST").getData().length>0){oThat.oView.getModel("POLIST").getData().forEach(function(e){e.Parnr=t.getDescription()});oThat.VendorCFM=t.getDescription()}else{oThat.VendorCFM=t.getDescription()}}}}else if(oThat.vId.indexOf("id_InManual")!=-1){oThat.oView.byId("id_InManual").setValue(t.getTitle());oThat.oView.getModel("POST").getData().MatnrDesc=t.getDescription()}else if(oThat.vId.indexOf("id_InManualCFM")!=-1&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"){var a=this.getView().byId("id_InManualCFM");var o=a.getTokens();var i=e.getParameter("selectedItems");var r=i.length;var l=[];var s=1;for(var n=0;n<r;n++){var d=new sap.m.Token({text:i[n].getTitle(),key:i[n].getTitle()});o.push(d)}var g=[];var T=[];T=o.filter(function(e){if(g.indexOf(e.getKey())===-1){g.push(e.getKey());return true}return false});a.removeAllTokens();a.setTokens(T)}else if(oThat.vId.indexOf("id_InVehicleNo")!=-1){var t=e.getParameter("selectedItem");sap.ui.getCore().byId("id_InVehicleNo").setValue(t.getTitle());sap.ui.getCore().byId("id_InWbid").setValue(t.getDescription())}oThat.oView.getModel("POST").refresh(true);oThat.ValueHelp.destroy()},onValueHelpSearch:function(e){var t=e.getParameter("value");var a;if(oThat.vId.indexOf("id_InPlant")!=-1){a=new sap.ui.model.Filter([new i("Werks",sap.ui.model.FilterOperator.Contains,t),new i("Name1",sap.ui.model.FilterOperator.Contains,t)])}else if(oThat.vId.indexOf("id_InGate")!=-1){a=new sap.ui.model.Filter([new i("Gate",sap.ui.model.FilterOperator.Contains,t)])}else if(oThat.vId.indexOf("id_InTransport")!=-1){a=new sap.ui.model.Filter([new i("Lifnr",sap.ui.model.FilterOperator.Contains,t),new i("Name1",sap.ui.model.FilterOperator.Contains,t)])}else if(oThat.vId.indexOf("id_Vendor")!=-1){a=new sap.ui.model.Filter([new i("Lifnr",sap.ui.model.FilterOperator.Contains,t),new i("Name1",sap.ui.model.FilterOperator.Contains,t),new i("Stcd3",sap.ui.model.FilterOperator.Contains,t)])}else if(oThat.vId.indexOf("id_InManual")!=-1){a=new sap.ui.model.Filter([new i("Matnr",sap.ui.model.FilterOperator.Contains,t),new i("Maktx",sap.ui.model.FilterOperator.Contains,t)])}else if(oThat.vId.indexOf("id_InVehicleNo")!=-1){a=new sap.ui.model.Filter([new i("Vehno",sap.ui.model.FilterOperator.Contains,t),new i("Wbid",sap.ui.model.FilterOperator.Contains,t)])}var o=new sap.ui.model.Filter(a,false);var r=e.getSource().getBinding("items");r.filter([o])},onValueHelpSearchMat:function(e){var t=e.getParameter("value");var a;a=new sap.ui.model.Filter([new i("Matnr",sap.ui.model.FilterOperator.Contains,t),new i("Maktx",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var r=e.getSource().getBinding("items");r.filter([o])},onValueHelpCancel:function(){oThat.ValueHelp.destroy()},onValueHelpConfirmPlant:function(e){var a=e.getParameter("selectedItem");oThat.oView.getModel("POST").getData().Werks=a.getDescription();oThat.oView.getModel("POST").getData().Name1=a.getTitle().trim();oThat.SelectedPlant=e.getParameter("selectedItem").getBindingContext("F4Model").getObject();oThat.gVPlant=a.getDescription();oThat.gvPlantname=a.getTitle();oThat.oView.getModel("POST").refresh(true);oThat.TruckReporting=oThat.SelectedPlant.TruckReport;if(oThat.TruckReporting==="X"){oThat.oView.byId("id_TruckSave").setEnabled(true);oThat.BusyDialog.open();var r=[new i("Plant",sap.ui.model.FilterOperator.EQ,a.getDescription())];var l=oThat.getOwnerComponent().getModel();l.read("/F4ParkingYardSet",{filters:r,success:function(e){oThat.BusyDialog.close();if(e.results&&e.results.length>0){var t=new o;t.setData(e.results);oThat.oView.setModel(t,"ParkingYardComboModel")}}.bind(this),error:function(e){oThat.BusyDialog.close();t.error("OData Error: "+e.responseText)}})}else{var s=oThat.oView.getModel("POLIST");if(s){s.setData([])}oThat.oView.byId("id_TruckSave").setEnabled(false);oThat.BusyDialog.close();t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("TruckError"));return}oThat.Service="GATE";var n=[new i("Werks",sap.ui.model.FilterOperator.EQ,a.getDescription())];oThat.onCallService(oThat.Service,n);var d=oThat.getOwnerComponent().getModel("F4Model").getData().results[0].F4PlantNav.results.filter(e=>e.Werks===a.getDescription());var g=d[0].Param;if(oThat.oView.getModel("POST").getData().Wtype=="05"&&g=="E"){oThat.oView.byId("id_VehicleTy").setValue("");oThat.oView.byId("id_VehicleTyCombo").setValue("");oThat.oView.getModel("POST").getData().Vehtyp="";oThat.Service="TruckTypeCombo";var T=[new i("TruckTypeGQ",sap.ui.model.FilterOperator.EQ,"X"),new i("IvWerks",sap.ui.model.FilterOperator.EQ,a.getDescription())];oThat.onCallService(oThat.Service,T)}else{oThat.oView.byId("id_VehicleTy").setValue("");oThat.oView.byId("id_VehicleTyCombo").setValue("");oThat.oView.getModel("POST").getData().Vehtyp="";oThat.oView.byId("id_VehicleTy").setVisible(true);oThat.oView.byId("id_VehicleTyCombo").setVisible(false)}var h={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:a.getDescription(),IvMatnr:"",TruckReport:"X",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};oThat.oModel.create("/GetHeadersSet",h,{success:function(e,t){oThat.oView.setModel(new o(e),"oDisplayModel");if(e.EvWithoutwb==="X"){oThat.oView.byId("id_Param7").setVisible(true)}else{oThat.oView.byId("id_Param7").setVisible(false);var a="";var i=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(i.length!=0){a=i[0].Process}if(e.EvOrigin==="H"&&a=="TRANSFER"){oThat.getView().byId("id_RefTb").setVisible(true);oThat.getView().byId("id_Rbref").setVisible(true)}else{oThat.getView().byId("id_RefTb").setVisible(false);oThat.getView().byId("id_Rbref").setVisible(false)}}oThat.oView.byId("id_VehiNo").setEditable(true);oThat.oView.byId("id_VehiNo").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(true);oThat.oView.byId("id_VehicleTy").setValue("");oThat.getView().byId("id_Param7Key").setState(true);oThat.getView().byId("id_Param7Key").setEnabled(true);if(oThat.SelectedPlant.Param==="H"&&oThat.oView.getModel("POST").getData().Wtype==="08"){oThat.oView.byId("id_VehiNo").setEditable(false);oThat.oView.byId("id_VehiNo").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(false);oThat.oView.byId("id_VehicleTy").setValue(oThat.oView.getModel("i18n").getResourceBundle().getText("recbyHand"));oThat.getView().byId("id_Param7Key").setState(!true);oThat.getView().byId("id_Param7Key").setEnabled(!true)}else if(oThat.oView.getModel("POST").getData().Wtype==="08"){oThat.getView().byId("id_ComboProcess").setSelectedKey();sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("processvalid"))}oThat.oView.byId("id_InRefNo").setVisible(false);oThat.oView.byId("id_InRefNoValue").setValue("");oThat.oView.byId("id_Vendor").setEditable(true);if(oThat.oView.getModel("POST").getData().Wtype==="09"||oThat.oView.getModel("POST").getData().Wtype==="10"){oThat.getView().byId("id_barcodescan").setEnabled(!true);oThat.oView.byId("id_scanid").setEnabled(!true);oThat.getView().byId("id_Param7Key").setState(!true);oThat.getView().byId("id_Param7Key").setEnabled(!true);oThat.oView.byId("id_VehicleTy").setValue("");oThat.oView.byId("id_Vendor").setEditable(false);if(oThat.SelectedPlant.Param==="H"){oThat.oView.byId("id_InRefNo").setVisible(true);oThat.oView.byId("id_InRefNoValue").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(false);oThat.oView.byId("id_VehicleTy").setValue(oThat.getView().byId("id_ComboProcess").getValue())}}oThat.oView.byId("id_LblWbId").setVisible(false);oThat.oView.byId("id_InWbId").setVisible(false);oThat.oView.byId("id_LblWbItem").setVisible(false);oThat.oView.byId("id_InWbItem").setVisible(false);oThat.oView.byId("id_LblDoNo").setVisible(false);oThat.oView.byId("id_InDoNo").setVisible(false);oThat.oView.byId("id_POBtn").setVisible(true);if(oThat.oView.getModel("POST").getData().Wtype==="04"){if(e.EvOrigin==="A"||e.EvOrigin==="B"||e.EvOrigin==="D"||e.EvOrigin==="F"||e.EvOrigin==="G"||e.EvOrigin==="I"){oThat.oView.byId("id_LblWbId").setVisible(true);oThat.oView.byId("id_InWbId").setVisible(true);oThat.oView.byId("id_LblWbItem").setVisible(true);oThat.oView.byId("id_InWbItem").setVisible(true);oThat.oView.byId("id_POBtn").setVisible(false)}else if(e.EvOrigin==="C"){oThat.oView.byId("id_LblDoNo").setVisible(true);oThat.oView.byId("id_InDoNo").setVisible(true)}else if(e.EvOrigin==="H"||e.EvOrigin==="L"||e.EvOrigin==="J"){oThat.oView.byId("id_LblWbId").setVisible(true);oThat.oView.byId("id_InWbId").setVisible(true);oThat.oView.byId("id_LblWbItem").setVisible(true);oThat.oView.byId("id_InWbItem").setVisible(true)}}if(oThat.SelectedPlant.OcrFlag==="X"&&oThat.SelectedPlant.Werks==="6236"){oThat.getView().byId("id_VehiNo").setEditable(false);oThat.getView().byId("vehNoCaptureID").setVisible(true)}else{oThat.getView().byId("id_VehiNo").setEditable(true);oThat.getView().byId("vehNoCaptureID").setVisible(false)}if(oThat.oView.getModel("POST").getData().Wtype==="09"||oThat.oView.getModel("POST").getData().Wtype==="10"){oThat.oView.byId("id_InRefNo").setVisible(true);oThat.oView.byId("id_InRefNoValue").setValue("")}},error:function(e){}})},onLiveChange:function(e){oThat.vId=e.getSource().getId();e.getSource().setValueState("None")},onChangeVehicle:function(e){var t=/^[0-9a-zA-Z]+$/;if(e.getSource().getValue().match(t)){}else{e.getParameter("value").replace(e.getParameter("value"),"")}e.getSource().setValueState("None");var a=oThat.getView().byId("id_VehiNo").getValue();if(a.length>15){oThat.getView().byId("id_VehiNo").setValueStateText("Maximum 15 Charecters only");oThat.getView().byId("id_VehiNo").setValueState("Error")}},onSubmitVenodr:function(e){var t=e.getSource().getValue();var a=false;if(oThat.oView.getModel("Vendor")){var o=oThat.oView.getModel("Vendor").getData().results;for(var i=0;i<o.length;i++){var r=o[i].Lifnr;r=+r;t=+t;if(t==r){a=true;oThat.oView.getModel("POST").getData().VendorName=o[i].Name1;break}}}if(a==false){oThat.oView.getModel("POST").getData().VendorName=""}oThat.oView.getModel("POST").refresh()},onVendorLiveChange:function(e){var t=e.getSource().getValue();var a=false;if(oThat.oView.getModel("Vendor")){var o=oThat.oView.getModel("Vendor").getData().results;for(var i=0;i<o.length;i++){var r=o[i].Lifnr;r=+r;t=+t;if(t==r){a=true;oThat.oView.getModel("POST").getData().VendorName=o[i].Name1;break}}}if(a==false){oThat.oView.getModel("POST").getData().VendorName=""}oThat.oView.getModel("POST").refresh();if(oThat.oView.getModel("POLIST")){if(oThat.oView.byId("id_POBtn").getText()!==oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){oThat.oView.getModel("POLIST").getData().forEach(function(e){e.Parnr=t})}}},spotPurchaseQR:function(e){for(var t=0;t<this.aData.length;t++){oThat.getView().byId("id_VendorBox").setVisible(true);oThat.getView().byId("id_Vendor").setValue(this.aData[t].VendorNumber);oThat.oView.byId("id_POBtn").setText("Material");oThat.onPressManualQROK(e)}},onScanQRValue:function(e){this.ScanBtnPress=e.getSource().getTooltip();var t=this;var a=t.getView().getModel("i18n").getResourceBundle();if(t.oView.getModel("POST").getData().Wtype===""||t.oView.getModel("POST").getData().Werks===""){r.show(a.getText("ProcessPlantMandt"));return}var i=new o;if(ZXing!==undefined&&!sap.ui.Device.system.desktop){this.loadZXingLibrary().then(()=>{d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(e=>{if(e.length>1){n=e[1].deviceId}else if(e.length===1){n=e[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.onScanBarcode(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}if(e.length>=1){var o=[];e.forEach(e=>{if(e.label.includes("0")){n=e.deviceId}var r={};r.text=e.label;r.value=e.deviceId;o.push(r);i.setData(o);this.getView().setModel(i,"oVideoDeviceModel");g=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:n,selectionChange:function(e){n=e.getSource().getSelectedKey();t._oScanQRDialog.close();d.reset()}});T=new sap.m.Button({text:a.getText("Start"),type:a.getText("Accept"),press:function(){t._oScanQRDialog.close();t.onScanQRValue()}});t.startScanning()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.onScanBarcode(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},startScanning:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){s=true}else{s=false}}catch(e){s=false}if(s===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(n,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();e.onScanBarcode(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},handleChange:function(e){var t=e.getSource(),a=t.getSelectedKey(),o=t.getValue();if(!a&&o){t.setValueState("Error");var i=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorCombo");t.setValueStateText(i);var r=t.getItems().some(function(e){return e.getText().toLowerCase()===o.toLowerCase()});if(!r){t.setValue("")}}else{t.setValueState("None")}},onScanBarcode:function(e){var a=oThat.getView().getModel("i18n").getResourceBundle();if(e.indexOf("Source")!=-1){if(oThat.oView.getModel("POST").getData().Wtype=="05"){this._oParsedData={};e.split("\n").forEach(e=>{let[t,a]=e.includes(":")?e.split(":"):e.split("-");if(t&&a){this._oParsedData[t.trim()]=a.trim()}});var o=oThat.getOwnerComponent().getModel("F4Model").getData().results[0].F4PlantNav.results.filter(e=>e.Werks===this._oParsedData["Plant"]);oThat.SelectedPlant=o[0];if(o[0].Param=="E"){var l=o[0].Werks+" - "+o[0].Name1;var s=[new i("TruckTypeGQ",sap.ui.model.FilterOperator.EQ,"X"),new i("IvWerks",sap.ui.model.FilterOperator.EQ,o[0].Werks)];oThat.BusyDialog.open();oThat.oModel.read("/F4ParametersSet",{filters:s,urlParameters:{$expand:"F4TruckTypeSetNav"},success:function(e,r){var s=e.results[0].F4TruckTypeSetNav.results;var n=oThat._oParsedData["Truck type"];var d=s.find(function(e){return e.Trucktyp===n});oThat.BusyDialog.close();var g=this.byId("id_VehiNo");var T=this.byId("id_VehicleTy");var h=this.byId("id_VehicleTyCombo");var V=this.byId("id_InDriver");var u=this.byId("id_InDriverMob");var w=this.byId("id_InTransport");var b=this.byId("id_Vendor");var M=this.byId("id_scanid");var I=this.byId("id_InPlant");var v=this.byId("id_InManual");if(d){T.setVisible(true);h.setVisible(false);g.setValue(this._oParsedData["Truck number"]||"");T.setValue(this._oParsedData["Truck type"]||"");V.setValue(this._oParsedData["Driver name"]||"");u.setValue(this._oParsedData["Driver mobile"]||"");I.setValue(l||"");v.setValue(this._oParsedData["Material code"]||"");var f=oThat.oView.getModel("POST").getData();f.Werks=o[0].Werks;f.Name1=o[0].Name1;f.DSEreference=this._oParsedData["DSE reference"];f.DSESourceLotNo=this._oParsedData["Source Lot no"];[g,T,V,u,w,b,I].forEach(function(e){e.setEditable(false)});M.setEnabled(false);oThat.Service="Vendor";var c=[new i("Werks",sap.ui.model.FilterOperator.EQ,o[0].Werks)];oThat.onCallService(oThat.Service,c);var m=0;var D=3e3;var P=200;var y=function(){var e=oThat.oView.getModel("Vendor");if(e&&e.getData().results?.length>0){var t=oThat._oParsedData["Transporter Code"];var a=e.getData().results.filter(e=>e.Lifnr===t);oThat.oView.getModel("POST").getData().Lifnr=a[0].Lifnr;oThat.oView.getModel("POST").getData().LifnrDesc=a[0].Name1;oThat.getView().byId("id_Vendor").setValue(a[0].Lifnr||"");oThat.oView.getModel("POST").getData().VendorName=a[0].Name1;oThat.oView.getModel("POST").refresh(true);console.log(" Vendor model loaded.");oThat.onPressManualQROK()}else if(m>=D){console.warn(" Vendor model not loaded in time. Proceeding anyway.");oThat.onPressManualQROK()}else{m+=P;setTimeout(y,P)}};y()}else{var S=a.getText("ErrorScan7");t.error(S);T.setVisible(true);h.setVisible(false);g.setValue("");T.setValue("");V.setValue("");u.setValue("");I.setValue("");v.setValue("");b.setValue("");oThat.getView().byId("id_Vendor").setValue("");oThat.oView.getModel("POST").getData().Lifnr="";oThat.oView.getModel("POST").getData().LifnrDesc="";oThat.oView.getModel("POST").getData().Werks="";oThat.oView.getModel("POST").getData().Name1="";oThat.oView.getModel("POST").getData().Gate="";oThat.oView.getModel("POST").getData().Wbname="";oThat.oView.getModel("POST").getData().VendorName="";oThat.oView.getModel("POST").getData().DSESourceLotNo="";oThat.oView.getModel("POST").getData().DSEreference="";oThat.oView.getModel("POST").refresh(true);oThat.oView.getModel("POLIST").setData([]);oThat.oView.getModel("POLIST").refresh(true);[g,T,V,u,w,b,I].forEach(function(e){e.setEditable(true)});M.setEnabled(true);return}oThat.BusyDialog.close()}.bind(this),error:function(e){oThat.BusyDialog.close();t.error(e.responseText)}})}else{var n=a.getText("ErrorScan2");r.show(n)}}else{var d=a.getText("ErrorScan1");r.show(d)}}else if(e.includes("ASN")){var g=e;if(oThat.oView.getModel("POST").getData().Wtype=="01"){var T=oThat.oView.getModel("POST").getProperty("/Werks");if(T){var h=[new i("IvWerks",sap.ui.model.FilterOperator.EQ,T),new i("IvASNNo",sap.ui.model.FilterOperator.EQ,g)];oThat.BusyDialog.open();oThat.oModel.read("/F4ParametersSet",{filters:h,urlParameters:{$expand:"AsnHeadSetNav,AsnItemSetNav"},success:function(e,a){var o=e.results[0];oThat.oAsnHeaderData=o.AsnHeadSetNav.results;oThat.oAsnItemData=o.AsnItemSetNav.results;if(oThat.oAsnHeaderData[0].Asnnumber){if(oThat.oAsnHeaderData[0].AsnExist!=="X"){if(oThat.oAsnHeaderData[0].Asnnumber&&(oThat.multiAsnHeader==""||oThat.multiAsnHeader==undefined)){oThat.multiAsnHeader=oThat.oAsnHeaderData[0];oThat.oMultiPlant=T;oThat.oView.byId("id_VehicleTy").setVisible(true);oThat.oView.byId("id_VehicleTyCombo").setVisible(false);oThat.Asnnumber=oThat.oAsnHeaderData[0].Asnnumber;oThat.oScannedAsnNubers.push(oThat.Asnnumber);oThat.oView.byId("id_VehiNo").setValue(oThat.oAsnHeaderData[0].VehicleNo||"");oThat.oView.byId("id_VehicleTy").setValue(oThat.oAsnHeaderData[0].VehicleType||"");oThat.oView.byId("id_InDriver").setValue(oThat.oAsnHeaderData[0].DriverName||"");oThat.oView.byId("id_InDriverMob").setValue(oThat.oAsnHeaderData[0].MobileNo||"");oThat.oView.byId("id_InTransport").setValue(oThat.oAsnHeaderData[0].VendorName||"");oThat.oView.byId("id_VehiNo").setEditable(false);oThat.oView.byId("id_VehicleTy").setEditable(false);oThat.oView.byId("id_InDriver").setEditable(false);oThat.oView.byId("id_InDriverMob").setEditable(false);oThat.oView.byId("id_InTransport").setEditable(false);oThat.oView.byId("id_scanid").setEnabled(false);oThat.oView.getModel("POST").getData().Lifnr=oThat.oAsnHeaderData[0].VendorName.match(/\d+/)[0];oThat.oView.getModel("POST").getData().LifnrDesc=oThat.oAsnHeaderData[0].VendorName.split("-")[1].trim();oThat.oView.getModel("POST").refresh(true)}else if(oThat.multiAsnHeader&&oThat.multiAsnHeader.VehicleNo===oThat.oAsnHeaderData[0].VehicleNo&&oThat.multiAsnHeader.VehicleType===oThat.oAsnHeaderData[0].VehicleType&&oThat.oMultiPlant===T&&oThat.multiAsnHeader.DriverName===oThat.oAsnHeaderData[0].DriverName&&oThat.multiAsnHeader.MobileNo===oThat.oAsnHeaderData[0].MobileNo&&oThat.multiAsnHeader.VendorName===oThat.oAsnHeaderData[0].VendorName){oThat.Asnnumber=oThat.oAsnHeaderData[0].Asnnumber;if(oThat.oScannedAsnNubers.includes(oThat.Asnnumber)){var i=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorScan6");r.show(i);oThat.BusyDialog.close();return}else{}}else{oThat.oAsnItemData.length=0;var l=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorScan5");r.show(l);oThat.BusyDialog.close();return}if(oThat.oAsnItemData.length>0){const e=oThat.oAsnItemData.filter((e,t,a)=>t===a.findIndex(t=>t.Ponumber===e.Ponumber));e.forEach(function(e){var t=e.Ponumber;oThat.oView.byId("id_InManual").setValue(t);oThat.onPressManualQROK()})}oThat.BusyDialog.close()}else{oThat.BusyDialog.close();t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorScan4",[oThat.oAsnHeaderData[0].Asnnumber]))}}else{oThat.BusyDialog.close();var s=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorScan3");r.show(s)}}.bind(this),error:function(e){oThat.BusyDialog.close()}})}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("Plant_Mandatory"))}}else{var d=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorScan1");r.show(d)}}else{if(this.ScanBtnPress===a.getText("RefNo")){this.setScanRefernceNo(e)}else if(this.ScanBtnPress===a.getText("Scanner")){var V=true,u;if(oThat.oView.getModel("POLIST").getData()){var w=oThat.oView.getModel("POLIST").getData();for(var b in w){if(w[b].Ebeln===e){V=false;u=oThat.oView.getModel("i18n").getResourceBundle().getText("ItemExist");break}}}if(oThat.oView.getModel("POST").getData().Wtype!==""&&oThat.oView.getModel("POST").getData().Werks!==""){if(oThat.SelectedPlant.Param==="H"&&oThat.oView.getModel("POST").getData().Gate.trim().length===0){V=false;u=oThat.oView.getModel("i18n").getResourceBundle().getText("errorGate")}}if(V){if(plantFlag==="X"){scanPlantFlag="X";this.scanArry={results:[]};var M=e;var I=M.split("$")[0];var v=M.split("$")[1];this.ahead=I.split("#");var f=v.split("&");this.aData=[];if(this.ahead[0]==="3A"){for(var c=0;c<f.length;c++){var m=f[c].split("#");var D={CMSNumber:m[0],NotaFiscalNo:m[1],NotaFiscalQty:m[2]};this.aData.push(D)}}else{for(var c=0;c<f.length;c++){var m=f[c].split("#");var D={DeliveryNo:m[0],VendorNumber:m[1],NotaFiscalNo:m[2],NotaFiscalQty:m[3]};this.aData.push(D)}}if(this.ahead[0]==="3A"){this.ahead[0]=oThat.getView().getModel("F4Model").getData().results[0].F4ProcessNav.results[0].Name1;oThat.getView().byId("id_ComboProcess").setValue(this.ahead[0]);oThat.getView().byId("id_VehiNo").setValue(this.ahead[2]);oThat.getView().byId("id_VehicleTy").setValue(this.ahead[3]);oThat.getView().byId("id_InDriver").setValue(this.ahead[4]);oThat.getView().byId("id_InDriverMob").setValue(this.ahead[5]);oThat.getView().byId("id_driverno").setValue(this.ahead[6]);for(var P=0;P<this.aData.length;P++){oThat.getView().byId("id_InManual").setValue(this.aData[P].CMSNumber);oThat.onPressManualQROK()}}else{this.ahead[0]=oThat.getView().getModel("F4Model").getData().results[0].F4ProcessNav.results[4].Name1;oThat.getView().byId("id_ComboProcess").setValue(this.ahead[0]);oThat.getView().byId("id_VehiNo").setValue(this.ahead[2]);oThat.getView().byId("id_VehicleTy").setValue(this.ahead[3]);oThat.getView().byId("id_InDriver").setValue(this.ahead[4]);oThat.getView().byId("id_InDriverMob").setValue(this.ahead[5]);oThat.getView().byId("id_driverno").setValue(this.ahead[6]);for(var P=0;P<this.aData.length;P++){oThat.getView().byId("id_InManual").setValue(this.aData[P].DeliveryNo);oThat.spotPurchaseQR()}}}if(e){if(oThat.oView.getModel("POST").getData().Wtype!==""&&oThat.oView.getModel("POST").getData().Werks!==""){var y="";var S=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(S.length!=0){y=S[0].Process}if(y=="TRIP"){var p=e;if(p!==""){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"){var N=p.split("#",2);var O=N[0];var _=N[1];oThat.onQRValidate(O,_)}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="C"){var W=p;oThat.onQRValidate(W,"")}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="F"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="G"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="I"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="M"){var N=p.split("#",2);var O=N[0];var _=N[1];oThat.onQRValidate(O,_)}}}else{if(y=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){var N=e.split("#",2);var O=N[0];var _="";oThat.onQRValidateTransfer(O,_)}else{var p=e;var R=p.slice(0,10);if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="K"&&y=="STO"){var R=p.split("#")[0]}else{var R=p}if(p!==""){oThat.onQRValidate(R,"")}}}}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg17"))}}}else{r.show(u)}}}},fnBarcodeFailed:function(){sap.m.MessageBox.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg2"))},onCaptureCamera:function(){var e=this;e.oView.setModel(new o(e.Images),"MASS");e.oView.getModel("MASS").refresh(true);if(!e.oCapture){e.oCapture=sap.ui.xmlfragment(e.getView().getId(),"ZGT_MM_INBOUND.Fragments.CaptureImage",e);e.oView.addDependent(e.oCapture)}e.oCapture.open()},fnAddBillClose:function(){oThat.Images=[];oThat.oCapture.close()},onBeforeUploadStarts:function(){oThat.BusyDialog.open()},onFilePreview:function(e){var t=oThat.getView().getModel("i18n").getResourceBundle();var a=new sap.m.BusyDialog;a.open();var o=e.getSource();var i=o;while(i){if(i.getMetadata&&i.getMetadata().getName()==="sap.m.Dialog"){break}i=i.getParent&&i.getParent()}if(!i){sap.m.MessageToast.show("Dialog container not found");return}var r=i;var l=r.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewContainer")!==-1})[0];var s=r.findAggregatedObjects(true,function(e){return e.getId().indexOf("imagePreview")!==-1})[0];var n=r.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewTitle")!==-1})[0];if(!l||!s||!n){sap.m.MessageToast.show("Preview controls not found");return}var d=o.getBindingContext("MASS");var g=d?d.getObject():null;if(!g){sap.m.MessageToast.show("File data not found");return}var T=g.documentUrl||g.url||"";var h=g.Fname||"";var V=h.split(".").pop().toLowerCase();if(!T){sap.m.MessageToast.show("Document preview not available");return}if(["jpg","jpeg","png","gif","bmp","svg"].includes(V)){s.attachEventOnce("load",function(){a.close()});s.attachEventOnce("error",function(){a.close();sap.m.MessageToast.show("Failed to load image preview")});s.setSrc(T);n.setText("Preview: "+h);l.setVisible(true)}else{a.close();var u=document.createElement("a");u.href=T;u.download=h;document.body.appendChild(u);u.click();document.body.removeChild(u)}},onClosePreview:function(e){var t=e.getSource();var a=t;while(a){if(a.getMetadata&&a.getMetadata().getName()==="sap.m.Dialog"){break}a=a.getParent&&a.getParent()}if(!a){return}var o=a;var i=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewContainer")!==-1})[0];var r=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("imagePreview")!==-1})[0];var l=o.findAggregatedObjects(true,function(e){return e.getId().indexOf("previewTitle")!==-1})[0];if(i)i.setVisible(false);if(r)r.setSrc("");if(l)l.setText("")},_compressImage:function(e,t=.9,a=1280,o=720){return new Promise((i,r)=>{if(!e||!e.type.startsWith("image/")){i(e);return}const l=new FileReader;l.onload=function(l){const s=new Image;s.onload=function(){const r=document.createElement("canvas");let l=s.width;let n=s.height;if(l>n){if(l>a){n=Math.round(n*(a/l));l=a}}else{if(n>o){l=Math.round(l*(o/n));n=o}}r.width=l;r.height=n;const d=r.getContext("2d");d.drawImage(s,0,0,l,n);r.toBlob(t=>{const a=new File([t],e.name,{type:e.type});i(a)},e.type,t)};s.onerror=r;s.src=l.target.result};l.onerror=r;l.readAsDataURL(e)})},onCompleteUpload:function(e){var t=this;t.onClosePreview(e);var a=this.getView().byId("id_RadioBtn").getSelectedButton().getId().split("--").pop();var o=this.getView().byId("id_RadioBtn").getSelectedButton().getText();if(t.Images.length!==0){for(var i=0;i<t.Images.length;i++){if(t.Images[i].Doknr===a){t.Images.splice(i,1);break}}}var r=e.getSource()._getFileUploader()._aXhr[0]?.file;if(!r){sap.m.MessageToast.show("No file found for upload.");return}var l={};l.Documentid=jQuery.now().toString();var s="";if(r&&r.name){var n=r.name.lastIndexOf(".");if(n!==-1){s=r.name.substring(n)}}l.Fname=o.trim()+(s?s.toLowerCase():"");l.Ftype=r.type;l.Objky="";l.Doknr=a;e.getSource()._getFileUploader()._aXhr.splice(0,1);sap.m.MessageToast.show("Processing "+r.name+" ...",{duration:1e3});setTimeout(function(){console.time("FileCompress+Read");t._compressImage(r,.9,1280,720).then(function(e){console.log("Compression successful:","Original:",(r.size/1024).toFixed(1)+" KB"," Compressed:",(e.size/1024).toFixed(1)+" KB");var a=new FileReader;var o="data:"+e.type+";base64,";a.onloadstart=function(){sap.m.MessageToast.show("Encoding "+r.name+" ...",{duration:800})};a.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);console.log("Encoding progress:",t+"%")}};a.onloadend=function(a){console.timeEnd("FileCompress+Read");var i=a.target.result.indexOf(o)+o.length;var r=a.target.result.substring(i);l.Filename=r;if(e.size<1024*1024){l.documentUrl=URL.createObjectURL(e)}t.Images.unshift(l);var s=t.getView().getModel("MASS");if(!s){s=new sap.ui.model.json.JSONModel(t.Images);t.getView().setModel(s,"MASS")}else{s.refresh(true)}t.BusyDialog.close();sap.m.MessageToast.show("File processed successfully",{duration:1200})};a.readAsDataURL(e)}).catch(function(e){console.error("Compression failed, using original:",e);var a=new FileReader;var o="data:"+r.type+";base64,";a.onloadend=function(e){var a=e.target.result.indexOf(o)+o.length;var i=e.target.result.substring(a);l.Filename=i;l.documentUrl=URL.createObjectURL(r);t.Images.unshift(l);t.getView().setModel(new sap.ui.model.json.JSONModel(t.Images),"MASS");t.getView().getModel("MASS").refresh(true);t.BusyDialog.close();sap.m.MessageToast.show("File added without compression",{duration:1200})};a.readAsDataURL(r)})},0)},onFileDeleted:function(e){var t=e.getParameter("documentId");for(var a=0;a<oThat.Images.length;a++){if(oThat.Images[a].Documentid==t){oThat.Images.splice(oThat.Images[a],1);break}}oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true);var i=oThat.byId("imagePreview");var r=oThat.byId("previewContainer");if(i&&i.getSrc()){var l=i.getSrc();var s=l&&l.includes(t);if(s&&r){i.setSrc("");r.setVisible(false)}}},fnOKImages:function(e){var t=oThat.getView().getModel("MASS").getData();var a=oThat.SelectedPlant.ImgFlag;var o=0,i=0;if(a.length>0){for(var r in a){if(a[r]==="1"){var o=true,l=0;for(var s in t){var n=t[s].Fname;var d=n.substring(0,n.lastIndexOf("."));if(d==="Driver"){l++;break}}}else if(a[r]==="2"){var i=true,g=0;for(var s in t){var n=t[s].Fname;var d=n.substring(0,n.lastIndexOf("."));if(d==="Vehicle Name Plate"){g++;break}}}else if(a[r]==="3"){var T=true,h=0;for(var s in t){var n=t[s].Fname;var d=n.substring(0,n.lastIndexOf("."));
// if (attachmentdoc[y].Fname === "License") {
if(d==="License"){h++;break}}}else if(a[r]==="4"){var V=true,u=0;for(var s in t){var n=t[s].Fname;var d=n.substring(0,n.lastIndexOf("."));if(d==="Truck Image"){u++;break}}}else if(a[r]==="5"){var w=true,b=0;for(var s in t){var n=t[s].Fname;var d=n.substring(0,n.lastIndexOf("."));if(d==="WayBill Slip"){b++;break}}}}var M="";if(o&&l<=0){M+=oThat.oView.getModel("i18n").getResourceBundle().getText("errorDriver")}if(i&&g<=0){M+=oThat.oView.getModel("i18n").getResourceBundle().getText("errorVehiclenameplate")}if(T&&h<=0){
//	text += "please attach doc for License ";
M+=oThat.oView.getModel("i18n").getResourceBundle().getText("errorLicense")}if(V&&u<=0){M+=oThat.oView.getModel("i18n").getResourceBundle().getText("errorTruckImg")}if(w&&b<=0){M+=oThat.oView.getModel("i18n").getResourceBundle().getText("errorWayBillSlipImg")}if(M.trim().length>0){var I=M.split(".").join(".\n");sap.m.MessageBox.error(I);oThat.Images=[]}else{oThat.oCapture.close()}}else{oThat.oCapture.close()}},onChangeProcess:function(e){var t=e.getSource().getId();e.getSource().setValueState("None");var a=e.getSource().getSelectedKey();var o=e.getSource()._getSelectedItemText();oThat.oView.byId("id_VehiNo").setEditable(true);oThat.oView.byId("id_VehiNo").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(true);oThat.oView.byId("id_VehicleTy").setValue("");oThat.getView().byId("id_Param7Key").setState(true);oThat.getView().byId("id_Param7Key").setEnabled(true);if(oThat.oView.getModel("POST").getData().Werks!==""&&a==="08"){if(oThat.SelectedPlant.Param==="H"){oThat.oView.byId("id_VehiNo").setEditable(false);oThat.oView.byId("id_VehiNo").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(false);oThat.oView.byId("id_VehicleTy").setValue(oThat.oView.getModel("i18n").getResourceBundle().getText("recbyHand"));oThat.getView().byId("id_Param7Key").setState(!true);oThat.getView().byId("id_Param7Key").setEnabled(!true)}else{sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("processvalid"));e.getSource().setSelectedKey();var a="";var o=""}}oThat.oView.byId("id_InRefNo").setVisible(false);oThat.oView.byId("id_InRefNoValue").setValue("");oThat.oView.byId("id_Vendor").setEditable(true);if(oThat.oView.getModel("POST").getData().Werks!==""&&(a==="09"||a==="10")){oThat.getView().byId("id_barcodescan").setEnabled(!true);oThat.oView.byId("id_scanid").setEnabled(!true);oThat.getView().byId("id_Param7Key").setState(!true);oThat.getView().byId("id_Param7Key").setEnabled(!true);oThat.oView.byId("id_VehicleTy").setValue("");oThat.oView.byId("id_Vendor").setEditable(false);if(oThat.SelectedPlant.Param==="H"){oThat.oView.byId("id_InRefNo").setVisible(true);oThat.oView.byId("id_InRefNoValue").setValue("");oThat.oView.byId("id_VehicleTy").setEditable(false);oThat.oView.byId("id_VehicleTy").setValue(o)}}if(a==="09"||a==="10"){oThat.oView.byId("id_InRefNo").setVisible(true);oThat.oView.byId("id_InRefNoValue").setValue("")}if(t.indexOf("id_ComboProcess")!=-1){oThat.oView.byId("id_LblWbId").setVisible(false);oThat.oView.byId("id_InWbId").setVisible(false);oThat.oView.byId("id_LblWbItem").setVisible(false);oThat.oView.byId("id_InWbItem").setVisible(false);oThat.oView.byId("id_LblDoNo").setVisible(false);oThat.oView.byId("id_InDoNo").setVisible(false);oThat.oView.byId("id_POBtn").setVisible(true);oThat.oView.getModel("POST").getData().Wtype=a;var i=e.getSource().getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.Name1==o});if(i.length!=0){oThat.oView.byId("id_POBtn").setVisible(true);if(i[0].Po=="X"){oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text3"));oThat.oView.byId("id_VendorBox").setVisible(false);oThat.oView.byId("id_InManual").setMaxLength(10);oThat.oView.byId("id_InManual").setShowValueHelp(false);oThat.oView.byId("id_InManual").setValue("");if(!oThat.oPersonalModel.getData().ColumnsItems[0].visible){oThat.oView.byId("id_InManual").setEnabled(true)}if(i[0].Process=="TRIP"){if(oThat.oView.getModel("oDisplayModel")){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="F"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="G"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="I"){oThat.oView.byId("id_LblWbId").setVisible(true);oThat.oView.byId("id_InWbId").setVisible(true);oThat.oView.byId("id_LblWbItem").setVisible(true);oThat.oView.byId("id_InWbItem").setVisible(true);oThat.oView.byId("id_POBtn").setVisible(false);oThat.oView.byId("id_InManual").setMaxLength(12)}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="C"){oThat.oView.byId("id_LblDoNo").setVisible(true);oThat.oView.byId("id_InDoNo").setVisible(true);oThat.oView.byId("id_POBtn").setVisible(false)}}}}else if(i[0].Po=="M"){oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text21"));oThat.oView.byId("id_VendorBox").setVisible(true);if(!oThat.oPersonalModel.getData().ColumnsItems[0].visible){oThat.oView.byId("id_InManual").setEnabled(true)}oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_InManual").setMaxLength(18);oThat.oView.byId("id_InManual").setShowValueHelp(true)}else{oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text4"));oThat.oView.byId("id_VendorBox").setVisible(false);if(!oThat.oPersonalModel.getData().ColumnsItems[0].visible){oThat.oView.byId("id_InManual").setEnabled(true)}oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_InManual").setMaxLength(10);oThat.oView.byId("id_InManual").setShowValueHelp(false)}if(oThat.oView.getModel("oDisplayModel")){if(i[0].SeqNo==="07"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){oThat.getView().byId("id_RefTb").setVisible(true);oThat.getView().byId("id_Rbref").setVisible(true)}else if(i[0].SeqNo!=="07"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){oThat.getView().byId("id_RefTb").setVisible(false);oThat.getView().byId("id_Rbref").setVisible(false)}}}}else if(t.indexOf("id_VehicleTy")!=-1){oThat.oView.getModel("POST").getData().Vehtyp=a}oThat.oView.getModel("POST").refresh(true)},fnRefChange:function(e){var t=oThat.oView.getModel("POLIST").getData();if(t.length>0){var a=e.getSource().getSelectedIndex();var o=oThat.oView.getModel("i18n").getResourceBundle().getText("ListExitsedData");sap.m.MessageBox.show(o,{icon:sap.m.MessageBox.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Warning"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e==sap.m.MessageBox.Action.YES){oThat.oView.getModel("POLIST").setData([]);oThat.oView.byId("id_InManualCFM").setTokens([]);if(a==0){oThat.oView.byId("id_InRemarksLabel").setVisible(false);oThat.oView.byId("id_InRemarks").setVisible(false);oThat.oView.byId("id_InMatDocLabel").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_VendorBox").setVisible(true)}else{oThat.oView.byId("id_InRemarksLabel").setVisible(true);oThat.oView.byId("id_InRemarks").setVisible(true);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_Vendor").setValue("");oThat.getView().getModel("POST").getData().VendorName="";oThat.getView().getModel("POST").refresh(true);oThat.oView.byId("id_VendorBox").setVisible(false)}}else{if(a==0){oThat.oView.byId("id_Rbref").setSelectedIndex(1)}else{oThat.oView.byId("id_Rbref").setSelectedIndex(0)}if(oThat.oView.byId("id_Rbref").getSelectedIndex()==0){oThat.oView.byId("id_InRemarksLabel").setVisible(false);oThat.oView.byId("id_InRemarks").setVisible(false);oThat.oView.byId("id_InMatDocLabel").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_VendorBox").setVisible(true)}else{oThat.oView.byId("id_InRemarksLabel").setVisible(true);oThat.oView.byId("id_InRemarks").setVisible(true);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_Vendor").setValue("");oThat.getView().getModel("POST").getData().VendorName="";oThat.getView().getModel("POST").refresh(true);oThat.oView.byId("id_VendorBox").setVisible(false)}sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ActCanc"))}}})}else{if(e.getSource().getSelectedIndex()===0){oThat.oView.byId("id_InRemarksLabel").setVisible(false);oThat.oView.byId("id_InRemarks").setVisible(false);oThat.oView.byId("id_InMatDocLabel").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_VendorBox").setVisible(true)}else{oThat.oView.byId("id_InRemarksLabel").setVisible(true);oThat.oView.byId("id_InRemarks").setVisible(true);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_InMatDoc").setVisible(false);oThat.oView.byId("id_Vendor").setValue("");oThat.getView().getModel("POST").getData().VendorName="";oThat.getView().getModel("POST").refresh(true);oThat.oView.byId("id_VendorBox").setVisible(false)}}},onWBChange:function(e){if(oThat.oView.getModel("POST").getData().Wtype=="07"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){var t=oThat.oView.getModel("POLIST").getData();if(t.length>0){var a=e.getSource().getState();var o=oThat.oView.getModel("i18n").getResourceBundle().getText("ListExitsedData");sap.m.MessageBox.show(o,{icon:sap.m.MessageBox.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Warning"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e==sap.m.MessageBox.Action.YES){oThat.oView.getModel("POLIST").setData([]);oThat.oView.byId("id_InManualCFM").setTokens([]);if(a==true){oThat.getView().byId("id_Rbref").setVisible(false);oThat.getView().byId("id_RefTb").setVisible(false)}else{oThat.getView().byId("id_Rbref").setVisible(true);oThat.getView().byId("id_RefTb").setVisible(true)}}else{oThat.getView().byId("id_Param7Key").setState(!a);sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ActCanc"))}}})}else{if(e.getSource().getState()==true){oThat.getView().byId("id_Rbref").setVisible(false);oThat.getView().byId("id_RefTb").setVisible(false)}else{oThat.getView().byId("id_Rbref").setVisible(true);oThat.getView().byId("id_RefTb").setVisible(true)}}}},onSwitchChange:function(e){var t=true;if(oThat.oView.getModel("POST").getData().Wtype!==""&&oThat.oView.getModel("POST").getData().Werks!==""){if(oThat.SelectedPlant.Param==="H"&&oThat.oView.getModel("POST").getData().Gate.trim().length===0){t=false;e.getSource().setState(true);r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("errorGate"))}}if(t){if(oThat.oView.getModel("POST").getData().Wtype!==""&&oThat.oView.getModel("POST").getData().Werks!==""){if(e.getSource().getState()==true){oThat.oView.getModel("VISI").getData().Manual=false;oThat.oView.getModel("VISI").getData().QRCode=true;oThat.oView.byId("id_WbIdItem").setVisible(false);if(oThat.oView.getModel("POST").getData().Wtype=="02"&&plantFlag==="X"){var a=oThat.getView().getModel("POST");a.setProperty("/Vehno",oThat.oView.getModel("SwitchoffModel").getData().Vehno);a.setProperty("/Vehtyp",oThat.oView.getModel("SwitchoffModel").getData().Vehtyp);a.setProperty("/Dname",oThat.oView.getModel("SwitchoffModel").getData().Dname);a.setProperty("/DriverMob",oThat.oView.getModel("SwitchoffModel").getData().DriverMob);a.setProperty("/Lifnr",oThat.oView.getModel("SwitchoffModel").getData().Lifnr);a.setProperty("/LifnrDesc",oThat.oView.getModel("SwitchoffModel").getData().LifnrDesc)}}else{if(oThat.oView.getModel("POST").getData().Wtype=="02"&&plantFlag==="X"){var o={Vehno:oThat.oView.getModel("POST").getData().Vehno,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp,Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,LifnrDesc:oThat.oView.getModel("POST").getData().LifnrDesc};var a=new sap.ui.model.json.JSONModel(o);this.getView().setModel(a,"SwitchoffModel")}if(oThat.oView.getModel("POST").getData().Wtype=="04"){if(oThat.oView.getModel("oDisplayModel")){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="F"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="G"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="I"){oThat.oView.byId("id_WbIdItem").setVisible(true);oThat.oView.byId("id_InManual").setMaxLength(12)}else{oThat.oView.byId("id_WbIdItem").setVisible(false)}}}else if(oThat.oView.getModel("POST").getData().Wtype=="07"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){if(oThat.oView.getModel("POLIST").getData().length>0){oThat.oView.byId("id_InManual").setVisible(false);oThat.oView.byId("id_InManualCFM").setVisible(true)}}else{oThat.oView.byId("id_WbIdItem").setVisible(false);if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){oThat.oView.byId("id_InManual").setMaxLength(18)}else{oThat.oView.byId("id_InManual").setMaxLength(10);oThat.oView.byId("id_InManual").setValue(oThat.oPoNumber)}}oThat.oView.getModel("VISI").getData().Manual=true;oThat.oView.getModel("VISI").getData().QRCode=false}oThat.oView.getModel("VISI").refresh(true)}else{r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg17"))}}},onSwitchChange1:function(e){if(e.getSource().getState()==true){oThat.vWb="WB"}else{oThat.vWb="WS"}},onPressSave:function(e){var a=oThat.oView.getModel("POST").getData();var o="";var i="";var r="";var l=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(l.length!=0){o=l[0].Process}try{var s=false;if(a.Werks==""||a.Werks==undefined){s=true;var n="MN";oThat.oView.byId("id_InPlant").setValueState("Error")}if(a.Gate==""||a.Gate==undefined){s=true;var n="MN";oThat.oView.byId("id_InGate").setValueState("Error")}if(oThat.SelectedPlant.Param!=="H"){if(a.Vehno==""||a.Vehno==undefined){s=true;var n="MN";oThat.oView.byId("id_VehiNo").setValueState("Error")}}if(a.Dname==""||a.Dname==undefined){s=true;var n="MN";oThat.oView.byId("id_InDriver").setValueState("Error")}if(a.DriverMob==""||a.DriverMob==undefined){s=true;var n="MN";oThat.oView.byId("id_InDriverMob").setValueState("Error")}if(a.Vehtyp==""||a.Vehtyp==undefined){s=true;var n="MN";oThat.oView.byId("id_VehicleTy").setValueState("Error");oThat.oView.byId("id_VehicleTyCombo").setValueState("Error")}if(l[0].SeqNo=="09"||l[0].SeqNo=="10"){if(a.Config16.trim()===""||a.Config16==undefined){s=true;var n="MN";oThat.oView.byId("id_InRefNoValue").setValueState("Error")}else{oThat.oView.byId("id_InRefNoValue").setValueState("None")}}if(o!="TRIP"){if(oThat.EvVehGateEntry=="X"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="L"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="J"){}else if(l[0].SeqNo=="09"||l[0].SeqNo=="10"){}else{if(oThat.oView.getModel("POLIST").getData().length===0){var n="PO";throw n}}}}if(o=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"){if(oThat.oView.getModel("POST").getData().IvWbid==""||oThat.oView.getModel("POST").getData().IvWbid==undefined||oThat.oView.getModel("POST").getData().IvItem==""||oThat.oView.getModel("POST").getData().IvItem==undefined){var n="WB";throw n}}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="C"&&oThat.oView.getModel("POST").getData().DONo===""){var n="DO";throw n}}if(o=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){if(oThat.oView.getModel("POLIST").getData().length==0){s=true;var n="NI";throw n}if(oThat.oView.getModel("POLIST").getData().length>0){if(oThat.oView.getModel("POLIST").getData()[0].Matnr!==""&&oThat.oView.getModel("POLIST").getData()[0].Pmblnr==""){if(a.Lifnr==""||a.Lifnr==undefined){s=true;var n="MN";oThat.oView.byId("id_InTransport").setValueState("Error")}if(a.VendorName==""||a.VendorName==undefined){s=true;var n="SV";oThat.oView.byId("id_Vendor").setValueState("Error");throw n}}if(oThat.oView.byId("id_InRemarks").getVisible()){if(oThat.oView.getModel("POLIST").getData()[0].Remarks==""){s=true;var n="MN";oThat.oView.byId("id_InRemarks").setValueState("Error")}}}}if(s==true){var n="MN";throw n}else{var d="";var g="";if(oThat.vWb=="WB"){d=oThat.oView.getModel("POST").getData().Gate}else{g=oThat.oView.getModel("POST").getData().Gate}var T="";if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){T="X"}else{T=""}if(o=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){var h={Werks:oThat.oView.getModel("POST").getData().Werks,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,Gate:d,Wsgate:g,Vehno:oThat.oView.getModel("POST").getData().Vehno,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp,Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,DriverId:oThat.oView.getModel("POST").getData().DriverNo,Wtype:o,Wbid:"",Erdat:oThat.oView.getModel("POST").getData().Erdat,Ertim:oThat.oView.getModel("POST").getData().Ertim,Direction:"IN",Challan:oThat.oView.getModel("POST").getData().Challan,Token:oThat.oView.getModel("POST").getData().Token,RefWbid:oThat.oView.getModel("POST").getData().Wbid,Config16:oThat.oView.getModel("POST").getData().Config16||""}}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="L"){var h={Werks:oThat.oView.getModel("POST").getData().Werks,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,Gate:d,Wsgate:g,Vehno:oThat.oView.getModel("POST").getData().Vehno,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp,Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,DriverId:oThat.oView.getModel("POST").getData().DriverNo,Wtype:o,Wbid:"",Erdat:oThat.oView.getModel("POST").getData().Erdat,Ertim:oThat.oView.getModel("POST").getData().Ertim,Direction:"IN",Challan:oThat.oView.getModel("POST").getData().Challan,Token:oThat.oView.getModel("POST").getData().Token,RefWbid:oThat.oView.getModel("POST").getData().Wbid,Config16:oThat.oView.getModel("POST").getData().Config16||""}}else{var h={Werks:oThat.oView.getModel("POST").getData().Werks,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,Gate:d,Wsgate:g,Vehno:oThat.oView.getModel("POST").getData().Vehno,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp,Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,DriverId:oThat.oView.getModel("POST").getData().DriverNo,Wtype:o,Wbid:oThat.oView.getModel("POST").getData().Wbid,Erdat:oThat.oView.getModel("POST").getData().Erdat,Ertim:oThat.oView.getModel("POST").getData().Ertim,Direction:"IN",Challan:oThat.oView.getModel("POST").getData().Challan,Token:oThat.oView.getModel("POST").getData().Token,RefWbid:"",Config16:oThat.oView.getModel("POST").getData().Config16||""}}var V="";if(oThat.oView.byId("id_Param7").getVisible()===true){if(oThat.oView.byId("id_Param7Key").getState()==false){V="X"}}if(o=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"){i=oThat.oView.getModel("POST").getData().IvWbid;r=oThat.oView.getModel("POST").getData().IvItem}}var u={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvWboj:oThat.vWb,IvMatnr:T,IvWithoutwb:V,IvWbid:i,TruckReport:"X",Process:oThat.getView().byId("id_ComboProcess").getSelectedItem().getText(),ParkingYard:oThat.getView().byId("id_ParkingYard").getSelectedItem()?.getText()||"",PostReturnNav:[],PostWbHeaderNav:[],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};u.d.PostWbHeaderNav.push(h);if(oThat.Asnnumber){if(oThat.Images.length!=0){oThat.Images.forEach(function(e){u.d.PostDmsNav.push({Dokar:"",Doknr:e.Doknr,Dokvr:"",Doktl:"",Dokob:"",Object:"",Objky:"",Fname:e.Fname,Ftype:e.Ftype,Filename:e.Filename})})}}var w=false;if(oThat.oView.getModel("POLIST").getData().length!=0){if(o=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"){u.d.PostWbitemNav=oThat.oView.getModel("POLIST").getData()}if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="C"){u.d.PostWbitemNav=oThat.oView.getModel("POLIST").getData()}if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="L"){u.d.PostWbitemNav.push({Ebeln:oThat.oView.getModel("POLIST").getData()[0].Ebeln,Ebelp:oThat.oView.getModel("POLIST").getData()[0].Ebelp,Matnr:oThat.oView.getModel("POLIST").getData()[0].Matnr,Item:oThat.oView.getModel("POLIST").getData()[0].Item,Brgew:"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatno1:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00",Vbeln:oThat.oView.getModel("POLIST").getData()[0].Vbeln,Posnr:oThat.oView.getModel("POLIST").getData()[0].posnr,Zeile:"0000"})}}else if(o=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"){for(var b=0;b<oThat.oView.getModel("POLIST").getData().length;b++){oThat.oView.getModel("POLIST").getData()[b].Trwgt="0";oThat.oView.getModel("POLIST").getData()[b].Brgew="0";oThat.oView.getModel("POLIST").getData()[b].Ntgew="0.000";oThat.oView.getModel("POLIST").getData()[b].Uom="";oThat.oView.getModel("POLIST").getData()[b].Lgort="";oThat.oView.getModel("POLIST").getData()[b].Config4="";oThat.oView.getModel("POLIST").getData()[b].Config1=""}u.d.PostWbitemNav=oThat.oView.getModel("POLIST").getData()}else{if(u.d.PostWbHeaderNav[0].Token==""&&oThat.oView.getModel("POST").getData().Challan==""){oThat.oView.getModel("POLIST").getData().forEach(function(e){var a="00000";var o="000000";var i="";var r="";var l="";var s="";if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){a="00000";o=e.Posnr;r=e.Vbeln;l=e.Werks;s=e.Charg}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){a="00000";o="000000";if(oThat.oView.getModel("POST").getData().Wtype=="05"){if(oThat.oView.byId("id_Vendor").getValue()!==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg15"));w=true;return}}l=e.Parnr}else{o="000000";a=e.Ebelp;i=e.Ebeln;l=e.Parnr}if(oThat.oView.getModel("oViewModel").getData().NotaProperty!==true){if(oThat.vWb=="WB"){u.d.PostWbitemNav.push({Ebeln:i,Ebelp:a,Matnr:e.Matnr,Item:e.Item,Parnr:l,Batch:s,Brgew:"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatno1:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00",Vbeln:r,Posnr:o,Zeile:"0000",Config6:e.AsnNumber,Config5:oThat.oView.getModel("POST").getData().DSEreference||"",Config7:oThat.oView.getModel("POST").getData().DSESourceLotNo||""})}else{u.d.PostWsItemNav.push({Vbeln:r,Matnr:e.Matnr,Posnr:o,Item:e.Item,Parnr:l,Ebelp:a,Ebeln:i,Batch:s,Pmatno1:"0",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Bgtrwt:"0.000",Brgew:"0.000",Ntgew:"0.000",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Erdat:null,Ertim:"PT00H00M00S",Aedat:null,Aetim:"PT00H00M00S",Config8:"0.00",Config2:"0.00",Zeile:"0000"})}}else{if(oThat.vWb=="WB"){u.d.PostWbitemNav.push({Ebeln:i,Ebelp:a,Matnr:e.Matnr,Item:e.Item,Parnr:e.Vendor,Batch:s,NF_NUMBER:e.NF_NUMBER,NF_QUANTITY:e.NF_QUANTITY,Pmblnr:e.Charg,Brgew:"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatno1:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00",Vbeln:r,Posnr:o,Zeile:"0000"})}else{u.d.PostWsItemNav.push({Vbeln:r,Matnr:e.Matnr,Posnr:o,Item:e.Item,Parnr:l,Ebelp:a,Ebeln:i,Batch:s,Pmatno1:"0",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Bgtrwt:"0.000",Brgew:"0.000",Ntgew:"0.000",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Erdat:null,Ertim:"PT00H00M00S",Aedat:null,Aetim:"PT00H00M00S",Config8:"0.00",Config2:"0.00",Zeile:"0000"})}}})}else if(u.d.PostWbHeaderNav[0].Token==""&&oThat.oView.getModel("POST").getData().Challan!=""&&oThat.PoStoFlag==="X"){oThat.oView.getModel("POLIST").getData().forEach(function(e){var a="00000";var o="000000";var i="";var r="";var l="";var s="";if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){a="00000";o=e.Posnr;r=e.Vbeln;l=e.Werks;s=e.Charg}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){a="00000";o="000000";if(oThat.oView.getModel("POST").getData().Wtype=="05"){if(oThat.oView.byId("id_Vendor").getValue()!==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg15"));w=true;return}}l=e.Parnr}else{o="000000";a=e.Ebelp;i=e.Ebeln;l=e.Parnr}if(oThat.vWb=="WB"){u.d.PostWbitemNav.push({Ebeln:i,Ebelp:a,Matnr:e.Matnr,Item:e.Item,Parnr:e.Vendor,Batch:s,NF_NUMBER:e.NF_NUMBER,NF_QUANTITY:e.NF_QUANTITY,Pmblnr:e.Charg,Brgew:"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatno1:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00",Vbeln:r,Posnr:o,Zeile:"0000"})}else{u.d.PostWsItemNav.push({Vbeln:r,Matnr:e.Matnr,Posnr:o,Item:e.Item,Parnr:l,Ebelp:a,Ebeln:i,Batch:s,Pmatno1:"0",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Bgtrwt:"0.000",Brgew:"0.000",Ntgew:"0.000",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Erdat:null,Ertim:"PT00H00M00S",Aedat:null,Aetim:"PT00H00M00S",Config8:"0.00",Config2:"0.00",Zeile:"0000"})}})}else if(u.d.PostWbHeaderNav[0].Token==""&&oThat.oView.getModel("POST").getData().Challan!=""&&oThat.PoStoFlag!=="X"){oThat.oView.getModel("POLIST").getData().forEach(function(e){var a="00000";var o="";var i="";var r="";var l="000000";if(oThat.vWb=="WB"){if(oThat.oView.getModel("POST").getData().Wtype=="05"){if(oThat.oView.byId("id_Vendor").getValue()!==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg15"));w=true;return}}u.d.PostWbitemNav.push({Ebeln:o,Ebelp:a,Matnr:e.Matnr,Parnr:e.Parnr,Vbeln:r,Posnr:l,Batch:e.Charg,Brgew:"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatno1:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00",Zeile:"0000"})}else{if(oThat.oView.getModel("POST").getData().Wtype=="05"){if(oThat.oView.byId("id_Vendor").getValue()!==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg15"));w=true;return}}u.d.PostWsItemNav.push({Vbeln:r,Matnr:e.Matnr,Posnr:l,Parnr:e.Parnr,Ebelp:a,Ebeln:o,Batch:e.Charg,Pmatno1:"0",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatno2:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatno3:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatno4:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Bgtrwt:"0.000",Brgew:"0.000",Ntgew:"0.000",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Erdat:null,Ertim:"PT00H00M00S",Aedat:null,Aetim:"PT00H00M00S",Config8:"0.00",Config2:"0.00",Zeile:"0000"})}})}else if(u.d.PostWbHeaderNav[0].Token!=""&&oThat.oView.getModel("POST").getData().Challan==""){oThat.oView.getModel("POLIST").getData().forEach(function(e){if(oThat.vWb=="WB"){if(oThat.oView.byId("id_Vendor").getValue()!=""&&e.Parnr==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}u.d.PostWbitemNav.push(e)}else{if(oThat.oView.byId("id_Vendor").getValue()!=""&&e.Parnr==""){e.Parnr=oThat.oView.byId("id_Vendor").getValue()}u.d.PostWsItemNav.push(e)}})}}}if(!w){oThat.Service="SAVE";oThat.onCallService(oThat.Service,u)}}}catch(n){if(n=="MN"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg1"))}else if(n=="IM"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg3"))}else if(n=="PO"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg13"))}else if(n=="WB"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsgWbIdWbItem"))}else if(n=="DO"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("EnterDoNumber"))}else if(n=="SV"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("PlSelectVendor"))}else if(n=="NI"){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("NoItemsFound"))}}},onPressClear:function(e){oThat.oView.byId("id_InManual").setValue("")},onPressManualQROK:function(e){var t=false;if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"&&oThat.getView().getModel("POST").getData().Wtype==="07"){if(oThat.oView.byId("id_InManualCFM").getTokens().length==0){t=true}}else{if(oThat.oView.byId("id_InManual").getValue()==""){t=true}}if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="H"){if(oThat.oView.byId("id_InManual").getValue()==""){t=true}}var a;if(oThat.oView.byId("id_InManual").getValue()){a=oThat.oView.byId("id_InManual").getValue().trim()}var o="";if(t){r.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg14"))}else{var i="";var l=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(l.length!=0){i=l[0].Process}if(i=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="F"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="G"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="I"){o=oThat.oView.byId("id_WbIdItem").getValue()}}if(i=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"){var s=oThat.oView.byId("id_InManualCFM").getTokens();var n="";if(oThat.oView.byId("id_Param7Key").getState()&&oThat.getView().byId("id_Param7").getVisible()){n="WBWR"}else{if(oThat.getView().byId("id_Rbref").getSelectedIndex()==0){n="WOWR"}else if(oThat.getView().byId("id_Rbref").getSelectedIndex()==1){n="WOWO"}}oThat.oView.getModel("POLIST").setData([]);for(var d=0;d<s.length;d++){var g={Wbid:"",Item:"",Config1:"",Config9:n,Config4:"",Werks:oThat.oView.getModel("POST").getData().Werks,Pmblnr:"",Parnr:oThat.VendorCFM!==""?oThat.VendorCFM:"",Matnr:oThat.oView.byId("id_InManualCFM").getTokens()[d].getKey(),Remarks:"",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Tdate:null,Ttime:null,Stdate:null,Sttime:null,Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00"};oThat.oView.getModel("POLIST").getData().push(g)}oThat.oView.getModel("POLIST").refresh(true);oThat.oView.getModel("VISI").getData().QRCode=true;oThat.oView.getModel("VISI").getData().Manual=false;oThat.oView.getModel("VISI").refresh(true);oThat.oView.byId("id_scanid").setState(true)}else{oThat.onQRValidate(a,o)}}},onVHremarks:function(){oThat.ValueHelpRem=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.RemarksItem",oThat);oThat.oView.addDependent(oThat.ValueHelpRem);oThat.ValueHelpRem.open()},fnEnterRemarks:function(){var e=false,t=[],a={},o=this;t=o.getView().getModel("JmRem").getData();var i=sap.ui.getCore().byId("id_RemarksEnt").getValue().trim();var r=/^\w+[\w-+\.]*\@\w+([-\.]\w+)*\.[a-zA-Z]{2,}$/;var l="";var s=false;for(var n=0;n<t.length;n++){if(t[n].Text===i.toUpperCase()){s=true;e=true;l=oThat.oView.getModel("i18n").getResourceBundle().getText("DuplNotAllowed")+"\n";break}}if(i==""){e=true;l=l+oThat.oView.getModel("i18n").getResourceBundle().getText("EntValRem")+"\n"}if(!e){a={Text:i.toUpperCase()};t.push(a);var d=new sap.ui.model.json.JSONModel;d.setData(t);o.getView().setModel(d,"JmRem");sap.ui.getCore().byId("id_RemarksEnt").setValue("");var g="";if(oThat.oView.byId("id_Param7Key").getState()&&oThat.getView().byId("id_Param7").getVisible()){g="WBWR"}else{if(oThat.getView().byId("id_Rbref").getSelectedIndex()==0){g="WOWR"}else if(oThat.getView().byId("id_Rbref").getSelectedIndex()==1){g="WOWO"}}oThat.oView.getModel("POLIST").setData([]);for(var n=0;n<t.length;n++){var T={Wbid:"",Item:"",Config1:"",Config9:g,Config4:"",Werks:oThat.oView.getModel("POST").getData().Werks,Pmblnr:"",Parnr:oThat.VendorCFM!==""?oThat.VendorCFM:"",Matnr:"",Remarks:t[n].Text,Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Tdate:null,Ttime:null,Stdate:null,Sttime:null,Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00"};oThat.oView.getModel("POLIST").getData().push(T)}oThat.oView.getModel("POLIST").refresh(true)}else{sap.ui.getCore().byId("id_RemarksEnt").setValue("");sap.m.MessageBox.error(l)}},handleDelete:function(e){var t,a=this;var o=e.getSource(),i=e.getParameter("listItem"),r=e.getParameter("listItem").getBindingContextPath().split("/")[1];var l=a.getView().getModel("JmRem");var s=l.getData();s.splice(r,1);l.refresh(true);var n=a.getView().getModel("POLIST");var d=n.getData();d.splice(r,1);n.refresh(true)},fnAcceptRem:function(){var e=this;var t=this.getView().getModel("JmRem").getData();if(t.length>0){var a="";if(t.length===1){a=t[0].Text}if(t.length>1){a=t[0].Text+" "+" + "+" "+e.getView().getModel("i18n").getProperty("RemMore")}e.getView().byId("id_InRemarks").setValue(a)}this.ValueHelpRem.destroy()},onQRValidateTransfer:function(e,a){var i=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(i.length!=0){var r=i[0].Process}var l=oThat.oView.getModel("POLIST").getData();var s=false;if(l.length>0){if(l[0].Pmblnr!==""){s=true}}if(l.length>0&&!s){var n=oThat.oView.getModel("i18n").getResourceBundle().getText("ListExitsedData");sap.m.MessageBox.show(n,{icon:sap.m.MessageBox.Icon.WARNING,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Warning"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(a){if(a==sap.m.MessageBox.Action.YES){oThat.oView.getModel("POLIST").setData([]);oThat.oView.byId("id_InManualCFM").setTokens([]);if(r=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"){var i=[];if(e.length===10){var l=new sap.ui.model.Filter("Mblnr",sap.ui.model.FilterOperator.EQ,"X");var s=new sap.ui.model.Filter("IvMblnr",sap.ui.model.FilterOperator.EQ,e);i=[l,s]}if(e.length===12){var n=new sap.ui.model.Filter("WbItem",sap.ui.model.FilterOperator.EQ,"X");var d=new sap.ui.model.Filter("IvWbId",sap.ui.model.FilterOperator.EQ,e);i=[n,d]}oThat.BusyDialog.open();oThat.oModel.read("/F4ParametersSet",{filters:i,urlParameters:{$expand:"F4WbItemNav,ReturnNav,F4MaterialNav"},success:function(a,i){oThat.BusyDialog.close();if(e.length===12||e.length===10){oThat.vWeighBridgeId=e;if(a.results[0].F4WbItemNav.results.length>0){oThat.oView.setModel(new o(a.results[0].F4WbItemNav.results),"oWbItemModel");oThat.oView.getModel("oWbItemModel").refresh();oThat.oWBItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.WBItemList",oThat);oThat.oView.addDependent(oThat.oWBItemFrag);oThat.oWBItemFrag.open()}if(a.results[0].F4WbItemNav.results.length==0){var r=oThat.oView.getModel("i18n").getResourceBundle().getText("NoItems");t.error(r)}}}.bind(this),error:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})}}else{sap.m.MessageToast.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ActCanc"))}}})}else{if(r=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"){var d=[];if(e.length===10){var g=new sap.ui.model.Filter("Mblnr",sap.ui.model.FilterOperator.EQ,"X");var T=new sap.ui.model.Filter("IvMblnr",sap.ui.model.FilterOperator.EQ,e);d=[g,T]}if(e.length===12){var h=new sap.ui.model.Filter("WbItem",sap.ui.model.FilterOperator.EQ,"X");var V=new sap.ui.model.Filter("IvWbId",sap.ui.model.FilterOperator.EQ,e);d=[h,V]}oThat.BusyDialog.open();oThat.oModel.read("/F4ParametersSet",{filters:d,urlParameters:{$expand:"F4WbItemNav,ReturnNav,F4MaterialNav"},success:function(a,i){oThat.BusyDialog.close();if(e.length===12||e.length===10){oThat.vWeighBridgeId=e;if(a.results[0].F4WbItemNav.results.length>0){oThat.oView.setModel(new o(a.results[0].F4WbItemNav.results),"oWbItemModel");oThat.oView.getModel("oWbItemModel").refresh();oThat.oWBItemFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.WBItemList",oThat);oThat.oView.addDependent(oThat.oWBItemFrag);oThat.oWBItemFrag.open()}if(a.results[0].F4WbItemNav.results.length==0){var r=oThat.oView.getModel("i18n").getResourceBundle().getText("NoItems");t.error(r)}}}.bind(this),error:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})}}},fnDeleteMatDoc:function(e){var t=e.getParameters().removedTokens[0].getKey();var a=oThat.oView.getModel("POLIST").getData();for(var o=0;o<a.length;o++){if(a[o].Pmblnr===t){a.splice(o,1);break}}oThat.oView.getModel("POLIST").refresh(true)},onCloseWbItem:function(e){var a=sap.ui.getCore().byId("id_WBItemsList").getSelectedItems();if(a.length>0){if(oThat.vWeighBridgeId.length===12){var o=[];for(var i=0;i<a.length;i++){var r={Item:a[i].getBindingContext("oWbItemModel").getObject().Item,Pmblnr:a[i].getBindingContext("oWbItemModel").getObject().Pmblnr,Matnr:a[i].getBindingContext("oWbItemModel").getObject().Matnr,Remarks:a[i].getBindingContext("oWbItemModel").getObject().Remarks};o.push(r)}oThat.fnGetWbItemDetails(oThat.vWeighBridgeId,o)}else{var o=[];for(var i=0;i<a.length;i++){var r={Zeile:a[i].getBindingContext("oWbItemModel").getObject().Item,Pmblnr:a[i].getBindingContext("oWbItemModel").getObject().Pmblnr,Matnr:a[i].getBindingContext("oWbItemModel").getObject().Matnr,Remarks:a[i].getBindingContext("oWbItemModel").getObject().Remarks,Item:""};o.push(r)}var l=oThat.oView.getModel("POLIST").getData();if(l.length==0){var s=0;for(var i=0;i<o.length;i++){s=Number(s)+1;o[i].Item=s.toString().padStart("5","0")}}else{l.sort(function(e,t){return Number(t.Item)-Number(e.Item)});var s=Number(l[0].Item);for(var i=0;i<o.length;i++){s=Number(s)+1;o[i].Item=s.toString().padStart("5","0")}}var n="";if(oThat.oView.byId("id_Param7Key").getState()&&oThat.getView().byId("id_Param7").getVisible()){n="WBWR"}else{if(oThat.getView().byId("id_Rbref").getSelectedIndex()==0){n="WOWR"}else if(oThat.getView().byId("id_Rbref").getSelectedIndex()==1){n="WOWO"}}for(var i=0;i<o.length;i++){var r={Wbid:"",Item:o[i].Item,Config1:"",Config9:n,Config4:"",Werks:oThat.oView.getModel("POST").getData().Werks,Pmblnr:o[i].Pmblnr,Zeile:Number(o[i].Zeile).toString().padStart("4","0"),Parnr:oThat.VendorCFM!==""?oThat.VendorCFM:"",Matnr:o[i].Matnr,Remarks:"",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Tdate:null,Ttime:null,Stdate:null,Sttime:null,Ntgew:"0.000",Pkwgt:"0.000",Menge:"0.000",Pmatqty1:"0.000",Trwgt1:"0.000",Pmatqty2:"0.000",Trwgt2:"0.000",Pmatqty3:"0.000",Trwgt3:"0.000",Pmatqty4:"0.000",Trwgt4:"0.000",Actweight:"0.000",Config2:"0.00",Config8:"0.00"};oThat.oView.getModel("POLIST").getData().push(r)}oThat.oView.getModel("POLIST").refresh(true)}oThat.oWBItemFrag.destroy()}else{var d=oThat.oView.getModel("i18n").getResourceBundle().getText("MiniOneItem");t.error(d)}},fnGetWbItemDetails:function(e,a){var o=[];for(var i=0;i<a.length;i++){var r={Wbid:e.length===12?e:"",Item:e.length===12?a[i].Item:"",Zeile:e.length===10?a[i].Item:"",Pmblnr:a[i].Pmblnr,Matnr:a[i].Matnr,Remarks:a[i].Remarks};o.push(r)}var l={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",TruckReport:"X",IvPo:"",IvWbid:e.length===12?e:"",Pmblnr:e.length===10?e:"",IvItem:"",IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:"",Transfer:"",IvCharg:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:o,WsItemNav:[],WbHeaderNav:[]}};oThat.BusyDialog.open();oThat.oModel.create("/GetHeadersSet",l,{success:function(e,a){oThat.BusyDialog.close();var o=e.GetReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});var i="";if(o!=0){for(var r=0;r<o.length;r++){i=i+"\n"+o[0].Message}t.error(i)}else{oThat.oView.byId("id_InManual").setValue("");oThat.oView.byId("id_WbIdItem").setValue("");oThat.oView.getModel("POST").getData().IvWbid=e.IvWbid;oThat.oView.getModel("POST").getData().IvItem=e.IvItem;oThat.oView.getModel("POST").getData().Vehtyp=e.WbHeaderNav.results[0].Vehtyp;oThat.oView.getModel("POST").getData().Dname=e.WbHeaderNav.results[0].Dname;oThat.oView.getModel("POST").getData().DriverMob=e.WbHeaderNav.results[0].DriverMob;oThat.oView.getModel("POST").getData().Vehno=e.WbHeaderNav.results[0].Vehno;oThat.oView.getModel("POST").getData().Lifnr=e.WbHeaderNav.results[0].Lifnr;oThat.oView.getModel("POST").getData().Wbname=e.WbHeaderNav.results[0].GateName;oThat.oView.getModel("POST").getData().LifnrDesc=e.WbHeaderNav.results[0].LifnrName;oThat.oView.getModel("POST").getData().Challan=e.WbHeaderNav.results[0].Challan;oThat.oView.getModel("POST").getData().Token=e.WbHeaderNav.results[0].Token;oThat.oView.getModel("POST").getData().Wbid=e.WbHeaderNav.results[0].Wbid;if(e.WbHeaderNav.results[0].Gate!=""){oThat.vWb="WB";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Gate}if(e.WbHeaderNav.results[0].Wsgate!=""){oThat.vWb="WS";oThat.oView.getModel("POST").getData().Gate=e.WbHeaderNav.results[0].Wsgate}if(e.WbHeaderNav.results[0].Dname!==""&&e.WbHeaderNav.results[0].Dname!==undefined){oThat.oView.byId("id_InDriver").setValueState("None")}if(e.WbHeaderNav.results[0].DriverMob!==""&&e.WbHeaderNav.results[0].DriverMob!==undefined){oThat.oView.byId("id_InDriverMob").setValueState("None")}if(e.WbHeaderNav.results[0].Vehtyp!==""&&e.WbHeaderNav.results[0].Vehtyp!==undefined){oThat.oView.byId("id_VehicleTy").setValueState("None")}if(e.WbHeaderNav.results[0].Vehno!==""&&e.WbHeaderNav.results[0].Vehno!==undefined){oThat.oView.byId("id_VehiNo").setValueState("None")}oThat.oView.getModel("POLIST").setData(e.WbItemNav.results);oThat.oView.getModel("POLIST").refresh();oThat.oView.getModel("POST").refresh(true);if(e.WbItemNav.results.length>0){if(e.WbItemNav.results[0].Parnr){oThat.oView.byId("id_Vendor").setValue(e.WbItemNav.results[0].Parnr);oThat.oView.byId("vTextId").setText(e.WbItemNav.results[0].Name1)}if(e.WbItemNav.results[0].Config9=="WBWR"){oThat.getView().byId("id_Param7Key").setState(true)}else{oThat.getView().byId("id_Param7Key").setState(false);oThat.getView().byId("id_Rbref").setVisible(true);oThat.getView().byId("id_RefTb").setVisible(true);if(e.WbItemNav.results[0].Config9=="WOWR"){oThat.getView().byId("id_Rbref").setSelectedIndex(0)}else{oThat.getView().byId("id_Rbref").setSelectedIndex(1)}}var l=[];var s=[];for(var r=0;r<e.WbItemNav.results.length;r++){if(e.WbItemNav.results[0].Pmblnr!==""){l.push(e.WbItemNav.results[r])}if(e.WbItemNav.results[0].Remarks!==""){s.push(e.WbItemNav.results[r])}}if(e.WbItemNav.results[0].Pmblnr!==""){oThat.getView().byId("id_InMatDoc").setVisible(true);oThat.getView().byId("id_InMatDocLabel").setVisible(true);var n=oThat.getView().byId("id_InMatDoc");var d=n.getTokens();for(var r=0;r<l.length;r++){var g=new sap.m.Token({text:l[r].Pmblnr,key:l[r].Pmblnr});d.push(g)}n.removeAllTokens();n.setTokens(d)}if(e.WbItemNav.results[0].Remarks!==""){oThat.getView().byId("id_InRemarksLabel").setVisible(true);oThat.getView().byId("id_InRemarks").setVisible(true);var T=[];var h={};for(var r=0;r<s.length;r++){h={Text:s[r].Remarks};T.push(h)}var V=new sap.ui.model.json.JSONModel;V.setData(T);oThat.getView().setModel(V,"JmRem");if(T.length===1){oThat.getView().byId("id_InRemarks").setValue(T[0].Text)}else{var u=T[0].Text+" "+" + "+" "+oThat.getView().getModel("i18n").getProperty("RemMore");oThat.getView().byId("id_InRemarks").setValue(u)}}}}}.bind(this),error:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})},onQRValidate:function(e,t){var a="";var o="";var i="";var r="";var l="";var s="";var n="";var d=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(d.length!=0){r=d[0].Process}if(r=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="A"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="B"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="D"){l=e;s=t}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="C"){n=e}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="F"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="G"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="I"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="M"){l=e;s=t}else if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="L"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"||oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="J"){l="";s="";o=e}}else{if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="H"&&r=="TRANSFER"){l=e;s=t}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){if(r=="TRANSFER"){a=""}else{a="X"}}else{a=""}if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){o=e}if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text3")){i=e}}if(r=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="H"){var g={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",TruckReport:"X",IvDelivery:o,IvPo:i,IvWbid:l,IvItem:s,IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:a,Transfer:"X",IvCharg:e,DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],IvGate:oThat.oView.getModel("POST").getData().Gate}}}else if(r=="RETURN"){var g={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",TruckReport:"X",IvDelivery:o,IvPo:i,IvWbid:l,IvItem:s,IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:a,SalesRet:"X",Transfer:"",IvCharg:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],IvGate:oThat.oView.getModel("POST").getData().Gate}}}else if(r=="TRANSFER"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"){var g={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",TruckReport:"X",IvDelivery:o,IvPo:i,IvWbid:l,IvItem:s,IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:a,Transfer:"",IvCharg:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],IvGate:oThat.oView.getModel("POST").getData().Gate}}}else{var g={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",TruckReport:"X",IvDelivery:o,IvPo:i,IvWbid:l,IvItem:s,IvWerks:oThat.oView.getModel("POST").getData().Werks,IvMatnr:a,Transfer:"",IvCharg:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],IvGate:oThat.oView.getModel("POST").getData().Gate}};g.d.WbHeaderNav.push({Wtype:r})}if(r!=="TRANSFER"){if(r!=="TRIP"){if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text4")){g.d.DelItemNav.push({Vbeln:e})}else if(oThat.oView.byId("id_POBtn").getText()===oThat.oView.getModel("i18n").getResourceBundle().getText("Text21")){g.d.PoItemNav.push({Matnr:e,Vendor:oThat.oView.byId("id_Vendor").getValue()})}else{g.d.PoItemNav.push({Ebeln:e})}}else if(r=="TRIP"){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin=="C"){g.d.WbItemNav.push({Config10:n})}}}oThat.Service="VALIDATE";oThat.onCallService(oThat.Service,g)},onOpenPOList:function(){var e="";var t=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(t.length!=0){e=t[0].Process}if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin==="H"&&e==="TRANSFER"){oThat.MatDocList=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.MatDocList",oThat);oThat.oView.addDependent(oThat.MatDocList);oThat.MatDocList.open()}else{oThat.POList=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.PoList",oThat);oThat.oView.addDependent(oThat.POList);oThat.POList.open()}},onClosePoList:function(){oThat.POList.destroy()},onCloseMatDoc:function(){oThat.MatDocList.destroy()},onSubmitVehicleNo:function(e){var a="";a=e.getSource().getValue();var o="";var i=e.getSource().getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(i.length!=0){o=i[0].Process}var r={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",IvPrint:"",EvXstring:"",TruckReport:"X",WbHeaderNav:[{Vehno:a,Wtype:o,Werks:oThat.oView.getModel("POST").getData().Werks,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp,Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,Wbid:oThat.oView.getModel("POST").getData().Wbid,Erdat:oThat.oView.getModel("POST").getData().Erdat,Ertim:oThat.oView.getModel("POST").getData().Ertim,Challan:oThat.oView.getModel("POST").getData().Challan,Token:oThat.oView.getModel("POST").getData().Token}],GetReturnNav:[]}};if(oThat.oView.getModel("POST").getData().Werks!=""){oThat.Service="VEHICLE";oThat.onCallService(oThat.Service,r)}else{oThat.oView.getModel("POST").getData().Vehno="";oThat.oView.getModel("POST").refresh();t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("Plant_Mandatory"))}},onSave:function(){var e="";e=oThat.oView.getModel("POST").getData().Vehno;if(oThat.getView().byId("id_VehicleTyCombo").getValue()){oThat.oView.getModel("POST").getData().Vehtyp=oThat.getView().byId("id_VehicleTyCombo").getValue()}var a="";if(!oThat.getView().byId("id_ComboProcess").getProperty("visible")){oThat.oView.getModel("POST").getData().Wtype="04"}var o=oThat.oView.getModel("F4Model").getData().results[0].F4ProcessNav.results.filter(function(e){return e.SeqNo==oThat.oView.getModel("POST").getData().Wtype});if(o.length!=0){a=o[0].Process}if(oThat.SelectedPlant.ImgFlag!=""){if(!oThat.Asnnumber&&!oThat.oAsnHeaderData){if(oThat.getView().getModel("MASS").getData().length==0){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorAttachment"));return}}}else{}var i={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",IvPrint:"",EvXstring:"",TruckReport:"X",WbHeaderNav:[{Vehno:e,Wtype:a,Werks:oThat.oView.getModel("POST").getData().Werks,Lifnr:oThat.oView.getModel("POST").getData().Lifnr,Vehtyp:oThat.oView.getModel("POST").getData().Vehtyp.substr(0,15),Dname:oThat.oView.getModel("POST").getData().Dname,DriverMob:oThat.oView.getModel("POST").getData().DriverMob,Wbid:oThat.oView.getModel("POST").getData().Wbid,Erdat:oThat.oView.getModel("POST").getData().Erdat,Ertim:oThat.oView.getModel("POST").getData().Ertim,Challan:oThat.oView.getModel("POST").getData().Challan,Token:oThat.oView.getModel("POST").getData().Token}],GetReturnNav:[]}};if(oThat.oView.getModel("POST").getData().Werks!=""){if(a==="TRIP"){oThat.onPressSave()}else{oThat.Service="VEHICLEVALIDATE";oThat.onCallService(oThat.Service,i)}}else{oThat.oView.getModel("POST").getData().Vehno="";oThat.oView.getModel("POST").refresh();t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("Plant_Mandatory"))}},onPressPrint:function(){var e={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",IvPrint:"X",EvXstring:"",TruckReport:"X",WbHeaderNav:oThat.oView.getModel("RETURN").getData().PostWbHeaderNav.results,GetReturnNav:[]}};oThat.Service="PDF";oThat.onCallService(oThat.Service,e)},initiatePdfDialog:function(){oThat.oImageDialog=new sap.m.Dialog({title:"PDF",contentWidth:"100%",contentHeight:"",content:new sap.ui.core.HTML({}),beginButton:new sap.m.Button({text:"Close",class:"sapUiSizeCompact",press:function(){oThat.oImageDialog.close()}})})},onNavBack:function(e){if(oThat.oView.getModel("VISI").getData().Manual===true){oThat.oView.getModel("VISI").getData().QRCode=true;oThat.oView.getModel("VISI").getData().Manual=false;oThat.oView.getModel("VISI").refresh(true);oThat.oView.byId("id_scanid").setState(true)}else{var a=oThat.oView.getModel("POST").getData();try{var i=false;if(a.Werks!==""){i=true}if(a.Gate!==""){i=true}if(a.Vehno!==""){i=true}if(a.Dname!==""){i=true}if(a.DriverMob!==""){i=true}if(a.Vehtyp!==""){i=true}if(i==true){throw i}else{oThat.oView.setModel(new o({}),"oDisplayModel");oThat.oRouter.navTo("Inbound")}}catch(e){t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg3"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(e){if(e==="YES"){oThat.oView.setModel(new o({}),"oDisplayModel");oThat.oRouter.navTo("Inbound")}}})}}if(oThat.oView.getModel("POST").getData().Wtype=="02"&&plantFlag==="X"){var r=oThat.getView().getModel("POST");r.setProperty("/Vehno",oThat.oView.getModel("SwitchoffModel").getData().Vehno);r.setProperty("/Vehtyp",oThat.oView.getModel("SwitchoffModel").getData().Vehtyp);r.setProperty("/Dname",oThat.oView.getModel("SwitchoffModel").getData().Dname);r.setProperty("/DriverMob",oThat.oView.getModel("SwitchoffModel").getData().DriverMob);r.setProperty("/Lifnr",oThat.oView.getModel("SwitchoffModel").getData().Lifnr);r.setProperty("/LifnrDesc",oThat.oView.getModel("SwitchoffModel").getData().LifnrDesc)}},onClosePoIteListCopy:function(e){if(oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="L"&&oThat.oView.getModel("oDisplayModel").getData().EvOrigin!=="J"){t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ConfirmMsg1"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(e){if(e==="YES"){var a=sap.ui.getCore().byId("id_PoItemList").getSelectedItems();if(oThat.oView.getModel("oViewModel").getData().NotaProperty===true){var o=a[0].getBindingContext("oPoitemModel").getObject().Menge;var i=sap.ui.getCore().byId("notanoId").getValue();var r=sap.ui.getCore().byId("notaQId").getValue();var l=sap.ui.getCore().byId("bagQty").getValue();if(oThat.oView.getModel("oViewModel").getData().CMSProperty===true){if(Number(r)>Number(o)){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorQuantity"));return}}oThat.oView.byId("visibleListId").setVisible(true)}if(a.length!=0){for(var s=0;s<a.length;s++){var n=a[s].getBindingContext("oPoitemModel").getPath();oThat.oView.getModel("oPoitemModel").setProperty(n+"/Parnr",oThat.oView.byId("id_Vendor").getValue());oThat.oView.getModel("oPoitemModel").setProperty(n+"/NF_NUMBER",i);oThat.oView.getModel("oPoitemModel").setProperty(n+"/NF_QUANTITY",r);oThat.oView.getModel("oPoitemModel").setProperty(n+"/NO_BAGS",l);oThat.oView.getModel("oPoitemModel").refresh();oThat.oView.getModel("POLIST").getData().push(a[s].getBindingContext("oPoitemModel").getObject())}}oThat.oView.getModel("POLIST").refresh();oThat.oPoItemFrag.destroy()}}})}else{oThat.oView.getModel("POLIST").getData().push(this.getView().getModel("oPoitemModel").getData().results[0])}},onClosePoIteList:function(e){var t=true;if(oThat.SelectedPlant.Param==="H"){var a=sap.ui.getCore().byId("id_PoItemList").getSelectedItems();var o=oThat.oView.getModel("POLIST").getData();var i=[];for(var r in a){i.push(a[r].getBindingContext("oPoitemModel").getObject())}for(var l in o){i.push(o[l])}var s=0,n=0;for(var d in i){if(i[d].FertFlag==="X"){s+=1}else{n+=1}}var g=i.length;if(g===s){t=true;oThat.getView().byId("id_Param7Key").setState(true);oThat.getView().byId("id_Param7Key").setEnabled(false)}else if(g===n){t=true}else{t=false}}if(t){if(plantFlag==="X"){if(scanPlantFlag==="X"){var a=this.aData;if(a.length!=0){for(var T=0;T<a.length;T++){oThat.oView.getModel("oPoitemModel").getData().results[T].NF_NUMBER=a[T].NotaFiscalNo;oThat.oView.getModel("oPoitemModel").getData().results[T].NF_QUANTITY=a[T].NotaFiscalQty;oThat.oView.getModel("oPoitemModel").getData().results[T].NO_BAGS=a[T].bagQty;oThat.oView.getModel("oPoitemModel").getData().results[T].Parnr=oThat.oView.byId("id_Vendor").getValue();oThat.oView.getModel("oPoitemModel").refresh();oThat.oView.getModel("POLIST").getData().push(this.scanArry.results[T])}}oThat.oView.getModel("POLIST").refresh()}else{oThat.onClosePoIteListCopy(e)}}else{oThat.onClosePoIteListCopy(e)}}else{sap.m.MessageBox.information(oThat.oView.getModel("i18n").getResourceBundle().getText("mattypeDif"))}},onDmsPost:function(e){if(oThat.Images.length!=0){var a=[];oThat.Images.forEach(function(e){a.push({Dokar:"",Doknr:e.Doknr,Dokvr:"",Doktl:"",Dokob:"",Object:"",Objky:"",Fname:e.Fname,Ftype:e.Ftype,Filename:e.Filename})});var o={d:{IvWbid:e,DmsPostNav:a,DmsReturnNav:[]}};oThat.oModel.create("/DmsPostSet",o,{success:function(){oThat.Images=[]},error:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})}},onClickReprint:function(){var e=this;e.Reprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.RePrint",e);e.oView.addDependent(e.Reprint);e.Reprint.open();sap.ui.getCore().byId("id_InBatch").setVisible(false);sap.ui.getCore().byId("id_InBatchLabel").setVisible(false)},onClickReprintDecline:function(){oThat.Reprint.destroy()},fnClickonReprintOK:function(){var e=this;if(sap.ui.getCore().byId("id_InVehicleNo").getValue()===""||sap.ui.getCore().byId("id_InWbid").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()==null){t.error(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg7"))}else{var a=sap.ui.getCore().byId("id_InWbid").getValue();var o=e.oModel.sServiceUrl;var i="";var r="/DownloadSet(IvWbid='"+a+"',IvPrint='X',GateEntry='X',IvBatch='"+i+"')/$value";var l=o+r;if(sap.ui.Device.system.desktop){e.initiatePdfDialog();var s="<div><iframe src="+l+" width='100%' height='520'></iframe></div>";e.oImageDialog.getContent()[0].setContent(s);e.oImageDialog.addStyleClass("sapUiSizeCompact");e.oImageDialog.open()}else{window.open(l)}e.Reprint.destroy()}},onClickVehicleF4:function(e){var a=this;a.vId=e.getSource().getId();var o=sap.ui.getCore().byId("id_InDate").getValue();if(o!==null&&o!==""){var o=sap.ui.getCore().byId("id_InDate").getDateValue();var i=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var r=i.format(o);a.Service="REPRINT";var l={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",StatusUpdate:"X",TruckReport:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[{InDate:r}]}};a.onCallService(a.Service,l)}else{t.error(a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6"))}},onScanWbId:function(){var e=this;var t=e.getView().getModel("i18n").getResourceBundle();var a=new o;if(ZXing!==undefined&&!sap.ui.Device.system.desktop){this.loadZXingLibrary().then(()=>{d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(o=>{if(o.length>1){n=o[1].deviceId}else if(o.length===1){n=o[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_WbidNo").setValue(t.text.trim());e.fnValidateWbID(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}if(o.length>=1){var i=[];o.forEach(o=>{if(o.label.includes("0")){n=o.deviceId}var r={};r.text=o.label;r.value=o.deviceId;i.push(r);a.setData(i);this.getView().setModel(a,"oVideoDeviceModel");g=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:n,selectionChange:function(t){n=t.getSource().getSelectedKey();e._oScanQRDialog.close();d.reset()}});T=new sap.m.Button({text:t.getText("Start"),type:t.getText("Accept"),press:function(){e._oScanQRDialog.close();e.onScanWbId()}});e.startScanningWbId()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_WbidNo").setValue(t.text.trim());e.fnValidateWbID(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}},startScanningWbId:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){s=true}else{s=false}}catch(e){s=false}if(s===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_WbidNo").setValue(t.text.trim());e.fnValidateWbID(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(n,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();e.getView().byId("id_WbidNo").setValue(t.text.trim());e.fnValidateWbID(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_WbidNo").setValue(t.text.trim());e.fnValidateWbID(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},fnValidateWbID:function(e){var t=oThat.oView.byId("id_WbidNo").getValue();var a={d:{GateEntry:"",TruckReport:"X",Inbound:"X",IvWbid:t,IvItem:"00000",GetReturnNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],DelItemNav:[],PoItemNav:[]}};a.d.WbHeaderNav.push({Token:t});oThat.Service="VALIDWBID";oThat.onCallService(oThat.Service,a)},onScanDelivery:function(e){var t=this;var a=t.getView().getModel("i18n").getResourceBundle();var i=new o;var r=e.getSource();var l=this.getView().getLocalId(r.getId());var s="";if(l==="id_ScanDeliveryIC"){s="id_DeliveryICValue";t.oView.byId("id_Delivery").setValue("")}else if(l==="Id_ScanDelivery"){s="id_Delivery";t.oView.byId("id_DeliveryICValue").setValue("")}if(ZXing!==undefined&&!sap.ui.Device.system.desktop){this.loadZXingLibrary().then(()=>{d=new ZXing.BrowserMultiFormatReader;d.listVideoInputDevices().then(e=>{if(e.length>1){n=e[1].deviceId}else if(e.length===1){n=e[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.getView().byId(s).setValue(e.text.trim());t.onSubmitDelivery(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}if(e.length>=1){var o=[];e.forEach(e=>{if(e.label.includes("0")){n=e.deviceId}var r={};r.text=e.label;r.value=e.deviceId;o.push(r);i.setData(o);this.getView().setModel(i,"oVideoDeviceModel");g=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:n,selectionChange:function(e){n=e.getSource().getSelectedKey();t._oScanQRDialog.close();d.reset()}});T=new sap.m.Button({text:a.getText("Start"),type:a.getText("Accept"),press:function(){t._oScanQRDialog.close();t.onScanDelivery()}});t.startScanningDelviery()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(e){if(!e.cancelled){t.getView().byId(s).setValue(e.text.trim());t.onSubmitDelivery(e.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},loadZXingLibrary:function(){return new Promise((e,t)=>{var a=document.createElement("script");a.src=sap.ui.require.toUrl("ZGT_MM_INBOUND/ScannerAppLibrary/index.min.js");a.onload=e;a.onerror=t;document.head.appendChild(a)})},startScanningDelviery:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){s=true}else{s=false}}catch(e){s=false}if(s===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();d.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_Delivery").setValue(t.text.trim());e.onSubmitDelivery(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){d.decodeFromVideoDevice(n,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();d.reset();e.getView().byId("id_Delivery").setValue(t.text.trim());e.onSubmitDelivery(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.getView().byId("id_Delivery").setValue(t.text.trim());e.onSubmitDelivery(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},onSubmitDelivery:function(){var e=oThat.oView.byId("id_Delivery").getValue();var a=oThat.oView.byId("id_DeliveryICValue").getValue();if(e!=""){if(oThat.oView.getModel("POLIST").getData().length==0){var o={d:{GateEntry:"",Inbound:"X",IvDelivery:e,IvPo:"",IvWbid:"",IvWerks:"",IvMatnr:"",TruckReport:"X",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};o.d.WbHeaderNav.push({Challan:e});oThat.Service="VALIDDELIVERY";oThat.onCallService(oThat.Service,o)}else{sap.m.MessageBox.confirm(oThat.oView.getModel("i18n").getResourceBundle().getText("Delivery_Not_Applicable"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Confirm"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t=="YES"){oThat.oView.getModel("POLIST").setData([]);oThat.oView.getModel("POLIST").refresh();oThat.oView.getModel("POST").getData().Challan="";oThat.oView.getModel("POST").getData().Vehno="";oThat.oView.getModel("POST").getData().Vehtyp="";oThat.oView.getModel("POST").getData().Dname="";oThat.oView.getModel("POST").getData().Lifnr="";oThat.oView.getModel("POST").getData().DriverMob="";oThat.oView.getModel("POST").refresh();if(e!=""){var a={d:{GateEntry:"",Inbound:"X",IvDelivery:e,IvPo:"",IvWbid:"",IvWerks:"",IvMatnr:"",TruckReport:"X",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[]}};a.d.WbHeaderNav.push({Challan:e});oThat.Service="VALIDDELIVERY";oThat.onCallService(oThat.Service,a)}}else{oThat.oView.byId("id_Delivery").setValue(oThat.oView.getModel("POST").getData().Challan)}}})}}if(a){oThat.BusyDialog.open();var r=[new i("Delivery",sap.ui.model.FilterOperator.EQ,a)];var l=oThat.getOwnerComponent().getModel();l.read("/GetDelHeaderSet",{filters:r,success:function(e){oThat.BusyDialog.close();if(e.results&&e.results.length>0){oThat.oView.byId("id_VehiNo").setValue(e.results[0].VehicleNo||"");oThat.oView.byId("id_VehicleTy").setValue(e.results[0].VehicleType||"");oThat.oView.byId("id_InDriver").setValue(e.results[0].DriverName||"");oThat.oView.byId("id_InDriverMob").setValue(e.results[0].MobileNo||"");oThat.oView.getModel("POST").getData().Challan=a}}.bind(this),error:function(e){oThat.BusyDialog.close();t.error("OData Error: "+e.responseText)}})}},onSettings:function(){oThat.PersonalizeFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Personalize",oThat);oThat.oView.addDependent(oThat.PersonalizeFrag);oThat.oDataBeforeOpen=jQuery.extend(true,{},oThat.oPersonalModel.getData());oThat.PersonalizeFrag.open()},onCancel:function(){oThat.oPersonalModel.setProperty("/",jQuery.extend(true,[],oThat.oDataBeforeOpen));oThat.oDataBeforeOpen={};oThat.PersonalizeFrag.close()},onOK:function(e){var t=oThat.oPersonalModel.getData().ColumnsItems;for(var a=0;a<t.length;a++){if(t[a].columnKey=="Challan"){if(t[a].visible==true){oThat.oView.byId("id_VendorBox").setVisible(true);oThat.oView.byId("id_Vendor").setValue("");oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text21"));oThat.oView.byId("id_ScanToolbar").setVisible(false);oThat.oView.getModel("POST").getData().Wtype="05"}else{oThat.oView.byId("id_VendorBox").setVisible(false);oThat.oView.byId("id_Vendor").setValue("");oThat.oView.byId("id_POBtn").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Text3"));oThat.oView.byId("id_ScanToolbar").setVisible(true);oThat.oView.getModel("POST").getData().Wtype=""}}}oThat.oView.getModel("POST").refresh();oThat.PersonalizeFrag.close()},onNotaFiscalChange:function(e){var t=parseFloat(sap.ui.getCore().byId("notaQId").getValue())/parseFloat(oThat.oView.getModel("POST").getData().EvSixtyBag);if(Number.isInteger(t)){t=t}else{t=parseInt(t+1)}sap.ui.getCore().byId("bagQty").setValue(t)},onNotaFiscalChangeQR:function(e){for(var t=0;t<this.aData.length;t++){var a=parseFloat(this.aData[t].NotaFiscalQty)/parseFloat(oThat.oView.getModel("POST").getData().EvSixtyBag);if(Number.isInteger(a)){a=a}else{a=parseInt(a+1)}this.aData[t].bagQty=a}},fnDriverMob:function(e){var t=15;var a=oThat.getView().byId("id_InDriverMob").getValue();var o=a.length;if(o>t){oThat.getView().byId("id_InDriverMob").setValue(oThat.vPrevious);oThat.getView().byId("id_InDriverMob").setValueStateText("Maximum 15 Digits only");oThat.getView().byId("id_InDriverMob").setValueState("Error")}else{oThat.getView().byId("id_InDriverMob").setValue(a);oThat.vPrevious=a;oThat.getView().byId("id_InDriverMob").setValueStateText("");oThat.getView().byId("id_InDriverMob").setValueState("None")}},fnDrivernameChange:function(e){var t=20;var a=oThat.getView().byId("id_InDriver").getValue();a=a.toUpperCase();var o=a.substr(a.length-1,1);if(o.charCodeAt()>=65&&o.charCodeAt()<=90||o.charCodeAt()===32){a=a}else{a=a.substr(0,a.length-1)}var i=a.length;if(i>t){oThat.getView().byId("id_InDriver").setValue(oThat.vPrevious);oThat.getView().byId("id_InDriver").setValueStateText("Maximum 20 Charecters only");oThat.getView().byId("id_InDriver").setValueState("Error")}else{oThat.getView().byId("id_InDriver").setValue(a);oThat.vPrevious=a;oThat.getView().byId("id_InDriver").setValueStateText("");oThat.getView().byId("id_InDriver").setValueState("None")}},fnVehiceTypeChange:function(e){var t=15;var a=oThat.getView().byId("id_VehicleTy").getValue();var o=a.length;if(o>t){oThat.getView().byId("id_VehicleTy").setValue(oThat.vPrevious);oThat.getView().byId("id_VehicleTy").setValueStateText("Maximum 15 Charecters only");oThat.getView().byId("id_VehicleTy").setValueState("Error")}else{oThat.getView().byId("id_VehicleTy").setValue(a);oThat.vPrevious=a;oThat.getView().byId("id_VehicleTy").setValueStateText("");oThat.getView().byId("id_VehicleTy").setValueState("None")}},setScanRefernceNo:function(e){var a=oThat.getView().getModel("i18n").getResourceBundle();if(e.length===10){oThat.BusyDialog.open();var o=oThat.oView.getModel("POST").getData().Wtype,i=[],l=new sap.ui.model.Filter("RgpRef",sap.ui.model.FilterOperator.EQ,"X"),s=new sap.ui.model.Filter("IvRef",sap.ui.model.FilterOperator.EQ,e),n=new sap.ui.model.Filter("IvProc",sap.ui.model.FilterOperator.EQ,o),d=new sap.ui.model.Filter("IvGate",sap.ui.model.FilterOperator.EQ,"G");i=[l,s,d,n];oThat.oModel.read("/F4ParametersSet",{filters:i,urlParameters:{$expand:"ReturnNav"},success:function(o,i){oThat.BusyDialog.close();if(o.results[0].ReturnNav.results.length>0){if(o.results[0].ReturnNav.results[0].Type==="E")t.show(o.results[0].ReturnNav.results[0].Message)}else{var l=oThat.oView.byId("id_InRefNoValue").getValue().trim();if(l.length>=32){r.show(a.getText("refscanValidation"))}else if(l.length===0){oThat.oView.byId("id_InRefNoValue").setValue(e)}else{oThat.oView.byId("id_InRefNoValue").setValue(l+","+e)}}},error:function(e){oThat.BusyDialog.close();r.show(a.getText("Title21"))}})}else{r.show(a.getText("incorrect"))}},onresetRefNo:function(){this.oView.byId("id_InRefNoValue").setValue("")},onCaptureVehicleImage:function(){var e=this;e.vehicleImage=[];e.getView().setModel(new o(e.vehicleImage),"vehicleImage");e.getView().getModel("vehicleImage").refresh(true);if(!e.oCaptureVeh){e.oCaptureVeh=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.VehicleImage",e);e.getView().addDependent(e.oCaptureVeh)}e.oCaptureVeh.open()},fnclosevehicle:function(){this.oCaptureVeh.close()},fnokvehicle:function(){var e=this;e.BusyDialog.open();const a=872;const o=782;const i=e.vehicleImage[0].Ftype;const r=1;var l=URL.createObjectURL(e.vehFile);const s=new Image;s.src=l;s.onerror=function(){URL.revokeObjectURL(this.src);console.log("Cannot load image")};s.onload=function(){URL.revokeObjectURL(this.src);const[l,n]=e.calculateSize(s,a,o);const d=document.createElement("canvas");d.width=l;d.height=n;const g=d.getContext("2d");g.drawImage(s,0,0,l,n);d.toBlob(a=>{var o=new FileReader;o.readAsDataURL(a);o.onloadend=function(){var a=o.result;var i=a;var r={url:"https://OCR-NumberPlate-Dev-patient-hippopotamus-ti.cfapps.eu10.hana.ondemand.com/DPWCMGrains",method:"POST",headers:{"Content-Type":"text/plain"},data:i};jQuery.ajax(r).done(function(a){if(a.value){e.oView.getModel("POST").getData().IV_VEH_NO=a.value[0];e.oView.byId("id_VehiNo").setValue(e.getView().getModel("POST").getData().IV_VEH_NO);e.getView().byId("id_VehiNo").setEnabled(true)}else{t.error(e.getView().getModel("i18n").getResourceBundle().getText("ErrorOcr"));e.oView.byId("id_VehiNo").setValue("")}e.BusyDialog.close();e.oCaptureVeh.close()})}},i,r)}},onFileDeletedvehicle:function(e){var t=e.getParameter("documentId");for(var a=0;a<oThat.vehicleImage.length;a++){if(oThat.vehicleImage[a].Documentid==t){oThat.vehicleImage.splice(oThat.vehicleImage[a],1);break}}oThat.getView().setModel(new o(oThat.vehicleImage),"vehicleImage");oThat.getView().getModel("vehicleImage").refresh(true)},onCompleteUploadVehicleNumber:function(e){var t=this;var a=e.getSource()._getFileUploader()._aXhr[0]["file"];var i={};var r=a.name.split(".");var l="VEH_OCR."+r[r.length-1];i.Documentid=jQuery.now().toString();i.Fname=l;i.Ftype=a.type;i.Objky="";i.Doknr="000";e.getSource()._getFileUploader()._aXhr.splice(0,1);if(a){oThat.vehFile=a;var s=new FileReader;var n="data:"+a.type+";base64,";s.onloadend=function(e){return function(e){var t=e.target.result.indexOf(n)+n.length;var a=e.target.result.substring(t);i.Filename=a;oThat.vehicleImage.unshift(i);i={};oThat.getView().setModel(new o(oThat.vehicleImage),"vehicleImage");oThat.getView().getModel("vehicleImage").refresh(true);oThat.BusyDialog.close()}}(a)}s.readAsDataURL(a)},calculateSize:function(e,t,a){let o=e.width;let i=e.height;if(o>i){if(o>t){i=Math.round(i*t/o);o=t}}else{if(i>a){o=Math.round(o*a/i);i=a}}return[o,i]},onToggleSelectAll:function(e){var t=sap.ui.getCore().byId("id_PoItemList");var a=e.getSource();if(a.getText()==="Select All"){t.selectAll();a.setText("Deselect All")}else{t.removeSelections(true);a.setText("Select All")}}})});
//# sourceMappingURL=Truck_Reporting.controller.js.map