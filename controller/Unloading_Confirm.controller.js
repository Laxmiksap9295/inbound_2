jQuery.sap.require("sap.ndc.BarcodeScanner");var oThat;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/BusyDialog","sap/ui/model/json/JSONModel","sap/ui/model/Filter","ZGT_MM_INBOUND/lib/signature","sap/m/MessageToast","sap/m/TablePersoController","ZGT_MM_INBOUND/Util/DemoPersoService"],function(e,t,a,o,r,i,l,n,s){"use strict";var g,d,u,d,h,T,c;var v;var M;var f={toArrayBuffer:function(e){var t=e.width,a=e.height,o=t*4,r=e.getContext("2d").getImageData(0,0,t,a),i=new Uint32Array(r.data.buffer),l=Math.floor((32*t+31)/32)*4,n=l*a,s=122+n,g=new ArrayBuffer(s),d=new DataView(g),u=0,h,T=0,c,v=0,M,f;p(19778);w(s);u+=4;w(122);w(108);w(t);w(-a>>>0);p(1);p(32);w(3);w(n);w(2835);w(2835);u+=8;w(16711680);w(65280);w(255);w(4278190080);w(1466527264);while(T<a){c=122+T*l;h=0;while(h<o){f=i[v++];M=f>>>24;d.setUint32(c+h,f<<8|M);h+=4}T++}return g;function p(e){d.setUint16(u,e,true);u+=2}function w(e){d.setUint32(u,e,true);u+=4}},toBlob:function(e){return new Blob([this.toArrayBuffer(e)],{type:"image/bmp"})},toDataURL:function(e){var t=new Uint8Array(this.toArrayBuffer(e)),a="",o=0,r=t.length;while(o<r)a+=String.fromCharCode(t[o++]);return"data:image/bmp;base64,"+btoa(a)}};return e.extend("ZGT_MM_INBOUND.controller.Unloading_Confirm",{onInit:function(){oThat=this;oThat.oView=this.getView();oThat.Core=sap.ui.getCore();oThat.BusyDialog=new a;this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getRoute("Unloading").attachMatched(this._onRouteMatched,this);this._oTPC=new n({table:oThat.oView.byId("id_unload"),persoService:s}).activate()},_onRouteMatched:function(e){oThat=this;oThat.oView=oThat.getView();oThat.getView().byId("id_SearchField").setValue("");oThat.oView.setModel(new o,"oViewModel");oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false);oThat.oView.getModel("oViewModel").setProperty("/REMARKS",false);oThat.oView.getModel("oViewModel").setProperty("/fPackingWtColumn",false);oThat.oView.getModel("oViewModel").setProperty("/nPackingWtColumn",false);oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",false);oThat.BusyDialog=new a;oThat.Images=[];oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true);oThat.oModel=oThat.getOwnerComponent().getModel();if(sap.ui.Device.system.phone){oThat.oDevice="P"}else{oThat.oDevice="D"}oThat.Service="GET";var t={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",QualWbidNav:[],GetReturnNav:[]}};oThat.onCallService(oThat.Service,t);var i=[new r("Inremarks",sap.ui.model.FilterOperator.EQ,"X")];oThat.oModel.read("/F4ParametersSet",{filters:i,urlParameters:{$expand:"F4RemarksNav"},success:function(e,t){var a=new o(e.results[0].F4RemarksNav);oThat.oView.setModel(a,"REASON")},error:function(e){}})},onCallService:function(e,t){oThat.BusyDialog.open();if(oThat.Service==="GET"||oThat.Service=="ITEM"||oThat.Service==="BATCH"||oThat.Service==="GETBATCH"||oThat.Service==="POITEMS"){oThat.oModel.create("/GetHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SLOC"){oThat.oModel.read("/F4SlocsSet",{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="UOM"){oThat.oModel.read("/F4ParametersSet",{filters:t,urlParameters:{$expand:"F4UomNav"},success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SUBMIT"||oThat.Service==="UpdatePODETAILS"){oThat.oModel.create("/PostHeadersSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="GETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/BatchGetSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="SETCHAR"){oThat.BusyDialog.open();oThat.oModel.create("/PostBatchSet",t,{success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}else if(oThat.Service==="REPRINT"){oThat.oModel.create("/GetHeadersSet",t,{filters:t,success:oThat.mySuccessHandler,error:oThat.myErrorHandler})}},mySuccessHandler:function(e){oThat.BusyDialog.close();if(oThat.Service==="GET"){oThat.oUnloadData=JSON.parse(JSON.stringify(e));var a=new o(e);oThat.oView.setModel(a,"oUnloadModel");var i=new o(e);oThat.oView.setModel(i,"oUnloadModDel");if(e.EvDispFlag==="X"){oThat.oView.byId("vendorBrzNo").setVisible(true);oThat.oView.byId("CmsBrzno").setVisible(true);oThat.oView.byId("Dname").setVisible(true);oThat.oView.byId("DriverMob").setVisible(true)}else{oThat.oView.byId("vendorBrzNo").setVisible(false);oThat.oView.byId("CmsBrzno").setVisible(false);oThat.oView.byId("Dname").setVisible(false);oThat.oView.byId("DriverMob").setVisible(false)}if(e.ExReprintFlag==="X"){oThat.oView.byId("id_ReprintBtn").setVisible(true)}else{oThat.oView.byId("id_ReprintBtn").setVisible(false)}if(e.ExPrlotLayout==="X"){oThat.oView.byId("id_Maktx").setVisible(true);oThat.oView.byId("Matnr").setVisible(false);oThat.oView.byId("id_PRLot").setVisible(true);oThat.oView.byId("id_PoutQty").setVisible(true);oThat.oView.byId("id_PoutQtyBags").setVisible(true)}else{oThat.oView.byId("id_Maktx").setVisible(false);oThat.oView.byId("Matnr").setVisible(true);oThat.oView.byId("id_PRLot").setVisible(false);oThat.oView.byId("id_PoutQty").setVisible(false);oThat.oView.byId("id_PoutQtyBags").setVisible(false)}oThat.oView.getModel("oUnloadModel").refresh(true);oThat.oView.getModel("oUnloadModDel").refresh(true)}else if(oThat.Service==="GETBATCH"){oThat.oView.setModel(new o(e.F4PrlotPrintNav.results),"LotF4Data");oThat.oView.getModel("LotF4Data").refresh(true);if(e.F4PrlotPrintNav.results.length!=0){oThat.LotF4=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.LotF4",oThat);oThat.oView.addDependent(oThat.LotF4);oThat.LotF4.open()}else{l.show(oThat.oView.getModel("i18n").getResourceBundle().getText("NoLotAvail"))}}else if(oThat.Service==="ITEM"){if(e.GetReturnNav.results.length>0){if(e.GetReturnNav.results[0].Type!=="E"){oThat.EvWtype=e.EvWtype;oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet");if(e.UnloadConfNav.results.length>0){if(e.UnloadConfNav.results[0].FLAG==="X"){oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false)}else{oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true)}if(e.EvOrigin==="B"&&e.WbHeaderNav.results[0].Wtype==="TRIP"){oThat.oView.getModel("oViewModel").setProperty("/REMARKS",true)}else{oThat.oView.getModel("oViewModel").setProperty("/REMARKS",false)}if(oThat.oView.getModel("ITEM").getData().EvOrigin==="E"){oThat.oView.getModel("oViewModel").setProperty("/Origin",true);oThat.oView.getModel("oViewModel").setProperty("/Box",true)}else{oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/Box",false)}if(oThat.oView.getModel("ITEM").getData().EvOrigin==="K"||oThat.oView.getModel("ITEM").getData().EvOrigin==="M"){oThat.oView.getModel("oViewModel").setProperty("/Quantity",true);oThat.oView.getModel("oViewModel").setProperty("/Uom",true);oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Uom=e.WbItemNav.results[0].Uom;v=e.WbItemNav.results[0].Uom;var n="";oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Quantity=n;oThat.oView.getModel("ITEM").refresh()}else{oThat.oView.getModel("oViewModel").setProperty("/Quantity",false);oThat.oView.getModel("oViewModel").setProperty("/Uom",false)}oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Check=false;oThat.oView.getModel("ITEM").refresh()}oThat.oView.getModel("ITEM").refresh(true)}else{t.error(e.GetReturnNav.results[0].Message);oThat.UnloadFrag2901.close()}}else{oThat.EvWtype=e.EvWtype;e.QaMsgType=oThat.TableSelectedObject.QaMsgType;oThat.fertType=true;for(var s in e.PoItemNav.results){if(e.PoItemNav.results[s].FertFlag==="X"){oThat.fertType=false;break}}for(var s in e.DelItemNav.results){if(e.DelItemNav.results[s].FertFlag==="X"){oThat.fertType=false;break}}if(oThat.TableSelectedObject.QaMsgType==="H"){oThat.oView.getModel("oViewModel").setProperty("/vFertType",true);oThat.oView.getModel("oViewModel").setProperty("/zFertType",false);oThat.oView.getModel("oViewModel").setProperty("/nFertType",false);var g=sap.ui.getCore().byId("WBIdLabel1");var d=sap.ui.getCore().byId("WBIdLabel2");if(g&&d){g.setVisible(true);d.setVisible(false)}if(oThat.fertType){oThat.oView.getModel("oViewModel").setProperty("/vChallan",true);oThat.oView.getModel("oViewModel").setProperty("/vUnloadqty",true);oThat.oView.getModel("oViewModel").setProperty("/vRejectedqty",true);oThat.oView.getModel("oViewModel").setProperty("/vAcceptqty",true);oThat.oView.getModel("oViewModel").setProperty("/vUOM",true);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",true);oThat.oView.getModel("oViewModel").setProperty("/vDel",true);oThat.oView.getModel("oViewModel").setProperty("/vADD",true)}else{oThat.oView.getModel("oViewModel").setProperty("/vChallan",false);oThat.oView.getModel("oViewModel").setProperty("/vUnloadqty",false);oThat.oView.getModel("oViewModel").setProperty("/vRejectedqty",false);oThat.oView.getModel("oViewModel").setProperty("/vAcceptqty",false);oThat.oView.getModel("oViewModel").setProperty("/vUOM",false);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",false);oThat.oView.getModel("oViewModel").setProperty("/vDel",false);oThat.oView.getModel("oViewModel").setProperty("/vADD",false)}e.UnloadConfNav.results=[];for(var u in e.WbItemNav.results){e.UnloadConfNav.results.push(e.WbItemNav.results[u])}if(e.WbItemNav.results.some(function(e){return e.PackingFlag==="X"})){oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",true)}else{oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",false)}oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet")}else if(oThat.TableSelectedObject.QaMsgType==="1"){oThat.oView.getModel("oViewModel").setProperty("/zFertType",false);e.WbItemNav.results.forEach(function(e){if(e.FertFlag==="X"){oThat.aFertWbData.push(e)}else{oThat.aNonFertWbData.push(e)}});var h=false;var T=false;if(oThat.aFertWbData.some(function(e){return e.PackingFlag==="X"})){h=true}oThat.oView.getModel("oViewModel").setProperty("/fPackingWtColumn",h);if(oThat.aNonFertWbData.some(function(e){return e.PackingFlag==="X"})){T=true}oThat.oView.getModel("oViewModel").setProperty("/nPackingWtColumn",T);if(oThat.aFertWbData.length>0&&oThat.aNonFertWbData.length>0){e.FertWbData=oThat.aFertWbData;e.NonFertWbData=oThat.aNonFertWbData;oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet");var g=sap.ui.getCore().byId("WBIdLabel1");var d=sap.ui.getCore().byId("WBIdLabel2");if(g&&d){g.setVisible(false);d.setVisible(true)}var c=sap.ui.getCore().byId("id_ItemTableVBox");if(c){c.setVisible(false)}oThat.oView.getModel("oViewModel").setProperty("/vFertType",false);oThat.oView.getModel("oViewModel").setProperty("/nFertType",true);oThat.oView.getModel("oViewModel").setProperty("/vChallan",true);oThat.oView.getModel("oViewModel").setProperty("/vUnloadqty",true);oThat.oView.getModel("oViewModel").setProperty("/vRejectedqty",true);oThat.oView.getModel("oViewModel").setProperty("/vAcceptqty",true);oThat.oView.getModel("oViewModel").setProperty("/vUOM",true);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",true);oThat.oView.getModel("oViewModel").setProperty("/vDel",true);oThat.oView.getModel("oViewModel").setProperty("/vADD",true)}else{if(oThat.aFertWbData.length>0){oThat.fertType=false}else if(oThat.aNonFertWbData.length>0){oThat.fertType=true}oThat.oView.getModel("oViewModel").setProperty("/vFertType",true);oThat.oView.getModel("oViewModel").setProperty("/nFertType",false);var g=sap.ui.getCore().byId("WBIdLabel1");var d=sap.ui.getCore().byId("WBIdLabel2");if(g&&d){g.setVisible(true);d.setVisible(false)}if(oThat.fertType){oThat.oView.getModel("oViewModel").setProperty("/vChallan",true);oThat.oView.getModel("oViewModel").setProperty("/vUnloadqty",true);oThat.oView.getModel("oViewModel").setProperty("/vRejectedqty",true);oThat.oView.getModel("oViewModel").setProperty("/vAcceptqty",true);oThat.oView.getModel("oViewModel").setProperty("/vUOM",true);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",true);oThat.oView.getModel("oViewModel").setProperty("/vDel",true);oThat.oView.getModel("oViewModel").setProperty("/vADD",true)}else{oThat.oView.getModel("oViewModel").setProperty("/vChallan",false);oThat.oView.getModel("oViewModel").setProperty("/vUnloadqty",false);oThat.oView.getModel("oViewModel").setProperty("/vRejectedqty",false);oThat.oView.getModel("oViewModel").setProperty("/vAcceptqty",false);oThat.oView.getModel("oViewModel").setProperty("/vUOM",false);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",false);oThat.oView.getModel("oViewModel").setProperty("/vDel",false);oThat.oView.getModel("oViewModel").setProperty("/vADD",false)}e.UnloadConfNav.results=[];for(var u in e.WbItemNav.results){e.UnloadConfNav.results.push(e.WbItemNav.results[u])}if(e.WbItemNav.results.some(function(e){return e.PackingFlag==="X"})){oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",true)}else{oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",false)}oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet")}}else if(oThat.TableSelectedObject.QaMsgType==="Y"){var g=sap.ui.getCore().byId("WBIdLabel1");var d=sap.ui.getCore().byId("WBIdLabel2");if(g&&d){g.setVisible(true);d.setVisible(false)}sap.ui.getCore().byId("id_ItemTableVBox").setVisible(false);oThat.oView.getModel("oViewModel").setProperty("/nFertType",false);oThat.oView.getModel("oViewModel").setProperty("/vFertType",false);oThat.oView.getModel("oViewModel").setProperty("/zFertType",true);oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/vChallan",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true);oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/Box",false);oThat.oView.getModel("oViewModel").setProperty("/Uom",false);oThat.oView.getModel("oViewModel").setProperty("/QuantityEnabled",false);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",false);oThat.oView.getModel("oViewModel").setProperty("/Quantity",true);oThat.oView.getModel("oViewModel").setProperty("/Batch",true);oThat.oView.getModel("oViewModel").setProperty("/ContinuousScanner",true);oThat.oView.getModel("oViewModel").setProperty("/BatchStatus",true);for(var M of e.DelItemNav.results){for(var f of e.WbItemNav.results){if(f.Vbeln===M.Vbeln&&f.Posnr===M.Posnr){f.Menge=M.Brgew;f.Maktx=M.Arktx;f.Uom=M.Uom}}}e.UnloadConfNav.results=[];for(var u in e.WbItemNav.results){e.WbItemNav.results[u].BatchStatus="sap-icon://decline";e.UnloadConfNav.results.push(e.WbItemNav.results[u])}oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet")}else{var g=sap.ui.getCore().byId("WBIdLabel1");var d=sap.ui.getCore().byId("WBIdLabel2");if(g&&d){g.setVisible(true);d.setVisible(false)}oThat.oView.getModel("oViewModel").setProperty("/zFertType",false);oThat.oView.getModel("oViewModel").setProperty("/vFertType",false);var c=sap.ui.getCore().byId("id_ItemTableVBox");if(c){c.setVisible(true)}oThat.oView.getModel("oViewModel").setProperty("/nFertType",false);oThat.oView.setModel(new o(e),"ITEM");oThat.oView.setModel(new o(e.WbHeaderNav),"ITEMDet");if(e.UnloadConfNav.results.length>0){if(e.UnloadConfNav.results[0].FLAG==="X"){oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",true);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",false)}else{oThat.oView.getModel("oViewModel").setProperty("/NotaProperty",false);oThat.oView.getModel("oViewModel").setProperty("/CMSProperty",true)}if(e.EvOrigin==="B"&&e.WbHeaderNav.results[0].Wtype==="TRIP"){oThat.oView.getModel("oViewModel").setProperty("/REMARKS",true)}else{oThat.oView.getModel("oViewModel").setProperty("/REMARKS",false)}if(e.UnloadConfNav.results.some(function(e){return e.PackingFlag==="X"})){oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",true)}else{oThat.oView.getModel("oViewModel").setProperty("/vPackingWtColumn",false)}if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wtype=="PROCURE"&&oThat.oView.getModel("ITEM").getData().EvOrigin==="X"&&oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Ebeln==""){oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/Box",true);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",true)}else if(oThat.oView.getModel("ITEM").getData().EvOrigin==="E"){oThat.oView.getModel("oViewModel").setProperty("/Origin",true);oThat.oView.getModel("oViewModel").setProperty("/Box",true);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",false)}else{oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/Box",false);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",false);oThat.oView.getModel("oViewModel").setProperty("/vUOM",true);oThat.oView.getModel("oViewModel").setProperty("/vRemarks",true)}for(var s in e.UnloadConfNav.results){e.UnloadConfNav.results[s].QaMsgType=oThat.TableSelectedObject.QaMsgType}if(oThat.oView.getModel("ITEM").getData().EvOrigin==="K"||oThat.oView.getModel("ITEM").getData().EvOrigin==="M"){oThat.oView.getModel("oViewModel").setProperty("/Quantity",true);oThat.oView.getModel("oViewModel").setProperty("/Uom",true);oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Uom=e.WbItemNav.results[0].Uom;v=e.WbItemNav.results[0].Uom;var n="";oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Quantity=n;oThat.oView.getModel("ITEM").refresh()}else{oThat.oView.getModel("oViewModel").setProperty("/Quantity",false);oThat.oView.getModel("oViewModel").setProperty("/Uom",false)}oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Check=false;oThat.oView.getModel("ITEM").refresh();if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wtype==="PROCURE"&&oThat.oView.getModel("ITEM").getData().EvOrigin==="X"&&oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Ebeln==""){var p=[new r("OriginGQ",sap.ui.model.FilterOperator.EQ,"X"),new r("IvWerks",sap.ui.model.FilterOperator.EQ,e.IvWerks)];oThat.BusyDialog.open();oThat.oModel.read("/F4ParametersSet",{filters:p,urlParameters:{$expand:"F4OriginSetNav"},success:function(e,t){var a=new o;var r=e.results[0].F4OriginSetNav.results;if(r.length>0){a.setData(r);oThat.oView.setModel(a,"OriginComboModel");oThat.BusyDialog.close()}}.bind(this),error:function(e){oThat.BusyDialog.close();t.error(e.responseText)}});oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",true);oThat.oView.getModel("oViewModel").setProperty("/Box",true)}else if(oThat.oView.getModel("ITEM").getData().EvOrigin==="E"){oThat.oView.getModel("oViewModel").setProperty("/Origin",true);oThat.oView.getModel("oViewModel").setProperty("/Box",true);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",false)}else{oThat.oView.getModel("oViewModel").setProperty("/Origin",false);oThat.oView.getModel("oViewModel").setProperty("/Box",false);oThat.oView.getModel("oViewModel").setProperty("/OriginCombo",false)}}oThat.oView.getModel("ITEM").refresh(true)}}}else if(oThat.Service==="REPRINT"){oThat.oView.setModel(new o(e),"oStatusModel");oThat.oView.getModel("oStatusModel").refresh(true);if(e.StatusUpdateNav.results.length!=0){oThat.VehicleNo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.TruckNo",oThat);oThat.oView.addDependent(oThat.VehicleNo);oThat.VehicleNo.open()}else{l.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMSg16"))}}else if(oThat.Service==="SLOC"){oThat.oView.setModel(new o(e),"SLOC");oThat.oView.getModel("SLOC").refresh(true)}else if(oThat.Service==="UOM"){oThat.oView.setModel(new o(e.results[0].F4UomNav.results),"UOM");oThat.oView.getModel("UOM").refresh(true)}else if(oThat.Service==="SUBMIT"){if(e.PostReturnNav.results.length!=0){var w=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(w!=0){t.error(w[0].Message)}var m=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(m!=0){if(oThat.oView.getModel("oViewModel").getData().NotaProperty===true){oThat.onDmsPost(e.PostWbHeaderNav.results[0].Wbid)}if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"){if(!oThat._SignatureDialog){oThat._SignatureDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Signature",oThat);oThat.oView.addDependent(oThat._SignatureDialog)}oThat._SignatureDialog.open();var V=document.querySelector("#__custom0 canvas");var I=document.querySelector("#__custom1 canvas");var C=V.getContext("2d");var b=I.getContext("2d");var y=new Image;oThat.signaturepad0=new SignaturePad(V);oThat.signaturepad2=new SignaturePad(I);if(oThat.signaturepad0!==undefined||oThat.signaturepad2!==undefined){y.onload=function(){C.drawImage(this.datas,0,0);b.drawImage(this.datas,0,0)}}oThat._SignatureDialog.close()}oThat.UnloadFrag.close();t.show(m[0].Message,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(a){if(oThat.TableSelectedObject){var i=oThat.oView.getModel("oUnloadModDel").getData();for(var l=0;l<i.QualWbidNav.results.length;l++){if(i.QualWbidNav.results[l].Wbid==oThat.TableSelectedObject.Wbid&&i.QualWbidNav.results[l].Batch==oThat.TableSelectedObject.Batch&&i.QualWbidNav.results[l].Maktx==oThat.TableSelectedObject.Maktx){i.QualWbidNav.results.splice(l,1);break}}oThat.oView.getModel("oUnloadModDel").refresh()}var n=new o(i);oThat.oView.setModel(n,"oUnloadModel");oThat.oView.getModel("oUnloadModel").refresh();oThat.getView().byId("id_SearchField").setValue("");if(a==="OK"){if(oThat.oView.getModel("ITEM").getData().EvOrigin=="F"){t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){var a=e.PostWbitemNav.results[0].Wbid;var o=oThat.oModel.sServiceUrl;var r=oThat.TableSelectedObject.Batch;var i="/DownloadSet(IvWbid='"+a+"',IvPrint='X',GateEntry='X',IvBatch='"+r+"')/$value";var l=o+i;if(sap.ui.Device.system.desktop){oThat.initiatePdfDialog();var n="<div><iframe src="+l+" width='100%' height='520'></iframe></div>";oThat.oImageDialog.getContent()[0].setContent(n);oThat.oImageDialog.addStyleClass("sapUiSizeCompact");oThat.oImageDialog.open()}else{window.open(l)}}}})}if(oThat.oView.getModel("ITEM").getData().EvOrigin=="G"||oThat.oView.getModel("ITEM").getData().EvOrigin=="I"||oThat.oView.getModel("ITEM").getData().EvOrigin=="K"||oThat.oView.getModel("ITEM").getData().EvOrigin=="M"){var s=oThat.oView.getModel("oUnloadModel").getData().QualWbidNav.results,g=false;for(var l=0;l<s.length;l++){if(e.PostWbitemNav.results[0].Wbid==s[l].Wbid){g=true;break}}if(!g){t.show(oThat.oView.getModel("i18n").getResourceBundle().getText("Msg2"),{icon:t.Icon.INFORMATION,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[t.Action.YES,t.Action.NO],onClose:function(t){if(t==="YES"){var a=e.PostWbitemNav.results[0].Wbid;var o=oThat.oModel.sServiceUrl;var r="";var i="/DownloadSet(IvWbid='"+a+"',IvPrint='X',GateEntry='X',IvBatch='"+r+"')/$value";var l=o+i;if(sap.ui.Device.system.desktop){oThat.initiatePdfDialog();var n="<div><iframe src="+l+" width='100%' height='520'></iframe></div>";oThat.oImageDialog.getContent()[0].setContent(n);oThat.oImageDialog.addStyleClass("sapUiSizeCompact");oThat.oImageDialog.open()}else{window.open(l)}}}})}}if(oThat.oView.getModel("oViewModel").getData().NotaProperty===true){var d=e.PostWbitemNav.results[0].Wbid;var u=e.PostWbitemNav.results[0].Item;oThat.getOwnerComponent().getModel().read("/UnloadTxtSet",{filters:[new r("IvItem",sap.ui.model.FilterOperator.EQ,u),new r("IvWbid",sap.ui.model.FilterOperator.EQ,d)],urlParameters:{$expand:"UnloadTxtNav"},success:function(e,t){sap.ui.core.BusyIndicator.hide();var a=e.results[0].IvItem.split("0")[4];var o=e.results[0].UnloadTxtNav.results[0].ExText.replace("$$",a);var r=e.results[0].UnloadTxtNav.results[0].ExName;var i=new Blob([o],{type:"application/text"});var l=document.createElement("a"),n=URL.createObjectURL(i);l.href=n;l.download=r;document.body.appendChild(l);l.click();setTimeout(function(){document.body.removeChild(l);window.URL.revokeObjectURL(n)},0)},error:function(){sap.ui.core.BusyIndicator.hide();var e=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.error(e)}})}oThat._onRouteMatched()}}})}}}else if(oThat.Service==="GETCHAR"){var S=false;if(e.GetReturnNav.results.length>0){if(e.GetReturnNav.results[0].Type=="E"){S=true}}if(!S){oThat.oView.getModel("BATCH").getData().BatchCharsNav=e.BatchCharsNav;oThat.oView.getModel("BATCH").getData().BatchValuesNav=e.BatchValuesNav;e.CMS_NO=this.cmsData;oThat.oView.getModel("BATCH").refresh(true);oThat.onCreateChracteritis()}else{t.error(e.GetReturnNav.results[0].Message)}}else if(oThat.Service=="SETCHAR"){if(e.PostReturnNav.results.length!=0){var w=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(w!=0){var D;for(var P=0;P<w.length;P++){D=w[P].Message+"\n"}t.error(D)}var m=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(m!=0){var D;for(var P=0;P<m.length;P++){D=m[P].Message+"\n"}t.show(D,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(){oThat.Batch.destroy();if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"||oThat.oView.getModel("ITEM").getData().EvWhSign=="X"){if(!oThat._SignatureDialog){oThat._SignatureDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Signature",oThat);oThat.oView.addDependent(oThat._SignatureDialog)}oThat._SignatureDialog.open();var e=document.querySelector("#__custom0 canvas");var t=document.querySelector("#__custom1 canvas");oThat.signaturepad0=new SignaturePad(e);if(document.querySelector("#__custom1")){document.querySelector("#__custom1").style.display="none"}}else if(oThat.oView.getModel("ITEM").getData().EvWhSign!="X"){oThat.SubmitItem()}}})}}else{oThat.Batch.destroy();if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"||oThat.oView.getModel("ITEM").getData().EvWhSign=="X"){if(!oThat._SignatureDialog){oThat._SignatureDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Signature",oThat);oThat.oView.addDependent(oThat._SignatureDialog)}oThat._SignatureDialog.open();var E=document.querySelector("#__custom0 canvas");var V=document.querySelector("#__custom1 canvas");oThat.signaturepad0=new SignaturePad(E);if(document.querySelector("#__custom1")){document.querySelector("#__custom1").style.display="none"}}else if(oThat.oView.getModel("ITEM").getData().EvWhSign!="X"){oThat.SubmitItem()}}}else if(oThat.Service==="POITEMS"){var N=[];var B=e.PoItemNav.results;var W=oThat.oView.getModel("ITEM").getData().UnloadConfNav.results;for(var F in B){var x=true;for(var P in W){if(B[F].Ebeln===W[P].Ebeln&&B[F].Matnr.replace(/^0+/,"")===W[P].Matnr.replace(/^0+/,"")){x=false}}if(x){N.push(B[F])}}e.PoItemNav.results=N;oThat.oView.setModel(new o(e),"POITEMS");oThat.oView.getModel("POITEMS").updateBindings(true)}else if(oThat.Service==="BATCH"){var U={BatchCharsNav:[],BatchValuesNav:[],CMS_NO:""};oThat.oView.setModel(new o(e),"BATCH");oThat.oView.getModel("BATCH").refresh(true);if(e.QualCharNav.results[0].Charg!=""){oThat.oView.getModel("Head").getData().Charg=e.QualCharNav.results[0].Charg;oThat.oView.getModel("Head").refresh();oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Batch",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.setEscapeHandler(oThat.onEscapeBatch);oThat.Batch.open();oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumber").setEnabled(false)}sap.ui.getCore().byId("id_BtnRejChar").setVisible(false)}else{oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Batch",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.setEscapeHandler(oThat.onEscapeBatch);oThat.Batch.open();if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumber").setEnabled(false)}sap.ui.getCore().byId("id_BtnRejChar").setVisible(false);sap.ui.getCore().byId("id_BatchNumber").setEnabled(true)}}else if(oThat.Service==="UpdatePODETAILS"){if(e.PostReturnNav.results.length!=0){var w=e.PostReturnNav.results.filter(function(e){if(e.Type=="E"){return e}});if(w!=0){t.error(w[0].Message)}var m=e.PostReturnNav.results.filter(function(e){if(e.Type=="S"){return e}});if(m!=0){t.show(m[0].Message,{icon:t.Icon.SUCCESS,title:oThat.oView.getModel("i18n").getResourceBundle().getText("Title19"),actions:[t.Action.OK],onClose:function(t){if(!oThat.delItem){oThat.oView.getModel("ITEM").getData().UnloadConfNav.results=[];oThat.oView.getModel("ITEM").getData().NonFertWbData=[];for(var a in e.PostWbitemNav.results){if(oThat.aNonFertWbData.length>0){oThat.oView.getModel("ITEM").getData().NonFertWbData.push(e.PostWbitemNav.results[a])}else{oThat.oView.getModel("ITEM").getData().UnloadConfNav.results.push(e.PostWbitemNav.results[a])}}oThat.oView.getModel("ITEM").updateBindings(true);oThat.onClosePOItem()}else{if(oThat.aNonFertWbData.length>0){var o=oThat.oView.getModel("ITEM").getData().NonFertWbData}else{var o=oThat.oView.getModel("ITEM").getData().UnloadConfNav.results}for(var r in o){if(oThat.Obj.Ebeln===o[r].Ebeln&&oThat.Obj.Matnr===o[r].Matnr&&oThat.Obj.Matnr===o[r].Matnr){o.splice(r,1)}}oThat.oView.getModel("ITEM").refresh(true)}}})}}}},onClose:function(){var e=this;e.Batch.destroy()},onHandleChangeCombo:function(e){var t=e.getSource(),a=t.getSelectedKey(),o=t.getValue();if(!a&&o){t.setValueState("Error");var r=t.getItems().some(function(e){return e.getText().toLowerCase()===o.toLowerCase()});if(!r){t.setValue("")}}else{t.setValueState("None")}},initiatePdfDialog:function(){oThat.oImageDialog=new sap.m.Dialog({title:"PDF",contentWidth:"100%",contentHeight:"",content:new sap.ui.core.HTML({}),beginButton:new sap.m.Button({text:"Close",class:"sapUiSizeCompact",press:function(){oThat.oImageDialog.close();oThat.SelectedLots=""}})})},myErrorHandler:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)},fnTimer:function(e){setInterval(function(){var e="Date ";e=e+((new Date).getDate().toString().length>1?(new Date).getDate().toString():"0"+(new Date).getDate().toString())+"/";e=e+(((new Date).getMonth()+1).toString().length>1?(new Date).getMonth()+1:"0"+((new Date).getMonth()+1).toString())+"/";e=e+(new Date).getFullYear()+"   ";e=e+"Time  ";e=e+((new Date).getHours().toString().length>1?(new Date).getHours().toString():"0"+(new Date).getHours().toString())+":";e=e+((new Date).getMinutes().toString().length>1?(new Date).getMinutes():"0"+(new Date).getMinutes().toString())+":";e=e+((new Date).getSeconds().toString().length>1?(new Date).getSeconds():"0"+(new Date).getSeconds().toString());sap.ui.getCore().byId("id_time").setText(e)},1e3)},onPressStartUnload2901:function(){if(oThat.getView().getModel("ITEM").getData().UnloadConfNav.results[0].Check===true){var e={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",Unload_Start:"X",GateExit:"",Inbound:"X",Outbound:"",IvWboj:oThat.EvWtype,PostReturnNav:[],PostWbHeaderNav:[{Wbid:oThat.Wbid}],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};e.d.PostWbitemNav=oThat.getView().getModel("ITEM").getData().WbItemNav.results;oThat.oModel.create("/PostHeadersSet",e,{success:function(e,a){oThat.UnloadFrag2901.close();oThat.BusyDialog.close();if(e.PostReturnNav.results.length>0){t.success(e.PostReturnNav.results[0].Message)}oThat._onRouteMatched()},error:function(e){oThat.BusyDialog.close();oThat.UnloadFrag2901.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg20"))}},onPressLoadItem:function(e){if(oThat.oView.getModel("ITEM")){oThat.oView.getModel("ITEM").setData([]);oThat.oView.getModel("ITEM").refresh()}oThat.aFertWbData=[];oThat.aNonFertWbData=[];oThat.PoDeleteItems=[];oThat.oTableSelctedItem=e.getSource().getBindingContextPath();oThat.TableSelectedObject=e.getSource().getBindingContext("oUnloadModel").getObject();var a=oThat.oView.getModel("oUnloadModel").getObject(e.getSource().getBindingContextPath());oThat.oView.getModel("oViewModel").setProperty("/vFertType",false);var o;if(oThat.TableSelectedObject.QaMsgType=="H"||oThat.TableSelectedObject.QaMsgType=="1"||oThat.TableSelectedObject.QaMsgType=="Y"){o="00000"}else{o=a.Item}var r={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:a.Vbeln,IvPo:a.Ebeln,IvWbid:a.Wbid,IvItem:o,IvWerks:a.Werks,UnloadConfNav:[],WbItemNav:[],WbHeaderNav:[],WsItemNav:[],GetReturnNav:[]}};oThat.oModel.create("/GetHeadersSet",r,{success:function(e,t){var r="";if(a){r=a.Unload_Start}if(e.EvOrigin==="B"&&e.WbHeaderNav.results[0].Wtype==="TRIP"&&r!=="X"){if(!oThat.UnloadFrag2901){oThat.UnloadFrag2901=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Unload_Item2901",oThat);oThat.oView.addDependent(oThat.UnloadFrag2901)}oThat.UnloadFrag2901.open();oThat.Wbid=a.Wbid;var i={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:a.Vbeln,IvPo:a.Ebeln,IvWbid:a.Wbid,IvItem:o,IvWerks:a.Werks,UnloadConfNav:[],WbHeaderNav:[],WbItemNav:[],WsItemNav:[],GetReturnNav:[],DelItemNav:[]}};oThat.Service="ITEM";oThat.onCallService(oThat.Service,i);oThat.fnTimer()}else{if(!oThat.UnloadFrag){oThat.UnloadFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Unload_Item",oThat);oThat.oView.addDependent(oThat.UnloadFrag)}oThat.UnloadFrag.open();oThat.Wbid=a.Wbid;var l={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:a.Vbeln,IvPo:a.Ebeln,IvWbid:a.Wbid,IvItem:o,IvWerks:a.Werks,UnloadConfNav:[],WbHeaderNav:[],WbItemNav:[],WsItemNav:[],GetReturnNav:[],PoItemNav:[],DelItemNav:[]}};oThat.Service="ITEM";oThat.onCallService(oThat.Service,l)}},error:function(e){t.error(JSON.parse(e.responseText).error.message.value)}})},onValueHelpPress:function(e){oThat.vPath=e.getSource().getParent()?.getBindingContextPath();var t=oThat.oView.getModel("ITEM").getObject(e.getSource().getParent().getBindingContextPath());oThat.StorageFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.StorageLoc",this);oThat.oView.addDependent(oThat.StorageFrag);oThat.StorageFrag.open();var a=[new r("Matnr",sap.ui.model.FilterOperator.EQ,t.Matnr),new r("Werks",sap.ui.model.FilterOperator.EQ,t.Werks)];oThat.Service="SLOC";oThat.onCallService(oThat.Service,a)},onValueHelpConfirmPlant:function(e){var t=e.getParameter("selectedItem").getTitle();var a=oThat.oView.getModel("ITEM").getObject(oThat.vPath);a.Lgort=t;oThat.oView.getModel("ITEM").refresh(true);oThat.StorageFrag.destroy()},onValueHelpSearchLoc:function(e){var t=e.getParameter("value");var a;a=new sap.ui.model.Filter([new r("Lgort",sap.ui.model.FilterOperator.Contains,t),new r("Lgobe",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var i=e.getSource().getBinding("items");i.filter([o])},onValueHelpSearch:function(e){if(oThat.vId.indexOf("id_InVehicleNo")!=-1){var t=e.getSource()._sSearchFieldValue;if(t&&t.length>0){var a=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Lifnr",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter("Vehtyp",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter([a,o,i,l])}var s=e.getSource().getBinding("items");s.filter(n)}else{var g=e.getParameter("value");var d;d=new sap.ui.model.Filter([new r("Lgort",sap.ui.model.FilterOperator.Contains,g),new r("Lgobe",sap.ui.model.FilterOperator.Contains,g)]);var o=new sap.ui.model.Filter(d,false);var u=e.getSource().getBinding("items");u.filter([o])}},onValueHelpConfirm:function(e){var t=e.getParameter("selectedItem");var a=e.getParameter("selectedItem").getBindingContext("oStatusModel").getObject();sap.ui.getCore().byId("id_InVehicleNo").setValue(a.Vehno);sap.ui.getCore().byId("id_InWbid").setValue(a.Wbid)},onSignaturePress:function(e){if(sap.ui.getCore().byId("id_ItemTable").getSelectedItems().length!=0){var a=false;M=false;for(var o=0;o<sap.ui.getCore().byId("id_ItemTable").getSelectedContextPaths().length;o++){var r=sap.ui.getCore().byId("id_ItemTable").getSelectedContextPaths()[o];var i=oThat.oView.getModel("ITEM").getObject(r);if(oThat.oView.getModel("ITEM").getData().EvOrigin=="B"&&oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wtype=="TRIP"){a=false}else{var l="";if(i.Lgort===""){a=true;l=oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg12")+"\n"}if(oThat.oView.getModel("ITEM").getData().EvOrigin==="E"){if(i.Token===""){a=true;l=l+oThat.oView.getModel("i18n").getResourceBundle().getText("EnterOrigin")+"\n"}if(i.DriverId===""){a=true;l=l+oThat.oView.getModel("i18n").getResourceBundle().getText("EnterBox")}}if(oThat.oView.getModel("ITEM").getData().EvOrigin==="K"){oThat.fnvalidatePoQuan(i,l)}}if(oThat.oView.getModel("ITEM").getData().EvOrigin!=="K"){if(a===true){t.error(l)}else{if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"||oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"){oThat.onBatchUpdate()}else if(oThat.oView.getModel("ITEM").getData().EvWhSign!="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd!="X"){oThat.SubmitItem()}else if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd!="X"){if(!oThat._SignatureDialog){oThat._SignatureDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Signature",oThat);oThat.oView.addDependent(oThat._SignatureDialog)}oThat._SignatureDialog.open();var n=document.querySelector("#__custom0 canvas");var s=document.querySelector("#__custom1 canvas");oThat.signaturepad0=new SignaturePad(n);if(document.querySelector("#__custom1")){document.querySelector("#__custom1").style.display="none"}}}}}}else{t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg10"))}},_SignatureCancel:function(){var e=document.querySelector("#__custom0 canvas");var t=document.querySelector("#__custom1 canvas");if(e){var a=e.getContext("2d")}if(e){var o=e.getContext("2d")}if(a){var r=new Image;oThat.signaturepad1=new SignaturePad(e);if(oThat.signaturepad1){r.onload=function(){a.drawImage(this.datas,0,0);o.drawImage(this.datas,0,0)}}}},_SignatureSave:function(){if(oThat.signaturepad0.isEmpty()){var e=oThat.oView.getModel("i18n").getResourceBundle().getText("WHSignError");t.information(e)}else{oThat.oView.getModel("oUnloadModel").refresh();if(sap.ui.getCore().byId("id_ItemTable").getSelectedItems().length!=0){var a={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvWboj:oThat.EvWtype,PostReturnNav:[],PostWbHeaderNav:[{Wbid:oThat.Wbid}],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};var o=sap.ui.getCore().byId("id_ItemTable");$.each(sap.ui.getCore().byId("id_ItemTable").getSelectedItems(),function(e,t,r){var i=o.getSelectedContextPaths()[e];var l=oThat.oView.getModel("ITEM").getObject(i);if(oThat.EvWtype==="WB"){for(var n=0;n<oThat.oView.getModel("ITEM").getData().WbItemNav.results.length;n++){delete oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].__metadata;if(l.Wbid==oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Wbid&&l.Item==oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Item){oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Ntgew=l.Quantity;oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Uom=l.Uom;oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Lgort=l.Lgort;if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("Head")){oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Batch=oThat.oView.getModel("Head").getData().Charg}oThat.oView.getModel("ITEM").refresh();break}}a.d.PostWbitemNav=oThat.oView.getModel("ITEM").getData().WbItemNav.results}else{for(var n=0;n<oThat.oView.getModel("ITEM").getData().WsItemNav.results.length;n++){delete oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].__metadata;if(l.Wbid==oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Wbid&&Number(l.Item)==Number(oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Item)){oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Lgort=l.Lgort;if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("Head")){oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Batch=oThat.oView.getModel("Head").getData().Charg}oThat.oView.getModel("ITEM").refresh();break}}a.d.PostWsItemNav=oThat.oView.getModel("ITEM").getData().WsItemNav.results}});if(oThat.signaturepad0.toDataURL("image/png")){a.d.PostDmsNav.push({Filename:oThat.signaturepad0.toDataURL("image/png").split(",")[1],Fname:oThat.oView.getModel("i18n").getResourceBundle().getText("Text12"),Ftype:"image/png"})}else{a.d.PostDmsNav.push({Filename:"No File",Fname:oThat.oView.getModel("i18n").getResourceBundle().getText("Text12"),Ftype:"image/png"})}a.d.IvRemarks=this.REASON;oThat.Service="SUBMIT";oThat.onCallService(oThat.Service,a)}}},onClickBack:function(){oThat.UnloadFrag.close()},onClickBack2901:function(){this.UnloadFrag2901.close()},fnPDFViewClose:function(){oThat.PDFDialog.close()},SubmitItem:function(){if(sap.ui.getCore().byId("id_ItemTable").getSelectedItems().length!=0){var e={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvWboj:oThat.EvWtype,PostReturnNav:[],PostWbHeaderNav:[{Wbid:oThat.Wbid}],PostWbitemNav:[],PostWsItemNav:[],PostDmsNav:[]}};var t=sap.ui.getCore().byId("id_ItemTable");$.each(sap.ui.getCore().byId("id_ItemTable").getSelectedItems(),function(a,o,r){var i=t.getSelectedContextPaths()[a];var l=oThat.oView.getModel("ITEM").getObject(i);if(oThat.EvWtype==="WB"){for(var n=0;n<oThat.oView.getModel("ITEM").getData().WbItemNav.results.length;n++){delete oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].__metadata;if(l.Wbid==oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Wbid&&l.Item==oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Item){oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Lgort=l.Lgort;if(oThat.oView.getModel("ITEM").getData().UnloadConfNav?.results?.[n]?.PackagingDetails){var s=oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[n];var g=oThat.oView.getModel("ITEM").getData().WbItemNav.results[n];if(s?.PackagingDetails?.length>0){g.Pkwgt=s.Weight||"0.000";g.Pmat1=s.PackagingDetails[0]?.Type||"";g.Pmatuom1=s.PackagingDetails[0]?.Uom||"";g.Pmatno1=s.PackagingDetails[0]?.Bags||"0.000";g.Pmatqty1=s.PackagingDetails[0]?.Gross||"0.000";g.Trwgt1=s.PackagingDetails[0]?.Tare||"0.000"}if(s?.PackagingDetails?.length>1){g.Pmat2=s.PackagingDetails[1]?.Type||"";g.Pmatuom2=s.PackagingDetails[1]?.Uom||"";g.Pmatno2=s.PackagingDetails[1]?.Bags||"0.000";g.Pmatqty2=s.PackagingDetails[1]?.Gross||"0.000";g.Trwgt2=s.PackagingDetails[1]?.Tare||"0.000"}}if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("Head")){oThat.oView.getModel("ITEM").getData().WbItemNav.results[n].Batch=oThat.oView.getModel("Head").getData().Charg}oThat.oView.getModel("ITEM").refresh();break}}e.d.PostWbitemNav=oThat.oView.getModel("ITEM").getData().WbItemNav.results}else{for(var n=0;n<oThat.oView.getModel("ITEM").getData().WsItemNav.results.length;n++){delete oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].__metadata;if(l.Wbid==oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Wbid&&Number(l.Item)==Number(oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Item)){oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Lgort=l.Lgort;if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("Head")){oThat.oView.getModel("ITEM").getData().WsItemNav.results[n].Batch=oThat.oView.getModel("Head").getData().Charg}oThat.oView.getModel("ITEM").refresh();break}}e.d.PostWsItemNav=oThat.oView.getModel("ITEM").getData().WsItemNav.results}});oThat.Service="SUBMIT";oThat.onCallService(oThat.Service,e)}},onBatchUpdate:function(){if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Charg!=""){oThat.oView.setModel(new o(oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0]),"Head");oThat.oView.getModel("Head").refresh();var e={BatchCharsNav:[],BatchValuesNav:[],CMS_NO:""};oThat.oView.setModel(new o(e),"BATCH");oThat.oView.getModel("BATCH").refresh(true);oThat.Batch=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Batch",oThat);oThat.oView.addDependent(oThat.Batch);oThat.Batch.setEscapeHandler(oThat.onEscapeBatch);oThat.Batch.open();if(oThat.oView.getModel("ITEM").getData().EvOrigin==="G"||oThat.oView.getModel("ITEM").getData().EvOrigin==="F"||oThat.oView.getModel("ITEM").getData().EvOrigin==="I"){oThat.onPressCharacteristics();sap.ui.getCore().byId("id_BtnChar").setVisible(false)}else{sap.ui.getCore().byId("id_BtnChar").setVisible(true)}if(oThat.oView.getModel("Head").getData().Charg!==""&&oThat.oView.getModel("Head").getData().Charg!==undefined){sap.ui.getCore().byId("id_BatchNumber").setEnabled(false)}sap.ui.getCore().byId("id_BtnRejChar").setVisible(false)}else if(oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"&&oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Charg==""){oThat.oView.setModel(new o(oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0]),"Head");oThat.oView.getModel("Head").refresh();var t={d:{GateEntry:"",VehAssign:"",PreQual:"X",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:oThat.Wbid,IvWerks:"",QualWbidNav:[],PreQualNav:[],QualCharNav:[],GetReturnNav:[]}};t.d.QualCharNav.push({Wbid:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Wbid,Item:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Item,Matnr:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Matnr,Werks:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Werks,Ebeln:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Ebeln,Vbeln:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Vbeln,Ebelp:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Ebelp,Posnr:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Posnr,Matxt:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Matxt});oThat.Service="BATCH";oThat.onCallService(oThat.Service,t)}},onPressCharacteristics:function(e){if(oThat.oView.getModel("Head").getData().Charg===""){t.error(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg4"))}else{sap.ui.getCore().byId("id_BatchNumber").setEnabled(false);var a={MaterialNav:[],BatchCharsNav:[],BatchValuesNav:[],GetReturnNav:[],CMS_NO:oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].UNSEZ};var o={Matnr:oThat.oView.getModel("Head").getData().Matnr,Werks:oThat.oView.getModel("Head").getData().Werks,Lgort:"",Charg:oThat.oView.getModel("Head").getData().Charg.toUpperCase(),Msgid:"",Msgno:""};a.MaterialNav.push(o);oThat.Service="GETCHAR";oThat.onCallService(oThat.Service,a)}},onCreateChracteritis:function(){var e=this;var t=sap.ui.getCore().byId("id_PanelChar");t.destroyContent();if(oThat.oView.getModel("BATCH").getData().BatchCharsNav!=null&&oThat.oView.getModel("BATCH").getData().BatchValuesNav!=null){sap.ui.getCore().byId("id_BtnCharSave").setVisible(true);sap.ui.getCore().byId("id_BtnCharSave").setText(oThat.oView.getModel("i18n").getResourceBundle().getText("Label14"));var a=oThat.oView.getModel("BATCH").getData().BatchCharsNav.results;var o=0;var r=false,i=false;var n=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12"}).addStyleClass("sapUiSizeCompact Cl_Grid_Width sapUiSmallMarginTop");for(var s=0;s<a.length;s++){var g=[];for(var d=0;d<oThat.oView.getModel("BATCH").getData().BatchValuesNav.results.length;d++){if(a[s].NameChar==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].NameChar&&a[s].Werks==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].Werks&&a[s].Matnr==oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d].Matnr){g.push(oThat.oView.getModel("BATCH").getData().BatchValuesNav.results[d])}}var u="",h="",T="";var c=a[s].DescrChar;var v=false;if(g.length>0){if(g[0].ValRelatn=="1"){v=true;var M={CharValue:"",DescrCval:"",Lgort:"",Matnr:"",NameChar:"",NumValFm:"",NumValTo:"",ValRelatn:"1",Werks:""};g.splice(0,0,M)}}if(a[s].SingleValue&&g.length>0&&v){i=false;var f=new sap.m.Label({text:c+" :",tooltip:a[s].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");T=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");if(!a[s].Batchindex){a[s].Batchindex=0}a[s].Batchindex=parseInt(a[s].Batchindex);h=new sap.m.Select({forceSelection:false,width:"10rem"}).addStyleClass("sapUiTinyMarginTop");if(g[1].DescrCval!=""){var p=new sap.ui.core.Item({key:"{Data>CharValue}",text:"{Data>DescrCval}"})}else{var p=new sap.ui.core.Item({key:"{Data>NumValFm}",text:"{Data>NumValFm}"})}var w=new sap.ui.model.json.JSONModel;var m={Select:g};w.setData(m);w.setSizeLimit(m.Select.length);h.bindAggregation("items","Data>/Select",p);h.setModel(w,"Data");if(g[1].DescrCval!==""){h.setSelectedKey(m.Select[a[s].Batchindex].CharValue)}else{h.setSelectedKey(m.Select[a[s].Batchindex].NumValFm)}if(a[s].ValueChar!==""){for(var V=0;V<m.Select.length;V++){if(a[s].ValueChar===m.Select[V].DescrCval){h.setSelectedKey(m.Select[V].CharValue)}}}if(m.Select.length<3){if(a[s].NameChar==="CFCERTIFICATE"){for(var I=0;I<m.Select.length;I++){if(a[s].NameChar===m.Select[I].NameChar){h.setSelectedKey(m.Select[I].CharValue)}}}if(a[s].NameChar==="GRUPO"){for(var C=0;C<m.Select.length;C++){if(a[s].NameChar===m.Select[C].NameChar){h.setSelectedKey(m.Select[C].CharValue)}}}}T.addContent(f);T.addContent(h);n.addContent(T);u=f.getText().split(" :")[0].toLocaleUpperCase()}else if(a[s].SingleValue){i=false;r=false;var b=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var f=new sap.m.Label({text:c+" :",tooltip:a[s].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");b.addContent(f);var y="";var S="";if(a[s].DataType=="NUM"){y="Number"}else{y="Text"}S=a[s].NumberDigits;var D=new sap.m.Input({width:6+"rem",type:y,maxLength:S,value:a[s].ValueChar,liveChange:function(e){if(e.getSource().getParent().getContent().length=="3"){if(e.getSource().getParent().getContent()[2].getText().split(" ").length=="4"){var t=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[1]);var a=Number(e.getSource().getParent().getContent()[2].getText().split(" ")[3]);var o=e.getSource().getType();var r=Number(e.getSource().getValue());if(r<t||r>a){if(r>a){e.getSource().setValue("")}e.getSource().setValueStateText(e.getSource().getParent().getContent()[2].getText());e.getSource().setValueState("Error")}else{e.getSource().setValueState("None")}}else{e.getSource().setValueState("None")}}else{var o=e.getSource().getType();var i="";var r="";if(o=="Number"){r=e.getSource().getValue();var l=e.getSource().getMaxLength();if(r.length>l){var n=r.substring(0,l);e.getSource().setValue("");e.getSource().setValue(n)}}e.getSource().setValueState("None")}}}).addStyleClass("");b.addContent(D);if(g.length>0){var P=oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_TextRange")+" "+Number(g[0].NumValFm)+" - "+Number(g[0].NumValTo);var E=new sap.m.Text({text:P}).addStyleClass("sapUiTinyMarginBegin");b.addContent(E)}n.addContent(b)}else if(!a[s].SingleValue&&g.length>0){var N;r=false;if(N==a[s].DescrChar){i=true}else{i=false}if(i==false){var B=0;var W=new sap.m.Panel({}).addStyleClass("Cl_Batch_Panel");var f=new sap.m.Label({text:c+" :",tooltip:a[s].DescrChar,width:"12rem",wrapping:true,design:"Bold"}).addStyleClass("lblAlignRes");W.addContent(f);var F=new sap.m.MultiComboBox({width:"6rem"}).addStyleClass("sapUiTinyMarginBegin");N=f.getText().split(" :")[0].toLocaleUpperCase();i=true}if(N==a[s].DescrChar){var x=new sap.ui.core.Item({text:a[s].ValueChar,key:B});B=B+1;F.insertItem(x)}else{i=false}W.addContent(F);n.addContent(W)}}t.addContent(n);if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length!==0){sap.ui.getCore().byId("id_BtnChar").setEnabled(false);sap.ui.getCore().byId("id_BtnCharSave").setVisible(true)}}else{l.show(oThat.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg8"));sap.ui.getCore().byId("id_BtnCharSave").setVisible(false);sap.ui.getCore().byId("id_BtnRejChar").setVisible(false)}},fnSaveBatchChar:function(e){var a=e.getSource().getId();var o;if(a.indexOf("id_BtnCharSave")!=-1){oThat.IApprove="A"}else if(a.indexOf("id_BtnRejChar")!=-1){oThat.IApprove="R"}var r=this;var i="",l="";var n=0;var s=sap.ui.getCore().byId("id_PanelChar").getContent()[0].getContent();for(var g=0;g<s.length;g++){var d=s[g].getContent();var a=s[g].getContent()[1].getId();l=s[g].getContent()[1];var u="",h="";if(s[g].getContent()[1].getId().search("input")!="-1"){u=s[g].getContent()[1].getValue();if(s[g].getContent().length=="3"){if(s[g].getContent()[2].getText().split(" ").length=="4"){var T=Number(s[g].getContent()[2].getText().split(" ")[1]);var c=Number(s[g].getContent()[2].getText().split(" ")[3]);var v=parseFloat(u);var M=isNaN(v);if(M==false){if(v<T||v>c){if(v>c){s[g].getContent()[1].setValue("")}s[g].getContent()[1].setValueStateText(s[g].getContent()[2].getText());s[g].getContent()[1].setValueState("Error");i=s[g].getContent()[2].getText();l.focus();break}else{s[g].getContent()[1].setValueState("None")}}}else{s[g].getContent()[1].setValueState("None")}}}else if(s[g].getContent()[1].getId().search("box")!="-1"){}else if(s[g].getContent()[1].getId().search("group")!="-1"){h=s[g].getContent()[1].getSelectedIndex();u=s[g].getContent()[1].getSelectedKey()}else if(s[g].getContent()[1].getId().search("select")!="-1"){if(s[g].getContent()[1].getSelectedIndex()==-1){h="";u=""}else{h=s[g].getContent()[1].getSelectedIndex();u=s[g].getContent()[1].getSelectedKey()}}if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[g].EntryObligatory&&!u){i=oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[g].DescrChar+" "+oThat.oView.getModel("i18n").getResourceBundle().getText("RMFG_ErrorMandit");l.focus();break}var f="";if(s[g].getContent()[1].getId().search("input")!="-1"){f=s[g].getContent()[1].getValue();if(f==""){n=n+1}}}if(n==s.length){i=oThat.oView.getModel("i18n").getResourceBundle().getText("PlEnterAnyOneCharac")}if(i){t.error(i)}else{for(var g=0;g<s.length;g++){var d=s[g].getContent();var a=s[g].getContent()[1].getId();l=s[g].getContent()[1];var u="",h="";if(s[g].getContent()[1].getId().search("input")!="-1"){u=s[g].getContent()[1].getValue();if(s[g].getContent().length=="3"){if(s[g].getContent()[2].getText().split(" ").length=="4"){var T=Number(s[g].getContent()[2].getText().split(" ")[1]);var c=Number(s[g].getContent()[2].getText().split(" ")[3]);var v=parseFloat(u);var M=isNaN(v);if(M==false){s[g].getContent()[1].setValueState("None")}}else{s[g].getContent()[1].setValueState("None")}}}else if(s[g].getContent()[1].getId().search("box")!="-1"){}else if(s[g].getContent()[1].getId().search("group")!="-1"){h=s[g].getContent()[1].getSelectedIndex();u=s[g].getContent()[1].getSelectedKey()}else if(s[g].getContent()[1].getId().search("select")!="-1"){if(s[g].getContent()[1].getSelectedIndex()==-1){h="";u=""}else{h=s[g].getContent()[1].getSelectedIndex();u=s[g].getContent()[1].getSelectedKey()}}for(var p=0;p<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;p++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].Werks==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[g].Werks&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].Matnr==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[g].Matnr&&oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].NameChar==oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[g].NameChar){oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[p].ValueChar=u;var w="/"+"BatchCharsNav/results/"+p+"/Flag";oThat.oView.getModel("BATCH").setProperty(w,true);oThat.oView.getModel("BATCH").refresh(true);break}}}oThat.Service="SETCHAR";if(oThat.oView.getModel("ITEM").getData().WbHeaderNav.results[0].Wtype=="PROCURE"&&oThat.oView.getModel("ITEM").getData().EvOrigin==="X"&&oThat.oView.getModel("ITEM").getData().UnloadConfNav.results[0].Ebeln==""){var m=oThat.oView.getModel("Head").getData().Token}else if(oThat.oView.getModel("ITEM").getData().EvOrigin==="E"){var m=oThat.oView.getModel("Head").getData().Token}var V={IAppname:"QC",ICharg:oThat.oView.getModel("Head").getData().Charg,IFinalApproval:"",IItem:oThat.oView.getModel("Head").getData().Item,ILifnr:"",IMatnr:oThat.oView.getModel("Head").getData().Matnr,IQchar:"",ITmode:"",IWbid:oThat.oView.getModel("Head").getData().Wbid,IWerks:oThat.oView.getModel("Head").getData().Werks,EMessage:"",IEbeln:oThat.oView.getModel("Head").getData().Ebeln,IEbelp:oThat.oView.getModel("Head").getData().Ebelp,IVbeln:oThat.oView.getModel("Head").getData().Vbeln,IPosnr:oThat.oView.getModel("Head").getData().Posnr,IToken:m,IdriverId:oThat.oView.getModel("ITEM").getData().EvOrigin==="E"?oThat.oView.getModel("Head").getData().DriverId:"",IApprove:oThat.IApprove,IBatchCharUpd:"X",PostBatchCharNav:[],PostReturnNav:[]};if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length!=0){var I=[];for(var C=0;C<oThat.oView.getModel("BATCH").getData().BatchCharsNav.results.length;C++){if(oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].Flag!==undefined){I.push({CValue:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].DataType==="NUM"?oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].ValueChar===""?"0":oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].ValueChar:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].ValueChar,CDesc:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].DescrChar,Atnam:oThat.oView.getModel("BATCH").getData().BatchCharsNav.results[C].NameChar,Disp:""})}}V.PostBatchCharNav=I}oThat.onCallService(oThat.Service,V)}},onOpenPackagingDetails:function(e){var a=this.getView();var o=this;if(!o._PackingWeightoDialog){o._PackingWeightoDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Packing_Weight",o);a.addDependent(o._PackingWeightoDialog)}o._PackingWeightoDialog.addStyleClass("customPackingDialog");o._oRowContext=e.getSource().getBindingContext("ITEM");var r=o._oRowContext.getModel("ITEM");var i=o._oRowContext.getPath();var l=r.getProperty(i+"/Wbid");var n=r.getProperty(i+"/Item");var s=r.getProperty(i+"/Ebeln");var g=r.getProperty(i+"/Ebelp");var d=r.getProperty(i+"/Matnr");var u=[new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.EQ,l),new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,d)];o.oModel.read("/PackingWeightSet",{filters:u,success:function(e){var t=e.results||[];var a=r.getProperty(i+"/PackagingDetailsUI")||[];var l;if(a.length>0){l=a}else l=[{Serial:1,Type:"",Bags:0,Gross:0,Tare:0,Uom:""},{Serial:2,Type:"",Bags:0,Gross:0,Tare:0,Uom:""}];var n=new sap.ui.model.json.JSONModel({Packaging:l});o._PackingWeightoDialog.setModel(n,"PackingWeightModel");var s=new sap.ui.model.json.JSONModel(t);o._PackingWeightoDialog.setModel(s,"MaterialTypeModel");o._PackingWeightoDialog.open()},error:function(e){t.error(e.responseText);var a=r.getProperty(i+"/PackagingDetailsUI")||[];var l=a.length>0?a:[{Serial:1,Type:"",Bags:0,Gross:0,Tare:0,Uom:""},{Serial:2,Type:"",Bags:0,Gross:0,Tare:0,Uom:""}];var n=new sap.ui.model.json.JSONModel({Packaging:l});o._PackingWeightoDialog.setModel(n,"PackingWeight");o._PackingWeightoDialog.open()}})},onSavePackagingDetails:function(){var e=this;var t=e._PackingWeightoDialog.getModel("PackingWeightModel");var a=t.getProperty("/Packaging");var o=a.map(function(e){var t={};Object.keys(e).forEach(function(a){t[a]=e[a]!==null&&e[a]!==undefined?String(e[a]):""});return t});var r=o.filter(function(e){return e.Type&&e.Type.trim()!==""&&(e.Bags&&e.Bags!=="0"&&e.Bags.trim()!=="")});if(r.length===0){l.show(e.oView.getModel("i18n").getResourceBundle().getText("noDataPackageWeight"));return}var i=0;r.forEach(function(e){i+=parseFloat(e.Gross)||0});var n=i.toFixed(3).toString();if(e._oRowContext){var s=e._oRowContext.getPath();var g=e._oRowContext.getModel("ITEM");g.setProperty(s+"/Weight",n);g.setProperty(s+"/PackagingDetails",r);g.setProperty(s+"/PackagingDetailsUI",a)}e._PackingWeightoDialog.close()},onClosePackagingDetails:function(){this._PackingWeightoDialog.close()},onPackingMaterialChange:function(e){var t=e.getSource();var a=t.getSelectedKey();var o=t.getBindingContext("PackingWeightModel");var r=o.getModel();var i=oThat._PackingWeightoDialog.getModel("MaterialTypeModel");var l=i.getData();var n=l.find(function(e){return e.PackingMaterialType===a});if(n){r.setProperty(o.getPath()+"/Tare",n.TareWeight);r.setProperty(o.getPath()+"/Uom",n.Uom);r.setProperty(o.getPath()+"/Bags","0");r.setProperty(o.getPath()+"/Gross","0.000")}},onBagsValueChange:function(e){var t=e.getSource();var a=t.getValue();var o=parseFloat(a)||0;var r=t.getBindingContext("PackingWeightModel");var i=r.getModel();var l=parseFloat(i.getProperty(r.getPath()+"/Tare"))||0;var n=o*l;i.setProperty(r.getPath()+"/Gross",n.toFixed(3))},onSettings:function(e){this._oTPC.openDialog()},onTablePersoRefresh:function(){s.resetPersData();this._oTPC.refresh()},onNavBack:function(){this.oRouter.navTo("Inbound")},onCloseSignature:function(){var e=document.querySelector("#__custom0 canvas");var t=document.querySelector("#__custom1 canvas");if(e){var a=e.getContext("2d");var o=e.getContext("2d");var r=new Image;oThat.signaturepad0=new SignaturePad(e);oThat.signaturepad2=new SignaturePad(t);if(a!=undefined||o!=undefined){r.onload=function(){a.drawImage(this.datas,0,0);o.drawImage(this.datas,0,0)}}oThat._SignatureDialog.close()}else{oThat._SignatureDialog.close()}},oCanvas:function(){f={toArrayBuffer:function(e){var t=e.width,a=e.height,o=t*4,r=e.getContext("2d").getImageData(0,0,t,a),i=new Uint32Array(r.data.buffer),l=Math.floor((32*t+31)/32)*4,n=l*a,s=122+n,g=new ArrayBuffer(s),d=new DataView(g),u=0,h,T=0,c,v=0,M,f;p(19778);w(s);u+=4;w(122);w(108);w(t);w(-a>>>0);p(1);p(32);w(3);w(n);w(2835);w(2835);u+=8;w(16711680);w(65280);w(255);w(4278190080);w(1466527264);while(T<a){c=122+T*l;h=0;while(h<o){f=i[v++];M=f>>>24;d.setUint32(c+h,f<<8|M);h+=4}T++}return g;function p(e){d.setUint16(u,e,true);u+=2}function w(e){d.setUint32(u,e,true);u+=4}},toBlob:function(e){return new Blob([this.toArrayBuffer(e)],{type:"image/bmp"})},toDataURL:function(e){var t=new Uint8Array(this.toArrayBuffer(e)),a="",o=0,r=t.length;while(o<r)a+=String.fromCharCode(t[o++]);return"data:image/bmp;base64,"+btoa(a)}}},onBatchLiveChange:function(e){var t=e.getSource().getValue();var a=/^[0-9a-zA-Z]+$/;var o=e.getId();var r=true;if(t.match(a)){r=true}else{r=false}if(!r){var i=t.slice(t.length-1,t.length);var l=t.replace(i,"");e.getSource().setValue(l.toUpperCase())}else{e.getSource().setValue(t.toUpperCase())}},onEscapeBatch:function(){oThat.Batch.destroy()},onExit:function(){if(this._oTPC!=undefined){this._oTPC.destroy();this.byId("id_unload").destroy()}},onCaptureCamera:function(){var e=this;e.oView.setModel(new o(e.Images),"MASS");e.oView.getModel("MASS").refresh(true);if(!e.oCapture){e.oCapture=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.CaptureImage",e);e.oView.addDependent(e.oCapture)}e.oCapture.open()},fnAddBillClose:function(){oThat.Images=[];oThat.oCapture.close()},onBeforeUploadStarts:function(){oThat.BusyDialog.open()},onCompleteUpload:function(e){var t=oThat.Core.byId("id_RadioBtn").getSelectedButton().getId();var a=oThat.Core.byId("id_RadioBtn").getSelectedButton().getText();if(oThat.Images.length!=0){for(var r=0;r<oThat.Images.length;r++){if(oThat.Images[r].Doknr==t){oThat.Images.splice(r,1);break}}}var i=e.getSource()._getFileUploader()._aXhr[0]["file"];var l={};l.Documentid=jQuery.now().toString();l.Fname=a;l.Ftype=i.type;l.Objky="";l.Doknr=t;e.getSource()._getFileUploader()._aXhr.splice(0,1);if(i){var n=new FileReader;var s="data:"+i.type+";base64,";n.onloadend=function(e){return function(e){var t=e.target.result.indexOf(s)+s.length;var a=e.target.result.substring(t);l.Filename=a;oThat.Images.unshift(l);l={};oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true);oThat.BusyDialog.close()}}(i)}n.readAsDataURL(i)},onFileDeleted:function(e){var t=e.getParameter("documentId");for(var a=0;a<oThat.Images.length;a++){if(oThat.Images[a].Documentid==t){oThat.Images.splice(oThat.Images[a],1);break}}oThat.oView.setModel(new o(oThat.Images),"MASS");oThat.oView.getModel("MASS").refresh(true)},fnOKImages:function(e){oThat.oCapture.close()},onDmsPost:function(e){if(oThat.Images.length!=0){var a=[];oThat.Images.forEach(function(e){a.push({Dokar:"",Doknr:e.Doknr,Dokvr:"",Doktl:"",Dokob:"",Object:"",Objky:"",Fname:e.Fname,Ftype:e.Ftype,Filename:e.Filename})});var o={d:{IvWbid:e,DmsPostNav:a,DmsReturnNav:[],PrintitemNav:[]}};oThat.oModel.create("/DmsPostSet",o,{success:function(){},error:function(e){oThat.BusyDialog.close();var a=oThat.oView.getModel("i18n").getResourceBundle().getText("Title21");t.show(e.responseText,t.Icon.ERROR,a)}})}},onPressFilter:function(){var e=this;if(e.getView().getModel("oGateFilter")==undefined){var t=e.getView().getModel("oUnloadModel").getData().QualWbidNav.results;var a=[];var r=[new Set(t.map(function(e){return e.Gate}))];var i=r[0].values();for(var l=0;l<r[0].size;l++){var n=i.next().value;var s="";for(var g=0;g<t.length;g++){if(n==t[g].Gate){s=t[g].GateName;break}}var d={Gate:n,GateName:s};a.push(d)}a.push({Gate:"All",GateName:""});e.getView().setModel(new o(a),"oGateFilter")}if(!e.GateFilter){e.GateFilter=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.GateFilter",e);e.getView().addDependent(e.GateFilter)}e.GateFilter.fireSearch();e.GateFilter.open()},onConfirmGate:function(e){var t=this;if(e){var a=e.getParameter("selectedItem");oThat.vFilterItem=a.getTitle().split(" ")[0];var o=oThat.oUnloadData.QualWbidNav.results;if(a.getTitle().split(" ")[0]!="All"){var r=o.filter(function(e){oThat.vFilter=a.getTitle().split(" ")[0];return e.Gate==a.getTitle().split(" ")[0]});t.getView().getModel("oUnloadModel").getData().QualWbidNav.results=r;t.getView().getModel("oUnloadModel").refresh(true)}else{oThat.Service="GET";var i={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"X",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",QualWbidNav:[]}};oThat.onCallService(oThat.Service,i)}}},onSearchGate:function(e){var t=e.getParameter("value");var a;if(t==undefined){t=""}a=new sap.ui.model.Filter([new r("Gate",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var i=e.getSource().getBinding("items");i.filter([o])},fnTableUpdate:function(e){},fnSelectedChange:function(e){this.REASON=e.getSource().getSelectedItem().getText()},fnReprintDialog:function(){var e=this;e.Reprint=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.RePrint",e);e.oView.addDependent(e.Reprint);e.Reprint.open();sap.ui.getCore().byId("id_InBatch").setVisible(true);sap.ui.getCore().byId("id_InBatchLabel").setVisible(true)},onClickReprintDecline:function(){oThat.Reprint.destroy()},fnClickonReprintOK:function(){var e=this;if(sap.ui.getCore().byId("id_InVehicleNo").getValue()===""||sap.ui.getCore().byId("id_InWbid").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()===""||sap.ui.getCore().byId("id_InDate").getValue()==null){t.error(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg7"))}else{var a=e.SelectedLots?e.SelectedLots:"";var o=sap.ui.getCore().byId("id_InWbid").getValue();var r=e.oModel.sServiceUrl;var i="/DownloadSet(IvWbid='"+o+"',IvPrint='X',GateEntry='X',IvBatch='"+a+"')/$value";var l=r+i;if(sap.ui.Device.system.desktop){e.initiatePdfDialog();var n="<div><iframe src="+l+" width='100%' height='520'></iframe></div>";e.oImageDialog.getContent()[0].setContent(n);e.oImageDialog.addStyleClass("sapUiSizeCompact");e.oImageDialog.open()}else{window.open(l)}e.Reprint.destroy()}},onClickVehicleF4:function(e){var a=this;a.vId=e.getSource().getId();var o=sap.ui.getCore().byId("id_InDate").getValue();if(o!==null&&o!==""){var o=sap.ui.getCore().byId("id_InDate").getDateValue();var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var i=r.format(o);a.Service="REPRINT";var l={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:"",IvWerks:"",StatusUpdate:"",ReprintF4:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],StatusUpdateNav:[{InDate:i}]}};a.onCallService(a.Service,l)}else{t.error(a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6"))}},onPrLotF4:function(e){var a=this;a.vId=e.getSource().getId();var o=sap.ui.getCore().byId("id_InDate").getValue();var r=sap.ui.getCore().byId("id_InWbid").getValue();if(o!==null&&o!==""){if(r){var o=sap.ui.getCore().byId("id_InDate").getDateValue();var i=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-ddT00:00:00"});var l=i.format(o);a.Service="GETBATCH";var n={d:{GateEntry:"",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:"",IvWbid:r,IvWerks:"",StatusUpdate:"",ReprintF4:"",PrlotF4Print:"X",Approval:"",GetReturnNav:[],PoItemNav:[],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[],F4PrlotPrintNav:[],StatusUpdateNav:[{InDate:l}]}};a.onCallService(a.Service,n)}else{t.error(a.oView.getModel("i18n").getResourceBundle().getText("PlSelTruck"))}}else{t.error(a.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg6"))}},onChargF4Search:function(e){var t=e.getSource()._sSearchFieldValue;if(t&&t.length>0){var a=new sap.ui.model.Filter("Lotno",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter("Ebeln",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Bwtar",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("Maktx",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter([a,o,r,i])}var n=e.getSource().getBinding("items");n.filter(l)},onChargF4Confirm:function(e){var t=e.getParameter("selectedContexts");if(t.length>0){var a=e.getParameter("selectedItem");var o=[];var r="";var i="";for(var l=0;l<t.length;l++){var n=t[l].getObject();if(l===0){r=n.Lotno}else{r=r+"*"+n.Lotno}if(t.length>1){i=t[0].getObject().Lotno+"+ "+oThat.oView.getModel("i18n").getResourceBundle().getText("RemMore")}else{i=t[0].getObject().Lotno}}oThat.SelectedLots=r;sap.ui.getCore().byId("id_InBatch").setValue(i)}},fnSearchRefId:function(e){var t=e.getSource().getValue();var a=this.getView().byId("id_unload");if(t&&t.length>0){var o=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,t);var r=new sap.ui.model.Filter("Vehno",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("VEND_NAME",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("UNSEZ",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter("Item",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter("Dname",sap.ui.model.FilterOperator.Contains,t);var g=new sap.ui.model.Filter("DriverMob",sap.ui.model.FilterOperator.Contains,t);var d=new sap.ui.model.Filter("Batch",sap.ui.model.FilterOperator.Contains,t);var u=new sap.ui.model.Filter([o,r,i,l,n,s,g,d])}var h=a.getBinding("items");h.filter(u)},loadZXingLibrary:function(){return new Promise((e,t)=>{var a=document.createElement("script");a.src=sap.ui.require.toUrl("ZGT_MM_INBOUND/ScannerAppLibrary/index.min.js");a.onload=e;a.onerror=t;document.head.appendChild(a)})},fnScanWB:function(){var e=this;var t=e.getView().getModel("i18n").getResourceBundle();var a=new o;if(ZXing!==undefined){this.loadZXingLibrary().then(()=>{u=new ZXing.BrowserMultiFormatReader;u.listVideoInputDevices().then(o=>{if(o.length>1){d=o[1].deviceId}else if(o.length===1){d=o[0].deviceId}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}if(o.length>=1){var r=[];o.forEach(o=>{var i={};i.text=o.label;i.value=o.deviceId;r.push(i);a.setData(r);this.getView().setModel(a,"oVideoDeviceModel");h=new sap.m.ComboBox({items:{path:"oVideoDeviceModel>/",template:new sap.ui.core.Item({key:"{oVideoDeviceModel>value}",text:"{oVideoDeviceModel>text}"})},selectedKey:d,selectionChange:function(t){d=t.getSource().getSelectedKey();e._oScanQRDialog.close();u.reset()}});T=new sap.m.Button({text:t.getText("Start"),type:t.getText("Accept"),press:function(){e._oScanQRDialog.close();e.fnScanWB()}});e.startScanning()})}})}).catch(e=>{console.error("Error loading ZXing library:",e)})}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(t.getText("ScanningFailed")+" "+e)})}},startScanning:function(){var e=this;var t=e.getView();var a=t.getModel("i18n").getResourceBundle();try{var o=cordova.plugins.barcodeScanner;if(o){g=true}else{g=false}}catch(e){g=false}if(g===false&&sap.ui.Device.system.desktop===false){if(!this._oScanQRDialog){this._oScanQRDialog=new sap.m.Dialog({title:a.getText("ScanQRcode"),contentWidth:"640px",contentHeight:"480px",horizontalScrolling:false,verticalScrolling:false,stretchOnPhone:true,stretch:true,content:[new sap.ui.core.HTML({id:this.createId("scanContainer_QR"),content:"<video />"})],endButton:new sap.m.Button({text:a.getText("Cancel"),press:function(t){this._oScanQRDialog.close();u.reset();sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}.bind(this)}),afterOpen:function(){u.decodeFromVideoDevice(d,t.byId("scanContainer_QR").getDomRef(),(t,a)=>{if(t){this._oScanQRDialog.close();u.reset();e.onScanBarcode(t.text.trim())}if(a&&!(a instanceof ZXing.NotFoundException)){}})}.bind(this),afterClose:function(){}});t.addDependent(this._oScanQRDialog)}this._oScanQRDialog.open()}else{sap.ndc.BarcodeScanner.scan(function(t){if(!t.cancelled){e.onScanBarcode(t.text.trim())}},function(e){sap.m.MessageToast(a.getText("ScanningFailed")+" "+e)})}},onScanBarcode:function(e){var t=this;t.Scan=true;var a=e.split("#")[0];var o=this.getView().byId("id_unload");if(a&&a.length>0){var r=new sap.ui.model.Filter("Wbid",sap.ui.model.FilterOperator.Contains,a);var i=new sap.ui.model.Filter([r])}var l=o.getBinding("items");l.filter(i)},fnClearFilter:function(e){var t=this;if(t.Scan){var a="";t.onScanBarcode(a);t.getView().byId("id_SearchField").setValue("");t.Scan=false}},onValueHelpPressUom:function(e){var t=this;t.vPath=e.getSource().getParent().getBindingContextPath();var a=t.oView.getModel("ITEM").getObject(e.getSource().getParent().getBindingContextPath());t.OpenFragUom=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Uom",this);t.oView.addDependent(t.OpenFragUom);t.OpenFragUom.open();var o=[new r("ImMatnr",sap.ui.model.FilterOperator.EQ,a.Matnr),new r("Uom",sap.ui.model.FilterOperator.EQ,"X")];t.Service="UOM";t.onCallService(t.Service,o)},onValueHelpConfirmUom:function(e){var t=e.getParameter("selectedItem").getTitle();var a=oThat.oView.getModel("ITEM").getObject(oThat.vPath);a.Uom=t;oThat.oView.getModel("ITEM").refresh(true);oThat.OpenFragUom.destroy()},fnvalidatePoQuan:function(e,a,o){var r=false;var o="";if(e.Quantity===""){r=true;o=o+oThat.oView.getModel("i18n").getResourceBundle().getText("EnterQuantity")+"\n"}if(e.Uom===""){r=true;o=o+oThat.oView.getModel("i18n").getResourceBundle().getText("EnterUom")}if(r===false){oThat.oModel.read("/ValidationSet",{filters:[new sap.ui.model.Filter("Matnr",sap.ui.model.FilterOperator.EQ,e.Matnr),new sap.ui.model.Filter("UnloadMenge",sap.ui.model.FilterOperator.EQ,e.Quantity),new sap.ui.model.Filter("UnloadMeins",sap.ui.model.FilterOperator.EQ,e.Uom),new sap.ui.model.Filter("PoMenge",sap.ui.model.FilterOperator.EQ,oThat.oView.getModel("ITEM").getData().WbItemNav.results[0].Ntgew),new sap.ui.model.Filter("PoMeins",sap.ui.model.FilterOperator.EQ,v),new sap.ui.model.Filter("QtyVal",sap.ui.model.FilterOperator.EQ,"X")],urlParameters:{$expand:"ReturnNav"},async:true,success:function(e,a){if(e.results[0].ReturnNav.results[0].Message==="E"&&oThat.oView.getModel("ITEM").getData().EvOrigin!=="M"){r=true;o=o+oThat.oView.getModel("i18n").getResourceBundle().getText("ErrGrtrQuan")}if(r===true){t.error(o)}else{if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"||oThat.oView.getModel("ITEM").getData().EvBatchUpd=="X"){oThat.onBatchUpdate()}else if(oThat.oView.getModel("ITEM").getData().EvWhSign!="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd!="X"){oThat.SubmitItem()}else if(oThat.oView.getModel("ITEM").getData().EvWhSign=="X"&&oThat.oView.getModel("ITEM").getData().EvBatchUpd!="X"){if(!oThat._SignatureDialog){oThat._SignatureDialog=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.Signature",oThat);oThat.oView.addDependent(oThat._SignatureDialog)}oThat._SignatureDialog.open();var i=document.querySelector("#__custom0 canvas");var l=document.querySelector("#__custom1 canvas");oThat.signaturepad0=new SignaturePad(i);if(document.querySelector("#__custom1")){document.querySelector("#__custom1").style.display="none"}}}},error:function(e){oThat.BusyDialog.close();t.error(e)}})}else{t.error(o)}},onUpdateItemDeliveryno:function(e){var t=this.oView.getModel("ITEM").getData().EvChallan;var a=this.oView.getModel("ITEM").getData().UnloadConfNav.results;if(a.length==0){var a=this.oView.getModel("ITEM").getData().NonFertWbData}for(var o in a){a[o].Config18=t}this.oView.getBindings(true)},onUpdateCommonStorageLoc:function(e){var t=e.getSource().getValue();var a=this.oView.getModel("ITEM").getData().UnloadConfNav.results;if(a.length==0){var a=this.oView.getModel("ITEM").getData().NonFertWbData}for(var o of a){o.Lgort=t}this.oView.getBindings(true)},onAddPoItemFrag:function(){oThat.oView.setModel(new o([]),"POITEMS");oThat.OpenFragSearchPo=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.SearchPOItem",this);oThat.oView.addDependent(oThat.OpenFragSearchPo);oThat.OpenFragSearchPo.open()},onClosePOItem:function(){this.OpenFragSearchPo.close()},onGetPoItemF4:function(e){var t=this;t.oView.setModel(new o([]),"POITEMS");var a={d:{GateEntry:"X",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvDelivery:"",IvPo:e.oSource.getValue(),IvWbid:"",IvItem:"",IvWerks:oThat.TableSelectedObject.Werks,IvMatnr:"",Transfer:"",IvCharg:"",DelItemNav:[],FifoWbidNav:[],GetReturnNav:[],PoItemNav:[{Ebeln:e.oSource.getValue()}],QualWbidNav:[],WbItemNav:[],WsItemNav:[],WbHeaderNav:[{Wtype:oThat.TableSelectedObject.Wtype}]}};t.Service="POITEMS";t.onCallService(t.Service,a)},onCalculateAcceptQty:function(e){var t=e.oSource.getBindingContext("ITEM").getObject();var a=t.Config16===""?"0.000":t.Config16;var o=t.Config14===""?"0.000":t.Config14;var r=parseFloat(a)-parseFloat(o);e.oSource.getBindingContext("ITEM").getObject().Config17=r.toFixed(3);e.oSource.getBindingContext("ITEM").getObject().Config16=parseFloat(a).toFixed(3);this.oView.getModel("ITEM").updateBindings(true)},OnAddPOItemWBID:function(e){var t=this;t.delItem=false;var a=e.oSource.getParent().getContent()[1].getItems()[0].getSelectedContextPaths();var o=[],r;var i=oThat.oView.getModel("ITEM").getData().UnloadConfNav.results;if(i.length==0){i=oThat.oView.getModel("ITEM").getData().NonFertWbData}else{}for(var l in i){o.push(i[l]);r=i[l].FertFlag||""}var n=true;for(var s in a){var g=oThat.oView.getModel("POITEMS").getObject(a[s]);o.push(g)}if(n){t.payload=t.generatePayload(o);sap.m.MessageBox.show(t.oView.getModel("i18n").getResourceBundle().getText("Addpop"),{icon:sap.m.MessageBox.Icon.confirm,title:t.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){t.Service="UpdatePODETAILS";t.onCallService(t.Service,t.payload)}}})}else{sap.m.MessageBox.information(oThat.oView.getModel("i18n").getResourceBundle().getText("mattypeDif"))}},OnDeleteWBID:function(e){var t=this;t.delItem=true;var a=[];t.Obj=e.oSource.getBindingContext("ITEM").getObject();a.push(t.Obj);t.payload=t.generatePayload(a);t.payload.d.PostWbDelItemNav.forEach(function(e){delete e.Config14});sap.m.MessageBox.show(t.oView.getModel("i18n").getResourceBundle().getText("Deletepop"),{icon:sap.m.MessageBox.Icon.confirm,title:t.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){t.Service="UpdatePODETAILS";t.onCallService(t.Service,t.payload)}}})},OnsubmitPoItem:function(){var e=this,t=true;e.delItem=false;var a=[];var o=e.oView.getModel("ITEM").getData();var r=sap.ui.getCore().byId("id_ItemTable2").getSelectedContextPaths();if(sap.ui.getCore().byId("id_ItemTable2").getSelectedItems().length<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg10"))}if(e.fertType){if(e.oView.getModel("ITEM").getData().EvChallan.trim().length<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg1"))}for(var i in r){var l=oThat.oView.getModel("ITEM").getObject(r[i]);a.push(l);if(l.Lgort.trim().length===0||l.Config16.trim().length===0||l.Config18.trim().length===0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("itemValid"));break}if(l.Config16.trim()<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("unloadqty"));break}}}else{for(var i in r){var l=oThat.oView.getModel("ITEM").getObject(r[i]);a.push(l)}}if(t){e.payload=e.generatePayload(a);e.payload.d.GateEntry="";e.payload.d.UnloadConf="X";e.payload.d.IvMatnr="";e.payload.d.IvWithoutwb="";e.payload.d.IvChallan=e.oView.getModel("ITEM").getData().EvChallan||"";e.payload.d.PostWbHeaderNav[0]={Wbid:e.payload.d.PostWbHeaderNav[0].Wbid};for(var n in e.payload.d.PostWbitemNav){if(e.payload.d.PostWbitemNav[n].Config17==="0.000"){e.payload.d.PostWbitemNav[n].Config15="1"}else{e.payload.d.PostWbitemNav[n].Config15="0.000"}}sap.m.MessageBox.show(e.oView.getModel("i18n").getResourceBundle().getText("Submitpop"),{icon:sap.m.MessageBox.Icon.confirm,title:e.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){e.Service="SUBMIT";e.onCallService(e.Service,e.payload)}}})}},OnsubmitPoItem2AB:function(){var e=this,t=true;e.delItem=false;var a=[];var o=sap.ui.getCore().byId("id_ItemTable2A"),r=sap.ui.getCore().byId("id_ItemTable2B");var i=o.getSelectedContextPaths(),l=r.getSelectedContextPaths();if(oThat.oView.getModel("oViewModel").getProperty("/nFertType")===true&&i.length>0){if(e.oView.getModel("ITEM").getData().EvChallan.trim().length<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg1"))}}if(i.length<=0&&l.length<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("ErrorMsg10"));return}i.forEach(function(o){var r=e.oView.getModel("ITEM").getObject(o);a.push(r);if(!r.Lgort||r.Lgort.trim().length===0||!r.Config16||r.Config16.trim().length===0||!r.Config18||r.Config18.trim().length===0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("itemValid"));return}if(r.Config16&&parseFloat(r.Config16)<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("unloadqty"));return}});l.forEach(function(o){var r=e.oView.getModel("ITEM").getObject(o);a.push(r);if(r.Lgort&&r.Lgort.trim()<=0){t=false;sap.m.MessageToast.show(e.oView.getModel("i18n").getResourceBundle().getText("itemValid"));return}});if(t){e.payload=e.generatePayload(a);e.payload.d.GateEntry="";e.payload.d.UnloadConf="X";e.payload.d.IvMatnr="";e.payload.d.IvWithoutwb="";e.payload.d.IvChallan=e.oView.getModel("ITEM").getData().EvChallan||"";e.payload.d.PostWbHeaderNav[0]={Wbid:e.payload.d.PostWbHeaderNav[0].Wbid};e.payload.d.PostWbitemNav.forEach(function(e){if(e.Config17==="0.000"){e.Config15="1"}else{e.Config15="0.000"}});sap.m.MessageBox.show(e.oView.getModel("i18n").getResourceBundle().getText("Submitpop"),{icon:sap.m.MessageBox.Icon.CONFIRM,title:e.oView.getModel("i18n").getResourceBundle().getText("Title16"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){e.Service="SUBMIT";e.onCallService(e.Service,e.payload)}}})}},generatePayload:function(e){var t=this,a=[];var o=t.oView.getModel("ITEM").getData();var r=oThat.oView.getModel("ITEM").getData().UnloadConfNav.results.length;if(r==0){r=oThat.oView.getModel("ITEM").getData().NonFertWbData.length}else{}for(var i in e){var l=e[i];if(l.Item===undefined){r+=1}a.push({Wbid:o.WbHeaderNav.results[0].Wbid,Ebeln:l.Ebeln||"",Item:l.Item||"0000"+r,Ebelp:l.Ebelp||"",Matnr:l.Matnr||"",Lgort:l.Lgort||"",Parnr:oThat.TableSelectedObject.Parnr||l.Parnr||l.Lgort,Batch:l.Charg||l.Batch||"",Brgew:l.Brgew||"0",Gdate:null,Gtime:"PT00H00M00S",Sgdate:null,Sgtime:"PT00H00M00S",Trwgt:"0",Tdate:null,Ttime:"PT00H00M00S",Stdate:null,Sttime:"PT00H00M00S",Ntgew:l.Ntgew||"0",Menge:l.Menge||"0.000",Pmatno3:l.Pmatno3||"0",Pmatqty3:l.Pmatqty3||"0.000",Trwgt3:l.Trwgt3||"0.000",Pmatno4:l.Pmatno4||"0",Pmatqty4:l.Pmatqty4||"0.000",Trwgt4:l.Trwgt4||"0.000",Actweight:l.Actweight||"0.000",Config2:l.Config2||"0.00",Config8:l.Config8||"0.00",Vbeln:l.Vbeln||"",Posnr:l.Posnr||"000000",Zeile:l.Zeile||"0000",Config14:l.Config14||"0.000",Config16:l.Config16||"",Config17:l.Config17||"",Config18:l.Config18||o.EvChallan,Config19:l.Uom||"",Config20:l.Config20||"",Config6:l.Config6||"",Pkwgt:l.Pkwgt&&l.Pkwgt!==""&&l.Pkwgt!=="0.000"?l.Pkwgt:l.Weight||"0.000",Pmat1:l.PackagingDetails?.[0]?.Type||"",Pmatuom1:l.PackagingDetails?.[0]?.Uom||"",Pmatno1:l.Pmatno1&&l.Pmatno1!==""&&l.Pmatno1!=="0"?l.Pmatno1:l.PackagingDetails?.[0]?.Bags||"0",Pmatqty1:l.Pmatqty1&&l.Pmatqty1!==""&&l.Pmatqty1!=="0.000"?l.Pmatqty1:l.PackagingDetails?.[0]?.Gross||"0.000",Trwgt1:l.Trwgt1&&l.Trwgt1!==""&&l.Trwgt1!=="0.000"?l.Trwgt1:l.PackagingDetails?.[0]?.Tare||"0.000",Pmat2:l.PackagingDetails?.[1]?.Type||"",Pmatuom2:l.PackagingDetails?.[1]?.Uom||"",Pmatno2:l.Pmatno2&&l.Pmatno2!==""&&l.Pmatno2!=="0"?l.Pmatno2:l.PackagingDetails?.[1]?.Bags||"0",Pmatqty2:l.Pmatqty2&&l.Pmatqty2!==""&&l.Pmatqty2!=="0.000"?l.Pmatqty2:l.PackagingDetails?.[1]?.Gross||"0.000",Trwgt2:l.Trwgt2&&l.Trwgt2!==""&&l.Trwgt2!=="0.000"?l.Trwgt2:l.PackagingDetails?.[1]?.Tare||"0.000"})}var n={d:{GateEntry:"X",VehAssign:"",PreQual:"",UnloadConf:"",GateExit:"",Inbound:"X",Outbound:"",IvWboj:"WB",IvMatnr:"X",IvWithoutwb:o.EvWithoutwb,IvWbid:o.WbHeaderNav.results[0].Wbid,PostReturnNav:[],PostWbHeaderNav:[{Werks:o.WbHeaderNav.results[0].Werks,Lifnr:o.WbHeaderNav.results[0].Lifnr,Gate:o.WbHeaderNav.results[0].Gate,Wsgate:o.WbHeaderNav.results[0].Wsgate,Vehno:o.WbHeaderNav.results[0].Vehno,Vehtyp:o.WbHeaderNav.results[0].Vehtyp,Dname:o.WbHeaderNav.results[0].Dname,DriverMob:o.WbHeaderNav.results[0].DriverMob,Wtype:o.WbHeaderNav.results[0].Wtype,Wbid:o.WbHeaderNav.results[0].Wbid,Erdat:o.WbHeaderNav.results[0].Erdat,Ertim:"PT00H00M00S",Direction:"IN",Challan:o.WbHeaderNav.results[0].Challan,Token:o.WbHeaderNav.results[0].Token,RefWbid:o.WbHeaderNav.results[0].RefWbid}],PostWbitemNav:t.delItem?[]:a,PostWsItemNav:[],PostWbDelItemNav:t.delItem?a:[],PostDmsNav:[]}};return n},onContinuosScannerBtnPress:async function(){var e=this;sap.ndc.BarcodeScanner.scan(async function(t){if(!t.cancelled){var a=t.text.trim();var o="";var r=e.getView().getModel("ITEM").getData().UnloadConfNav.results.find(function(e){return e.Batch.toLowerCase()===a.toLowerCase()&&e.BatchStatus==="sap-icon://accept"});if(r){r.qty+=1;sap.m.MessageToast.show(`Batch ${r.Batch} already scanned and confirmed`);o!=="Error"}else{o=await e._validateScannedBatch(a)}if(o!=="Error"){setTimeout(function(){e.onContinuosScannerBtnPress()},800)}}else{e.BusyDialog.close();sap.m.MessageToast.show("Scanning stopped.")}},function(e){sap.m.MessageBox.error("Scanning failed: "+e)},function(e){},"Enter Inbound Batch Barcode",true,30,1,false,false)},_validateScannedBatch:function(e){let t=sap.ui.getCore().byId("id_ItemTable3A");let a=t.getModel("ITEM");let o=a.getData().WbItemNav.results;let r=false;o.forEach(function(t){if(t.Batch.toLowerCase()===e.toLowerCase()){t.BatchStatus="sap-icon://accept";r=true}});if(r){sap.m.MessageToast.show(" "+e+" found. Batch marked as available.")}else{sap.m.MessageBox.warning(`Batch ${e} is not available in the delivery`,{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){this.onContinuosScannerBtnPress()}}.bind(this)});return"Error"}a.refresh(true)},OnsubmitPoItem3AB:function(){var e=this,t=true;e.delItem=false;var a=[];var o=sap.ui.getCore().byId("id_ItemTable3A");var r=o.getSelectedContextPaths();var i=o.getSelectedItems();if(sap.ui.getCore().byId("id_ItemTable3A").getSelectedItems().length<=0){t=false;sap.m.MessageToast.show(e.getView().getModel("i18n").getResourceBundle().getText("ErrorMsg10"));return}var l=e.getView().getModel("ITEM").getData().UnloadConfNav.results;var n=l.find(function(e){return e.BatchStatus==="sap-icon://accept"});if(!n){sap.m.MessageBox.error("Scan atleast one batch...");t=false;return}var s=[];var g="";i.forEach(function(e){var t=e.getBindingContext("ITEM");if(t){var a=t.getObject();if(a&&a.BatchStatus!==undefined&&a.BatchStatus==="sap-icon://accept"){s.push(a.BatchStatus)}else{g=g+"Batch "+a.Batch+" is not scanned for the Item: "+`${parseFloat(t.sPath.split("/")[3])+1}`+"\n\n"}}});if(g){sap.m.MessageBox.error(g);t=false;return}var d=l.filter(function(e){return e.BatchStatus==="sap-icon://accept"});if(i.length===d.length){t=true}else{sap.m.MessageBox.error("Scanned Batches: "+d.length+"\nSelected Items: "+i.length+"\n\nPlease select all the scanned items.");t=false;return}if(s.length===0){sap.m.MessageBox.error("Unable to read status values from the selected items.");t=false;return}var u=s.every(function(e){return e===s[0]});if(!u){sap.m.MessageBox.error("Selected items must have the same Status (either all 'Yes' or all 'No').");return}r.forEach(function(t){var o=e.oView.getModel("ITEM").getObject(t);a.push(o)});if(t){e.payload=e.generatePayload(a);e.payload.d.GateEntry="";e.payload.d.UnloadConf="X";e.payload.d.IvMatnr="";e.payload.d.IvWithoutwb="";e.payload.d.IvChallan=e.oView.getModel("ITEM").getData().EvChallan||"";e.payload.d.PostWbHeaderNav[0]={Wbid:e.payload.d.PostWbHeaderNav[0].Wbid};var h=true;e.payload.d.PostWbitemNav.forEach(function(e){if(e.Config17==="0.000"){e.Config15="1"}else{e.Config15="0.000"}if(e.Menge!=="0.000"){e.Menge="0.000"}if(!e.Lgort||e.Lgort===""){h=false;return}});if(!h){sap.m.MessageBox.error(e.oView.getModel("i18n").getResourceBundle().getText("ValidStorageLoc"))}else{var T=o?.getBinding("items")?.oList?.length===i.length?e.oView.getModel("i18n").getResourceBundle().getText("SubmitConfirmation"):e.oView.getModel("i18n").getResourceBundle().getText("PartialSubmitConfirmation");sap.m.MessageBox.show(T,{icon:sap.m.MessageBox.Icon.WARNING,title:e.oView.getModel("i18n").getResourceBundle().getText("ConfirmSubmission"),actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(t){if(t===sap.m.MessageBox.Action.YES){e.Service="SUBMIT";e.onCallService(e.Service,e.payload)}}})}}},onDefaultSLocF4:function(e){var t=oThat.getView().getModel("ITEM").getData().UnloadConfNav.results[0];oThat.StorageFrag=sap.ui.xmlfragment("ZGT_MM_INBOUND.Fragments.DefaultStorageLoc",this);oThat.oView.addDependent(oThat.StorageFrag);oThat.StorageFrag.open();var a=[new r("Matnr",sap.ui.model.FilterOperator.EQ,t.Matnr),new r("Werks",sap.ui.model.FilterOperator.EQ,t.Werks)];oThat.Service="SLOC";oThat.onCallService(oThat.Service,a)},onDefaultSLocF4Confirm:function(e){var t=e.getParameter("selectedItem").getTitle();var a=oThat.oView.getModel("ITEM").getData();a.EvChallan=t;a.UnloadConfNav.results.forEach(e=>e.Lgort=t);oThat.oView.getModel("ITEM").refresh(true);oThat.StorageFrag.destroy()},onDefaultSLocF4Search:function(e){var t=e.getParameter("value");var a;a=new sap.ui.model.Filter([new r("Lgort",sap.ui.model.FilterOperator.Contains,t),new r("Lgobe",sap.ui.model.FilterOperator.Contains,t)]);var o=new sap.ui.model.Filter(a,false);var i=e.getSource().getBinding("items");i.filter([o])},fnSetItemStatusType:function(e){switch(e){case"sap-icon://decline":return"Reject";case"sap-icon://accept":return"Success";default:return"Default"}}})});
//# sourceMappingURL=Unloading_Confirm.controller.js.map